/*

twilio-ip-messaging.js v0.8 (0.8.1)

Copyright (c) 2015 Twilio, Inc. All rights reserved. <https://twilio.com>

THIS SOFTWARE IS PROVIDED BY THE AUTHOR "AS IS" AND ANY EXPRESS OR IMPLIED
WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT
SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT
OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING
IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY
OF SUCH DAMAGE.

 MIT
*/
(function e$$0(l,h,b){function f(c,a){if(!h[c]){if(!l[c]){var d="function"==typeof require&&require;if(!a&&d)return d(c,!0);if(e)return e(c,!0);d=Error("Cannot find module '"+c+"'");throw d.code="MODULE_NOT_FOUND",d;}d=h[c]={exports:{}};l[c][0].call(d.exports,function(a){var d=l[c][1][a];return f(d?d:a)},d,d.exports,e$$0,l,h,b)}return h[c].exports}for(var e="function"==typeof require&&require,k=0;k<b.length;k++)f(b[k]);return f})({1:[function(g,l,h){function b(d,p,b){var f=this;d=new e(d);b=new a(d,
b);var G=new k(d,b);Object.defineProperties(this,{_notification:{value:p},_config:{value:d},_network:{value:b},_subscriptions:{value:G},_router:{value:new c({config:d,subscriptions:G})}});p.subscribe("com.twilio.rtd.cds.entity");p.subscribe("com.twilio.rtd.cds.stream");p.subscribe("com.twilio.rtd.cds.map");p.on("message",this._router.onMessage.bind(this._router));p.on("transport_ready",function(a){if(a)f._router.onConnected()})}g("events");g("util");var f=g("loglevel"),e=g("./configuration.js"),k=
g("./subscriptions.js"),c=g("./router.js"),a=g("./network.js"),d=g("./dataentity.js"),p=g("./datastream.js"),G=g("./datamap.js");b.prototype._getDependencies=function(){return{config:this._config,datasync:this,network:this._network,router:this._router}};b.prototype.createEntity=function(a,c){var p=this,b={data:a};"undefined"!==typeof c&&(b.purpose=c);return this._network.post(this._config.entitiesUri,b).then(function(a){f.debug("DSS I: entity created: ",a);return new d(p._getDependencies(),a.body)})};
b.prototype.openEntity=function(a){var c=this;return this._network.get(a).then(function(a){if(a.body.hasOwnProperty("type"))throw Error("Unexpected data type: "+a.body.type+" when entity was expected");return new d(c._getDependencies(),a.body)})};b.prototype.createStream=function(a,d){var c=this,b={};"undefined"!==typeof a&&(b.purpose=a);"undefined"!==typeof d&&(b.context=d);return this._network.post(this._config.streamsUri,b).then(function(a){f.debug("DSS I: data stream created: ",a);return new p(c._getDependencies(),
a.body)})};b.prototype.openStream=function(a){var d=this;return this._network.get(a).then(function(a){if("stream"!==a.body.type)throw Error("Unexpected data type: "+a.body.type);f.debug("DSS I: data stream opened: ",a);return new p(d._getDependencies(),a.body)})};b.prototype.createMap=function(a,d){var c=this,p={};"undefined"!==typeof a&&(p.purpose=a);"undefined"!==typeof d&&(p.context=d);return this._network.post(this._config.mapsUri,p).then(function(a){return new G(c._getDependencies(),a.body)})};
b.prototype.openMap=function(a){var d=this;return this._network.get(a).then(function(a){if("map"!==a.body.type)throw Error("Unexpected data type: "+a.body.type);return new G(d._getDependencies(),a.body)})};b.prototype.setAuthToken=function(a){f.info("DSS I: authTokenUpdated");this._config.updateToken(a)};Object.freeze(b);l.exports=b},{"./configuration.js":3,"./dataentity.js":4,"./datamap.js":5,"./datastream.js":6,"./network.js":7,"./router.js":8,"./subscriptions.js":9,events:40,loglevel:71,util:69}],
2:[function(g,l,h){function b(b){var e=this;Object.defineProperties(this,{_id:{value:b.id,writable:!1},_uri:{value:b.uri,writable:!1},_value:{value:b.value,writable:!0},id:{get:function(){return e._id}},uri:{get:function(){return e._uri}},value:{get:function(){return e._value}}})}b.prototype._update=function(b){this._value=b};b.prototype.getEntityId=function(){return this.id};b.prototype.getEntityUri=function(){return this.uri};b.prototype.getValue=function(){return this.value};l.exports=b},{}],3:[function(g,
l,h){function b(b){var e=this;Object.defineProperties(this,{_subscriptionsUri:{value:"https://cds.us1.twilio.com/v1/subscriptions"},_entitiesUri:{value:"https://cds.us1.twilio.com/v2/Entities"},_streamsUri:{value:"https://cds.us1.twilio.com/v2/Streams"},_mapsUri:{value:"https://cds.us1.twilio.com/v2/Maps"},_token:{value:b,writable:!0},token:{enumerable:!0,get:function(){return e._token}},subscriptionsUri:{enumerable:!0,get:function(){return e._subscriptionsUri}},entitiesUri:{enumerable:!0,get:function(){return e._entitiesUri}},
streamsUri:{enumerable:!0,get:function(){return e._streamsUri}},mapsUri:{enumerable:!0,get:function(){return e._mapsUri}}});this.getToken=function(){return this._token};this.getSubscriptionsUri=function(){return this._subscriptionsUri};this.getEntitiesUri=function(){return this._entitiesUri};this.getStreamsUri=function(){return this._streamsUri}}b.prototype.updateToken=function(b){this._token=b};l.exports=b},{}],4:[function(g,l,h){function b(c,a){var d=this;Object.defineProperties(this,{_config:{value:c.config},
_datasync:{value:c.datasync},_network:{value:c.network},_router:{value:c.router},_pendingListeners:{value:{}},_isSynced:{value:!0,writable:!0},_links:{value:a.links},_entityId:{value:a.entity_id},_revision:{value:a.entity_revision,writable:!0},_data:{value:a.data,writable:!0},uri:{get:function(){return d._links.entity}},id:{get:function(){return d._entityId}},revision:{get:function(){return d._revision}}});f.call(this);this._initialize()}var f=g("events").EventEmitter;h=g("util").inherits;var e=g("../../util/jsondiff"),
k=g("loglevel");h(b,f);b.prototype._initialize=function(){var c=this;["keyAdded","keyRemoved","keyUpdated"].forEach(function(a){c._pendingListeners[a]={};c.on(a,function(d,c){(this._pendingListeners[a][d]||[]).forEach(function(a){a(c)});this._pendingListeners[a][d]=[]})})};b.prototype._update=function(c){switch(c.type){case "entity_update":var a=this._data;this._revision=c.entity_revision;this._data=c.data;this._traverse(a,c.data);this.emit("updated",c.data);break;case "entity_delete":this.emit("deleted")}};
b.prototype._traverse=function(c,a){e.diff(c,a).forEach(function(a){"add"===a.op?this.emit("keyAdded",a.path,a.value):"replace"===a.op?this.emit("keyUpdated",a.path,a.value):"remove"===a.op&&this.emit("keyRemoved",a.path)}.bind(this))};b.prototype._resolveConflict=function(c){return c&&"function"===typeof c?new Promise(function(a,d){var b=this._revision,e=this._data,f=function(a){this._revision=b;this._data=e;d(a)}.bind(this);this.forceSync().then(function(){c({localData:e,remoteData:this._data,resolve:a,
reject:f})}.bind(this))}.bind(this)):Promise.reject(Error("Can't resolve conflict"))};b.prototype.subscribe=function(){return this._router.subscribe(this.uri,this)};b.prototype.unsubscribe=function(){return this._router.unsubscribe(this.uri,this)};b.prototype.getData=function(){return this._data};b.prototype.setData=function(c){this._data=c;this._isSynced=!1};b.prototype._pushChangesInternal=function(c,a){return this._network.put(this.uri,{data:this._data},this._revision).then(function(a){var b=a.body.entity_revision;
k.debug("DSS: entity updated: ",a," new revision is: ",b);c(a);this._router.emulateUpdate(this,this.uri,{revision:b,data:this._data})}.bind(this))["catch"](a)};b.prototype.pushChanges=function(c){return new Promise(function(a,d){var b=function(d){this.setData(d);setTimeout(function(){this._pushChangesInternal(a,e)}.bind(this),0)}.bind(this),e=function(a){412===a.status?(k.info("DSS I: version conflict detected!"),this._resolveConflict(c).then(b)["catch"](d)):(k.error("DSS E: failed to push local changes to server: ",
a),d(a))}.bind(this);this._pushChangesInternal(a,e)}.bind(this))};b.prototype.softSync=function(){var c=this;return this._network.get(this.uri).then(function(a){c._update({entity_revision:a.body.entity_revision,type:"entity_update",data:a.body.data});return c})};b.prototype.forceSync=function(){var c=this;return this._network.get(this.uri).then(function(a){c._revision=a.body.entity_revision;c._data=a.body.data;return c})["catch"](function(a){k.error("DSS E: failed to get entity: ",a)})};b.prototype.addEventHandler=
function(c,a,d){var b=this._pendingListeners[c][a]||[];b.push(d);this._pendingListeners[c][a]=b};b.prototype.value=function(c){try{var a=c.replace(/^\/|\/$/gm,"").split("/"),d=this.getData();a.forEach(function(a){d=d[a]});return d}catch(b){}};b.prototype.update=function(c,a){for(var d=c.replace(/^\/|\/$/gm,"").split("/").filter(function(a){return""!==a}),b=!0,e=this.getData(),f=0;f<d.length;++f)if(e=e[d[f]],void 0===e){b=!1;break}if(b){if(typeof e!==typeof a)return k.error("Can't have different type when updating the value!"),
!1;switch(typeof a){case "object":for(var g in a)e[g]=a[g];break;default:e=a}this._isSynced=!1;return!0}return!1};Object.freeze(b);l.exports=b},{"../../util/jsondiff":32,events:40,loglevel:71,util:69}],5:[function(g,l,h){function b(c,a){var d=this;Object.defineProperties(this,{_deps:{value:c},_descriptor:{value:a},_cacheState:{value:{ensured:!1}},_links:{get:function(){return d._descriptor.links}},_revision:{value:a.revision,writable:!0},_context:{writable:!0},_entities:{value:new Map},uri:{enumerable:!0,
get:function(){return d._descriptor.links.collection}},entitiesUri:{get:function(){return d._descriptor.links.entities}},revision:{enumerable:!0,get:function(){return d._revision}}});f.call(this)}var f=g("events").EventEmitter;h=g("util").inherits;var e=g("../../util");g("loglevel");var k=g("./collectionentity");h(b,f);b.prototype._uriForKey=function(c){return this._links.entities+"?id="+c};b.prototype._tryPostOrUpdate=function(c,a){var d=this;return new Promise(function(b,e){d._deps.network.post(c,
a).then(function(a){return b({uri:a.body.links.entity})})["catch"](function(c){if(409===c.status){var f=function(){var f=void 0;try{f=JSON.parse(c.body).links.entity}catch(k){e(Error("Failed to update existing entity due to incorrect server response"))}return{v:d._deps.network.put(f,a).then(function(a){return b({uri:f})})["catch"](e)}}();if("object"===typeof f)return f.v}else e(c)})})};b.prototype._queryEvents=function(){var c=this;return this._deps.network.get(this._links.events+"?from="+this._revision+
"&limit=100").then(function(a){a.body.results.forEach(function(a){return c._update(a)})})};b.prototype.getContext=function(){var c=this;if("undefined"!==typeof this._context)return Promise.resolve(this._context);this._deps.network.get(this._links.context).then(function(a){c._context=a.body.data;resolve(c._context)})};b.prototype.updateContext=function(c){var a=this;return this._deps.network.put(this._links.context,{data:c}).then(function(d){a._context=c;a.emit("contextUpdated",c)})};b.prototype.subscribe=
function(c){return this._deps.router.subscribe(this._links.collection,this)};b.prototype.unsubscribe=function(c){return this._deps.router.unsubscribe(this._links.collection,this)};b.prototype.set=function(c,a){var d=this,b=this._entities.get(c);if("undefined"!==typeof b){var e=b.uri;return this._deps.network.put(e,{data:a}).then(function(d){b._update(a)})}e=this._uriForKey(c);return this._tryPostOrUpdate(e,{data:a}).then(function(b){b=new k({id:c,uri:b.uri,value:a});d._entities.set(c,b)})};b.prototype.get=
function(c){return new Promise(function(a,d){var b=this;if(this._entities.has(c))a(this._entities.get(c));else{var e=this._uriForKey(c);this._deps.network.get(e).then(function(e){(e=e.body.results.find(function(a){return a.entity_id===c}))?(e=new k({id:e.entity_id,uri:e.links.entity,value:e.data}),b._entities.set(c,e),a(e)):d(Error("Entity not found"))})}}.bind(this))};b.prototype.remove=function(c){var a=this;this._uriForKey(c);return this.get(c).then(function(d){return a._deps.network["delete"](d.uri)}).then(function(){a._entities["delete"](c)})};
b.prototype.query=function(c,a,d){var b=this;a=a||50;d=d||"forward";c=(new e.UriBuilder(this._links.entities)).arg("from",c).arg("limit",a).arg("direction",d).build();return this._deps.network.get(c).then(function(a){a=a.body.results.map(function(a){return new k({id:a.entity_id,uri:a.links.entity,value:a.data})});a.forEach(function(a){return b._entities.set(a.id,a)});return a})};b.prototype.softSync=function(){this._queryEvents()};b.prototype.forEach=function(c){var a=this;return new Promise(function(d,
b){a._cacheState.ensured?(a._entities.forEach(c),d()):function(){(function m(d,b,e){var p=50,f=!1;"undefined"!==typeof d&&(p+=1,f=!0);a.query(d,p,"forward").then(function(a){f&&a.shift();return a}).then(function(a){a.forEach(function(a){c(a)});return a}).then(function(a){50===a.length?function(){var d=a[a.length-1].id;setTimeout(function(){return m(d,b,e)})}():e()})})(void 0,c,function(){a._cacheState.ensured=!0;d()})}()})};b.prototype._update=function(c){switch(c.type){case "entity_create":this._handleEntityAdded(c.entity_id,
c.links.entity,c.data);break;case "entity_update":this._handleEntityUpdated(c.entity_id,c.links.entity,c.data);break;case "entity_delete":this._handleEntityRemoved(c.entity_id,c.links.entity,c.data);break;case "context_update":this._handleContextUpdate(c.data);break;case "collection_delete":this.emit("deleted")}this._revision===c.event_id-1&&(this._revision=c.event_id)};b.prototype._handleEntityAdded=function(c,a,d){this._entities.has(c)||(a=new k({id:c,uri:a,value:d}),this._entities.set(c,a),this.emit("entityAdded",
a))};b.prototype._handleEntityUpdated=function(c,a,d){a=new k({id:c,uri:a,value:d});this._entities.set(c,a);this.emit("entityUpdated",a)};b.prototype._handleEntityRemoved=function(c){this._entities.has(c)&&(this._entities["delete"](c),this.emit("entityRemoved",c))};b.prototype._handleContextUpdate=function(c){this._context=c;this.emit("contextUpdated",c)};Object.freeze(b);l.exports=b},{"../../util":31,"./collectionentity":2,events:40,loglevel:71,util:69}],6:[function(g,l,h){function b(a,d){var c=
this;Object.defineProperties(this,{_config:{value:a.config,writable:!1},_deps:{value:a,writable:!1},_descriptor:{value:d},_links:{get:function(){return c._descriptor.links}},_context:{writable:!0},_revision:{value:d.revision,writable:!0},_entities:{value:new Map,writable:!1},uri:{enumerable:!0,get:function(){return c._descriptor.links.collection}},entitiesUri:{get:function(){return c._descriptor.links.entities}},revision:{enumerable:!0,get:function(){return c._revision}}});f.call(this)}var f=g("events").EventEmitter;
h=g("util").inherits;var e=g("../../util"),k=g("loglevel"),c=g("./collectionentity");h(b,f);b.prototype._uriForKey=function(a){return this._links.entities+"/"+a};b.prototype.subscribe=function(){return this._deps.router.subscribe(this._links.collection,this)};b.prototype.unsubscribe=function(){return this._deps.router.unsubscribe(this._links.collection,this)};b.prototype.add=function(a){var d=this;return this._deps.network.post(this._links.entities,{data:a}).then(function(b){b=new c({id:b.body.entity_id,
uri:b.body.links.entity,value:a});d._entities.set(b.id,b);return b.id})};b.prototype.remove=function(a){a=this._uriForKey(a);this._deps.network["delete"](a).then(function(a){})};b.prototype.update=function(a,d){var c=this._uriForKey(a);this._deps.network.put(c,{data:d}).then(function(a){})};b.prototype.get=function(a){var d=this;if(this._entities.has(a))return Promise.resolve(this._entities.get(a));var b=this._uriForKey(a);return this._deps.network.get(b).then(function(a){a=new c({id:a.body.entity_id,
uri:b,value:a.body.data});d._entities.set(a.id,a);return a})};b.prototype._queryEvents=function(){var a=this;this._deps.network.get(this._links.events+"?from="+this._revision+"&limit=100").then(function(d){d.body.results.forEach(function(d){return a._update(d)})})};b.prototype.queryEntities=function(a,d,b,f){var k=this;a=(new e.UriBuilder(this._links.entities)).arg("direction",a).arg("from",d).arg("limit",b).arg("order",f).build();return this._deps.network.get(a).then(function(a){a=a.body.results.map(function(a){return new c({id:a.entity_id,
uri:a.links.entity,value:a.data})});a.forEach(function(a){return k._entities.set(a.id,a)});return a})};b.prototype.queryEntitiesBefore=function(a,d,c){return this.queryEntities("backwards",a,d,c)};b.prototype.queryLastEntities=function(a,d){return this.queryEntitiesBefore("end",a,d)};b.prototype.getContext=function(){var a=this;return"undefined"!==typeof this._context?Promise.resolve(this._context):this._deps.network.get(this._links.context).then(function(d){a._context=d.body.data;return a._context})};
b.prototype.updateContext=function(a){var d=this;return this._deps.network.put(this._links.context,{data:a}).then(function(){d._context=a;d.emit("contextUpdated",a)})["catch"](function(a){k.error("Failed to update context",a);throw a;})};b.prototype.softSync=function(){this._queryEvents()};b.prototype._update=function(a){switch(a.type){case "entity_create":this._handleEntityAdded(a.entity_id,a.links.entity,a.data);break;case "entity_update":this._handleEntityUpdated(a.entity_id,a.links.entity,a.data);
break;case "entity_delete":this._handleEntityRemoved(a.entity_id,a);break;case "context_update":this._handleContextUpdate(a.data);break;case "collection_delete":this.emit("deleted")}this._revision===a.event_id-1&&(this._revision=a.event_id)};b.prototype._handleEntityAdded=function(a,d,b){this._entities.has(a)||(d=new c({id:a,uri:d,value:b}),this._entities.set(a,d),this.emit("entityAdded",d))};b.prototype._handleEntityUpdated=function(a,d,b){d=new c({id:a,uri:d,value:b});this._entities.set(a,d);this.emit("entityUpdated",
d)};b.prototype._handleEntityRemoved=function(a){this._entities.has(a)&&(this._entities["delete"](a),this.emit("entityRemoved",a))};b.prototype._handleContextUpdate=function(a){this._context=a;this.emit("contextUpdated",a)};Object.freeze(b);l.exports=b},{"../../util":31,"./collectionentity":2,events:40,loglevel:71,util:69}],7:[function(g,l,h){function b(b,e){var k=this;Object.defineProperties(this,{_config:{value:b},_transport:{value:e},_headers:{get:function(){return k._getHeaders()}}})}b.prototype._getHeaders=
function(){return{"Content-Type":"application/json","X-Twilio-Token":this._config.token}};b.prototype.get=function(b){return this._transport.get(b,this._headers)};b.prototype.post=function(b,e){return this._transport.post(b,this._headers,e)};b.prototype.put=function(b,e,k){if("undefined"===typeof k)throw Error("Can't make a PUT operation with undefined revision");return this._transport.put(b,{"Content-Type":"application/json","X-Twilio-Token":this._config.token,"If-Match":k},e)};b.prototype["delete"]=
function(b){return this._transport["delete"](b,this._headers)};Object.freeze(b);l.exports=b},{}],8:[function(g,l,h){function b(b){Object.defineProperties(this,{_config:{value:b.config},_subscriptions:{value:b.subscriptions}})}var f=g("../../util"),e=g("loglevel");b.prototype.onMessage=function(b,c){e.trace("DSS I: message ",b,": ",c);if("com.twilio.rtd.cds.entity"===b){var a=c.event.links.entity;this._subscriptions.getSubscribers(a).forEach(function(a){var b=f.deepClone(c);a._update(b.event)})}else if("com.twilio.rtd.cds.stream"===
b||"com.twilio.rtd.cds.map"===b)a=c.collection.links.collection,this._subscriptions.getSubscribers(a).forEach(function(a){var b=f.deepClone(c);a._update(b.event)})};b.prototype.emulateUpdate=function(b,c,a){this._subscriptions.getSubscribers(c).forEach(function(d){if(d!==b){var c=f.deepClone(a);d._update(c)}})};b.prototype.subscribe=function(b,c){return this._subscriptions.add(b,c).then(function(a){a&&c.softSync()})};b.prototype.unsubscribe=function(b,c){return this._subscriptions.remove(b,c).then(function(){})};
b.prototype.onConnected=function(){this._subscriptions.forEach(function(b,c){c.softSync()})};l.exports=b},{"../../util":31,loglevel:71}],9:[function(g,l,h){function b(b,f){Object.defineProperties(this,{_config:{value:b},_network:{value:f},_subscriptions:{value:new Map},_serverSubscriptions:{value:new Map}})}var f=g("loglevel");b.prototype._subscribeOnServer=function(b){var k=this;return this._network.post(this._config.subscriptionsUri,{subscription:{objectUrl:b,channelType:"twilsock"}}).then(function(c){f.debug("DSS I: subscribed: ",
c.headers.Location);if(!c.headers.Location)throw Error("Location header is absent or inaccessible");k._serverSubscriptions.set(b,c.headers.Location);return!0})["catch"](function(c){f.error("DSS E: subscription failed: ",c);throw c;})};b.prototype._unsubscribeOnServer=function(b){var k=this,c=this._serverSubscriptions.get(b);if(!c)throw Error("No such subscription");return this._network["delete"](c).then(function(a){f.debug("DSS I: subscription deleted: ",a);k._serverSubscriptions["delete"](b);return!0})["catch"](function(a){if(404===
a.status)return f.debug("DSS I: subscription is already deleted"),!0;f.error("DSS E: delete subscription failed: ",a);throw a;})};b.prototype.add=function(b,f){var c=this;if(this._subscriptions.has(b))return this._subscriptions.get(b).add(f),Promise.resolve(!1);var a=function(){var a=new Set;a.add(f);return{v:c._subscribeOnServer(b).then(function(){c._subscriptions.set(b,a);return!0})}}();if("object"===typeof a)return a.v};b.prototype.remove=function(b,f){if(this._subscriptions.has(b)){if(this._subscriptions.get(b).has(f)){var c=
this._subscriptions.get(b);c["delete"](f);if(0<c.size)return this._subscriptions.set(b,c),Promise.resolve(!1);this._subscriptions["delete"](b);return this._unsubscribeOnServer(b)}return Promise.resolve(!1)}return Promise.resolve(!0)};b.prototype.getSubscribers=function(b){return(b=this._subscriptions.get(b))?b:new Set};b.prototype.forEach=function(b){this._subscriptions.forEach(function(f,c){f.forEach(function(a){return b(c,a)})})};l.exports=b},{loglevel:71}],10:[function(g,l,h){function b(a,d,p){var k=
this;if(!(this instanceof b))return new b(a,d,p);var g=d.attributes||{},h=d.name||d.friendlyName,l=d.uniqueName||null,q=d.type||b.type.PUBLIC,D=d.channelUrl;d.isPrivate&&(q=b.type.PRIVATE);try{JSON.stringify(g)}catch(r){throw Error("Attributes must be a valid JSON object.");}d=new Map;var n=new e(this,a,d);n.on("memberJoined",this.emit.bind(this,"memberJoined"));n.on("memberLeft",this.emit.bind(this,"memberLeft"));var x=[],z=new c(this,a,x);z.on("messageAdded",this.emit.bind(this,"messageAdded"));
z.on("messageUpdated",this.emit.bind(this,"messageUpdated"));z.on("messageRemoved",this.emit.bind(this,"messageRemoved"));Object.defineProperties(this,{_entityPromise:{value:null,writable:!0},_lastTypingUpdate:{value:0,writable:!0},_membersEntity:{value:n},_messagesEntity:{value:z},_session:{value:a},_uri:{value:D,writable:!0},attributes:{enumerable:!0,value:g,writable:!0},friendlyName:{enumerable:!0,value:h,writable:!0},uniqueName:{enumerable:!0,value:l,writable:!0},isPrivate:{enumerable:!0,get:function(){return k.type===
b.type.PRIVATE}},members:{enumerable:!0,value:d},messages:{enumerable:!0,value:x},sid:{enumerable:!0,value:p,writable:!0},status:{enumerable:!0,value:"known",writable:!0},type:{enumerable:!0,value:q,writable:!0}});f.call(this)}var f=g("events").EventEmitter;h=g("util").inherits;var e=g("./data/members"),k=g("./member"),c=g("./data/messages"),a=g("../../util/jsondiff"),d=g("loglevel"),p={attributes:"attributes",name:"friendlyName",uniqueName:"uniqueName",friendlyName:"friendlyName",sid:"sid",status:"status",
type:"type"};h(b,f);b.type={PUBLIC:"public",PRIVATE:"private"};b.status={KNOWN:"known",INVITED:"invited",JOINED:"joined",FAILED:"failed"};Object.freeze(b.type);Object.freeze(b.status);b.prototype._subscribe=function(){var a=this;return this._entityPromise?this._entityPromise:this._entityPromise=this._session.datasync.openEntity(this._uri).then(function(d){a._entity=d;d.subscribe();d.on("updated",function(d){a._update(d)});a._update(d.getData());var c=d.value("/messagesUrl");d=d.value("/rosterUrl");
var b=[];b.push(a._messagesEntity.subscribe(c).then(function(){return a._messagesEntity.getMessages()}));b.push(a._membersEntity.subscribe(d));return Promise.all(b)}).then(function(){return a._entity})};b.prototype._unsubscribe=function(){var a=[];this._entity&&a.push(this._entity.unsubscribe());a.push(this._membersEntity.unsubscribe());a.push(this._messagesEntity.unsubscribe());this._entityPromise=null;return Promise.all(a)};b.prototype._setStatus=function(a){this.status!==a&&(this.status=a,"joined"===
a||"invited"===a?this._subscribe():this._entity&&this._unsubscribe())};b.prototype._update=function(c){try{"string"===typeof c.attributes?c.attributes=JSON.parse(c.attributes):c.attributes&&JSON.stringify(c.attributes)}catch(b){d.warn("Retrieved malformed attributes from the server for channel: "+this.sid),c.attributes={}}var e=!1,f;for(f in c){var k=p[f];k&&k===p.attributes?a.isDeepEqual(this.attributes,c.attributes)||(this.attributes=c.attributes,e=!0):k&&this[k]!==c[f]&&(this[k]=c[f],e=!0)}!c.uniqueName&&
this.uniqueName&&(this.uniqueName=null,e=!0);e&&this.emit("updated",this)};b.prototype.add=function(a){if("string"!==typeof a||!a.length)throw Error("Channel.add requires an <String>identity parameter");return this._membersEntity.add(a)};b.prototype.decline=function(){var a=this;return this._session.addCommand("declineInvitation",{channelSid:this.sid}).then(function(){return a})};b.prototype["delete"]=function(){var a=this;return this._session.addCommand("destroyChannel",{channelSid:this.sid}).then(function(){return a})};
b.prototype.invite=function(a){if("string"!==typeof a||!a.length)throw Error("Channel.invite requires an <String>identity parameter");return this._membersEntity.invite(a)};b.prototype.getAttributes=function(){var a=this;return this._subscribe().then(function(){return a.attributes})};b.prototype.getMessages=function(a,d){var c=this;return this._subscribe().then(function(){return c._messagesEntity.getMessages(a,d)})};b.prototype.getMembers=function(){var a=this;return this._subscribe().then(function(){return a._membersEntity.getMembers()})};
b.prototype.join=function(){var a=this;return this._session.addCommand("joinChannel",{channelSid:this.sid}).then(function(){return a})};b.prototype.leave=function(){var a=this;return this.status!==b.status.JOINED?Promise.resolve(this):this._session.addCommand("leaveChannel",{channelSid:this.sid}).then(function(){return a})};b.prototype.removeMember=function(a){if(!a||"string"!==typeof a&&!(a instanceof k))throw Error("Channel.removeMember requires a <String|Member>member parameter.");return this._membersEntity.remove("string"===
typeof a?a:a.identity)};b.prototype.sendMessage=function(a){return this._messagesEntity.send(a)};b.prototype.typing=function(){if(this._lastTypingUpdate>Date.now()-this._session.typingTimeout)return Promise.resolve();this._lastTypingUpdate=Date.now();return this._session.sendTypingIndicator(this.sid)};b.prototype.updateAttributes=function(a){var d=this;if("undefined"===typeof a)throw Error("Attributes is a required parameter for updateAttributes");if(a.constructor!==Object)throw Error("Attributes must be a valid JSON object.");
return this._session.addCommand("editAttributes",{channelSid:this.sid,attributes:JSON.stringify(a)}).then(function(){return d})};b.prototype.updateFriendlyName=function(a){var d=this;return this.friendlyName===a?Promise.resolve(this):this._session.addCommand("editFriendlyName",{channelSid:this.sid,friendlyName:a}).then(function(){return d})};b.prototype.updateUniqueName=function(a){var d=this;return this.uniqueName===a?Promise.resolve(this):this._session.addCommand("editUniqueName",{channelSid:this.sid,
uniqueName:a}).then(function(){return d})};b.prototype.updateType=function(a){if(a!==b.type.PRIVATE&&a!==b.type.PUBLIC)throw Error("Can't set unknown channel type "+a);if(this.type!==a)throw Error("Changing of channel type isn't supported");return Promise.resolve(this)};Object.freeze(b);l.exports=b},{"../../util/jsondiff":32,"./data/members":14,"./data/messages":15,"./member":16,events:40,loglevel:71,util:69}],11:[function(g,l,h){function b(c,b){var g=this;b=b||{};b.logLevel=b.logLevel||"error";e.setDefaultLevel(b.logLevel);
"string"===typeof c&&(c=new v(c));if(!c||!c.token)throw Error("A valid Twilio AccessManager or Capability Token must be passed to IPMessaging Client");var h=c.token,q=b.twilsockClient||new G(h),l=b.transportClient||new m(q),n=b.notificationClient||new p(h,l,q,{twilsockUri:b.wsServer}),l=b.dataSyncClient||new d(h,n,l),x=new k(l,h),z=x.initialize(),r=new Map,y=new a(x,r),B=z.then(function(){y.on("channelAdded",g.emit.bind(g,"channelAdded"));y.on("channelRemoved",g.emit.bind(g,"channelRemoved"));y.on("channelInvited",
g.emit.bind(g,"channelInvited"));y.on("channelJoined",g.emit.bind(g,"channelJoined"));y.on("channelLeft",g.emit.bind(g,"channelLeft"));y.on("channelUpdated",g.emit.bind(g,"channelUpdated"));return y.fetchChannels(x)});c.on("tokenExpired",function(){return g.emit("tokenExpired",c)});c.on("tokenUpdated",function(){return g._updateToken(c.token)});Object.defineProperties(this,{_channelsPromise:{value:B},_datasync:{value:l},_notification:{value:n},_session:{value:x},_sessionPromise:{value:z},_token:{value:h},
_twilsock:{value:q},accessManager:{enumerable:!0,value:c},channels:{enumerable:!0,value:r},identity:{enumerable:!0,get:function(){return c.identity}}});this._initialize(b.typingTimeout||5E3);f.call(this)}var f=g("events").EventEmitter;h=g("util").inherits;var e=g("loglevel"),k=g("./session.js"),c=g("./channel.js"),a=g("./data/channels.js"),d=g("../datasync/client"),p=g("../notification/client"),G=g("../twilsock/client"),m=g("../transport"),v=g("twilio-common").AccessManager;g=g("../../../package.json").version;
b.version=g;h(b,f);b.prototype._initialize=function(a){var d=this;return this._sessionPromise.then(function(){d._notification.subscribe("twilio.ipmsg.typing_indicator","twilsock");d._notification.subscribe("twilio.channel.new_message","gcm");d._notification.subscribe("twilio.channel.added_to_channel","gcm");d._notification.on("message",function(c,b){"twilio.ipmsg.typing_indicator"===c&&(e.trace("Got new typing indicator push!"),e.trace(b),d._channelsPromise.then(function(a){return a.channels.get(b.channel_sid)}).then(function(d){var c=
!0,e=!1,p=void 0;try{for(var f=d.members.values()[Symbol.iterator](),k;!(c=(k=f.next()).done);c=!0){var G=k.value;if(G.identity===b.identity){G._startTyping(a);break}}}catch(g){e=!0,p=g}finally{try{if(!c&&f["return"])f["return"]()}finally{if(e)throw p;}}})["catch"](function(a){e.error("IMPSG E: ",a);throw a;}))})})};b.prototype._updateToken=function(a){var d=this;if(!a||3!==a.split(".").length)return e.error("Received a malformed token from AccessManager.       Token not updated in IP MessagingClient.");
if(a===this._token)return Promise.resolve(this);this._token=a;e.info("IPMSG I: authTokenUpdated");return Promise.all([this._twilsock.setAuthToken(a),this._notification.setAuthToken(a),this._datasync.setAuthToken(a),this._sessionPromise.then(function(){return d._session.updateToken(a)})]).then(function(){return d})};b.prototype.getChannelBySid=function(a){var d=this;if(!a||"string"!==typeof a)throw Error("Client.getChannelBySid requires a <String>channelSid parameter");return this._channelsPromise.then(function(){return d.channels.get(a)})};
b.prototype.getChannelByUniqueName=function(a){var d=this;if(!a||"string"!==typeof a)throw Error("Client.getChannelByUniqueName requires a <String>uniqueName parameter");return this._channelsPromise.then(function(){var c=!0,b=!1,e=void 0;try{for(var p=d.channels.values()[Symbol.iterator](),f;!(c=(f=p.next()).done);c=!0){var k=f.value;if(k.uniqueName===a)return k}}catch(G){b=!0,e=G}finally{try{if(!c&&p["return"])p["return"]()}finally{if(b)throw e;}}})};b.prototype.getChannels=function(){var a=this;
return this._channelsPromise.then(function(){var d=[];a.channels.forEach(function(a){return d.push(a)});return d})};b.prototype.createChannel=function(a){a=a||{};var d=new c(this._session,a,null);return this._channelsPromise.then(function(a){return a.addChannel(d)})};Object.freeze(b);l.exports=b},{"../../../package.json":76,"../datasync/client":1,"../notification/client":19,"../transport":23,"../twilsock/client":24,"./channel.js":10,"./data/channels.js":13,"./session.js":18,events:40,loglevel:71,
"twilio-common":74,util:69}],12:[function(g,l,h){l.exports={typingIndicatorUri:"https://aim.us1.twilio.com/v1/typing",typingIndicatorTimeout:5}},{}],13:[function(g,l,h){function b(b,c){Object.defineProperties(this,{_session:{value:b},channels:{enumerable:!0,value:c}});f.call(this)}var f=g("events").EventEmitter;h=g("util").inherits;var e=g("../channel");h(b,f);b.prototype.addChannel=function(b){var c=this;return this._session.addCommand("createChannel",{friendlyName:b.friendlyName,uniqueName:b.uniqueName,
type:b.isPrivate?"private":"public",attributes:JSON.stringify(b.attributes)}).then(function(a){var d=c.channels.get(b.sid);if(d)return d._update(b),d;b.sid=a.channelSid;b._uri=a.channelUrl;c.channels.set(b.sid,b);b.on("updated",function(){return c.emit("channelUpdated",b)});return b._subscribe().then(function(){c.emit("channelAdded",b);return b})})};b.prototype.fetchChannels=function(b){var c=this;return new Promise(function(a,d){function e(){h=!0;c._fetchPublicChannels(g).then(function(){return c._fetchMyChannels(f)}).then(function(){a(c)},
function(a){d(a)})}var f=b.getMyChannelsUrl(),g=b.getChannelsUrl(),h=!1;b.onKeyUpdated("/channelsUrl",function(a){g=a;f&&!h&&e()});b.onKeyUpdated("/myChannelsUrl",function(a){f=a;g&&!h&&e()})})};b.prototype._fetchMyChannels=function(b){var c=this;return this._session.datasync.openMap(b).then(function(a){a.subscribe();a.on("entityAdded",function(a){var d=a.getEntityId();c._upsertChannel(d,a.getValue())});a.on("entityRemoved",function(a){var d=c.channels.get(a);if(d){if("joined"===d.status||"invited"===
d.status)d._setStatus("known"),c.emit("channelLeft",d);d.isPrivate&&(c.channels["delete"](a),c.emit("channelRemoved",d))}});a.on("entityUpdated",function(a){var d=a.getEntityId();c._upsertChannel(d,a.getValue())});var d=[];return a.forEach(function(a){var b=a.getValue();a=a.getEntityId();d.push(c._upsertChannel(a,b))}).then(function(){return Promise.all(d)}).then(function(){return c})})};b.prototype._fetchPublicChannels=function(b){var c=this;return this._session.datasync.openMap(b).then(function(a){a.subscribe();
a.on("entityAdded",function(a){var b=a.getEntityId(),f=c.channels.get(b);f||(f=new e(c._session,a.getValue(),b),f.on("updated",function(){return c.emit("channelUpdated",f)}),c.channels.set(b,f),c.emit("channelAdded",f))});a.on("entityRemoved",function(a){var b=c.channels.get(a);if(b){if("joined"===b.status||"invited"===b.status)b._unsubscribe(),c.emit("channelLeft",b);c.channels["delete"](a);c.emit("channelRemoved",b)}});a.on("entityUpdated",function(a){var b=a.getEntityId();c._upsertChannel(b,a.getValue())});
return a.forEach(function(a){var b=a.getValue();a=a.getEntityId();var f=new e(c._session,b,a);f.on("updated",function(){return c.emit("channelUpdated",f)});c.channels.set(a,f)}).then(function(){return c})})};b.prototype._upsertChannel=function(b,c){var a=this,d=this.channels.get(b);if(d)return"joined"===c.status&&"joined"!==d.status?(d._setStatus("joined"),this.emit("channelJoined",d)):"invited"===c.status&&"invited"!==d.status?(d._setStatus("invited"),this.emit("channelInvited",d)):"known"!==c.status||
"invited"!==d.status&&"joined"!==d.status?"notParticipating"===c.status&&"private"===c.type?d._subscribe():d._update(c):(d._setStatus("known"),d._update(c),this.emit("channelLeft",d)),Promise.resolve(d);d=new e(this._session,c,b);d.on("updated",function(){return a.emit("channelUpdated",d)});this.channels.set(b,d);return d._subscribe().then(function(){"joined"===c.status?(d._setStatus("joined"),a.emit("channelJoined",d)):"invited"===c.status&&(d._setStatus("invited"),a.emit("channelInvited",d));a.emit("channelAdded",
d);return d})};l.exports=b},{"../channel":10,events:40,util:69}],14:[function(g,l,h){function b(b,c,a){Object.defineProperties(this,{_datasync:{value:c.datasync},_session:{value:c},_rosterStreamPromise:{writable:!0,value:null},channel:{enumerable:!0,value:b},members:{enumerable:!0,value:a}});f.call(this)}var f=g("events").EventEmitter;h=g("util").inherits;var e=g("../member");h(b,f);b.prototype.unsubscribe=function(){return this._rosterStreamPromise?this._rosterStreamPromise.then(function(b){return b.unsubscribe()}):
Promise.resolve()};b.prototype.subscribe=function(b){var c=this;return this._rosterStreamPromise=this._datasync.openMap(b).then(function(a){a.subscribe();a.on("entityAdded",function(a){var b=a.getEntityId();c.members.has(b)||(a=c.upsertMember(b,a.getValue()),c.emit("memberJoined",a))});a.on("entityRemoved",function(a){if(c.members.has(a)){var b=c.members.get(a);c.members["delete"](a);c.emit("memberLeft",b)}});a.on("entityUpdated",function(a){var b=a.getEntityId();c.members.has(b)&&(a=c.upsertMember(b,
a.getValue()),c.emit("memberUpdated",a))});return a.forEach(function(a){var b=a.getEntityId();c.members.has(b)||c.upsertMember(b,a.getValue())}).then(function(){return a})})};b.prototype.upsertMember=function(b,c){var a=this.members.get(b);a?a._update(c):(a=new e(this.channel,c.identity,b),this.members.set(b,a));return a};b.prototype.getMembersList=function(){var b=[];this.members.forEach(function(c){return b.push(c)});return b};b.prototype.getMembers=function(){var b=this;return this._rosterStreamPromise.then(function(){var c=
[];b.members.forEach(function(a){return c.push(a)});return c})};b.prototype.add=function(b){return this._session.addCommand("addMember",{channelSid:this.channel.sid,username:b})};b.prototype.invite=function(b){return this._session.addCommand("inviteMember",{channelSid:this.channel.sid,username:b})};b.prototype.remove=function(b){return this._session.addCommand("removeMember",{channelSid:this.channel.sid,username:b})};l.exports=b},{"../member":16,events:40,util:69}],15:[function(g,l,h){function b(b,
a,d){var e=k.defer();Object.defineProperties(this,{_datasync:{value:a.datasync},_deferred:{value:e},_eventStreamPromise:{value:null,writable:!0},_sortedMessages:{value:d},_messagesById:{value:new Map},_session:{value:a},_waitForURI:{value:e.promise},channel:{enumerable:!0,value:b}});f.call(this)}var f=g("events").EventEmitter;h=g("util").inherits;var e=g("../message"),k=g("q");h(b,f);b.prototype.subscribe=function(b){var a=this;this._eventStreamPromise=this._eventStreamPromise||this._datasync.openStream(b).then(function(b){b.on("entityAdded",
function(b){var c=new e(a.channel,b.getEntityId(),b.getValue());a._sortedMessages.push(c);a._messagesById.set(c._entityId,c);c.on("updated",function(){return a.emit("messageUpdated",c)});b=!0;var d=!1,f=void 0;try{for(var k=a.channel.members.values()[Symbol.iterator](),g;!(b=(g=k.next()).done);b=!0){var h=g.value;if(h.identity===c.author){h._endTyping();break}}}catch(l){d=!0,f=l}finally{try{if(!b&&k["return"])k["return"]()}finally{if(d)throw f;}}a.emit("messageAdded",c)});b.on("entityRemoved",function(b){if(b=
a._removeMessageById(b))a._messagesById["delete"](b._entityId),b.removeAllListeners("updated"),a.emit("messageRemoved",b)});b.on("entityUpdated",function(b){var c=a._messagesById.get(b.getEntityId());c&&c._update(b.getValue())});a._deferred.resolve(b);return b});return this._eventStreamPromise.then(function(a){a.subscribe();return a})};b.prototype.unsubscribe=function(){return this._eventStreamPromise?this._eventStreamPromise.then(function(b){return b.unsubscribe()}):Promise.resolve()};b.prototype._removeMessageById=
function(b){for(var a=void 0,d=0;d<this._sortedMessages.length;d++)if(this._sortedMessages[d]._entityId===b){a=this._sortedMessages.splice(d,1)[0];break}return a};b.prototype.send=function(b){return this._session.addCommand("sendMessage",{channelSid:this.channel.sid,text:b})};b.prototype.getMessages=function(b,a){var d=this;b=b||100;return"undefined"===typeof a||(b++,this._sortedMessages.some(function(b){if(b.sid!==a)return!1;a=b._entityId;return!0}))?this._waitForURI.then(function(d){return d.queryEntitiesBefore(a,
b)}).then(function(b){var c=[];b.forEach(function(a){var b=a.getValue(),f=new e(d.channel,a.getEntityId(),b);c.push(f);d._messagesById.set(f._entityId,f);f.on("updated",function(){return d.emit("messageUpdated",f)})});"undefined"!==typeof a&&"end"!==a&&(b=c.pop())&&(d._messagesById["delete"](b._entityId),b.removeAllListeners("messageUpdated"));c.reverse();d._updateSortedMessages();return c}):Promise.reject(Error("Unknown anchor"))};b.prototype._updateSortedMessages=function(){var b=[],a=!0,d=!1,e=
void 0;try{for(var f=this._messagesById.values()[Symbol.iterator](),k;!(a=(k=f.next()).done);a=!0)b.push(k.value)}catch(g){d=!0,e=g}finally{try{if(!a&&f["return"])f["return"]()}finally{if(d)throw e;}}b.sort(function(a,b){return a._entityId-b._entityId});Array.prototype.splice.apply(this._sortedMessages,[0,this._sortedMessages.length].concat(b))};l.exports=b},{"../message":17,events:40,q:72,util:69}],16:[function(g,l,h){function b(e,k,c){if(!(this instanceof b))return new b(e,k,c);var a=!1;Object.defineProperties(this,
{_identity:{get:function(){return k},set:function(a){return k=a}},_isTyping:{get:function(){return a},set:function(b){return a=b}},_typingTimeout:{writable:!0,value:null},channel:{enumerable:!0,value:e},identity:{enumerable:!0,get:function(){return k}},isTyping:{enumerable:!0,get:function(){return a}},roleSid:{enumerable:!0,value:null,writable:!0},sid:{enumerable:!0,value:c}});f.call(this)}var f=g("events").EventEmitter;g=g("util").inherits;g(b,f);Object.freeze(b);b.prototype._startTyping=function(b){var f=
this;this._typingTimeout&&clearTimeout(this._typingTimeout);this.emit("typingStarted",this);this.channel.emit("typingStarted",this);this._typingTimeout=setTimeout(function(){return f._endTyping()},b);return this};b.prototype._endTyping=function(){this._typingTimeout&&(this.emit("typingEnded",this),this.channel.emit("typingEnded",this),clearInterval(this._typingTimeout),this._typingTimeout=null)};b.prototype.remove=function(){return this.channel.removeMember(this)};b.prototype._update=function(b){b.roleSid&&
this.roleSid!==b.roleSid&&(this.roleSid=b.roleSid)};l.exports=b},{events:40,util:69}],17:[function(g,l,h){function b(e,k,c){if(!(this instanceof b))return new b(e,k,c);Object.defineProperties(this,{_entityId:{value:k},channel:{enumerable:!0,value:e},author:{enumerable:!0,value:c.author},body:{enumerable:!0,value:c.text,writable:!0},sid:{enumerable:!0,value:c.sid},timestamp:{enumerable:!0,value:new Date(c.timestamp)},dateUpdated:{enumerable:!0,value:c.dateUpdated?new Date(c.dateUpdated):null,writable:!0},
lastUpdatedBy:{enumerable:!0,value:c.lastUpdatedBy?c.lastUpdatedBy:null,writable:!0}});f.call(this)}var f=g("events").EventEmitter;g=g("util").inherits;g(b,f);b.prototype._update=function(b){var f=!1;!b.text&&"string"!==typeof b.text||b.text===this.body||(this.body=b.text,f=!0);b.lastUpdatedBy&&b.lastUpdatedBy!==this.lastUpdatedBy&&(this.lastUpdatedBy=b.lastUpdatedBy,f=!0);b.dateUpdated&&(new Date(b.dateUpdated)).getTime()!==this.dateUpdated.getTime()&&(this.dateUpdated=new Date(b.dateUpdated),f=
!0);f&&this.emit("updated",this)};b.prototype.remove=function(){var b=this;return this.channel._session.addCommand("deleteMessage",{channelSid:this.channel.sid,messageIdx:this._entityId}).then(function(){return b})};b.prototype.updateBody=function(b){var f=this;if("string"!==typeof b)throw Error("Body <String> is a required parameter for updateBody");return this.channel._session.addCommand("editMessage",{channelSid:this.channel.sid,messageIdx:this._entityId,text:b}).then(function(){return f})};l.exports=
b},{events:40,util:69}],18:[function(g,l,h){function b(b,c){Object.defineProperties(this,{_commandQueue:{value:[]},_purpose:{value:"com.twilio.rtd.ipmsg"},_pendingCommands:{value:new Map},_sessionContextChangeTracker:{value:new a},_sessionStreamPromise:{value:null,writable:!0},datasync:{enumerable:!0,value:b},token:{enumerable:!0,value:c,writable:!0},typingTimeout:{value:1E3*k.typingIndicatorTimeout,writable:!0}})}var f=g("../../util/guid"),e=g("loglevel"),k=g("./configuration"),c=g("../../util/request"),
a=g("../../util/changetracker");b.prototype.initialize=function(){var a=this;return this._sessionStreamPromise=this.datasync.createStream(this._purpose,{type:"IpMsgSession",version:"v2",endpointPlatform:"channellib",token:this.token}).then(function(b){e.trace("IPMSG: session created");b.on("entityAdded",function(b){return a._processCommandResponse(b)});b.on("entityUpdated",function(b){return a._processCommandResponse(b)});b.on("contextUpdated",function(b){return a._sessionContextChangeTracker.update(b)});
b.subscribe();return b})["catch"](function(a){e.error("IPMSG: failed to create session",a);throw a;})};b.prototype.addCommand=function(a,b){var c=this;return new Promise(function(f,e){c._commandQueue.push({action:a,params:b,resolve:f,reject:e});c._wakeupQueue()})};b.prototype._wakeupQueue=function(){!this._commandQueueIsActive&&0<this._commandQueue.length&&(this._commandQueueIsActive=!0,this._executeQueue())};b.prototype._executeQueue=function(){var a=this;0===this._commandQueue.length?this._commandQueueIsActive=
!1:setTimeout(function(){var b=a._commandQueue.shift();a._processCommand(b).then(function(c){b.resolve(c);a._executeQueue()})["catch"](function(c){b.reject(c);a._executeQueue()})},0)};b.prototype._processCommand=function(a){var b=this,c={request:a.params};c.request.action=a.action;c.commandId=f();return new Promise(function(a,d){b._sessionStreamPromise.then(function(f){b._pendingCommands.set(c.commandId,{resolve:a,reject:d});f.add(c)})["catch"](function(a){d(Error("Can't add command: "+a.message))})})};
b.prototype._processCommandResponse=function(a){if(a.getValue().hasOwnProperty("response")&&a.getValue().hasOwnProperty("commandId")&&this._pendingCommands.has(a.getValue().commandId)){var b=a.getValue();a=a.getValue().commandId;if(200===b.response.status){e.trace("Command succeeded: ",b);var c=this._pendingCommands.get(a).resolve;this._pendingCommands["delete"](a);c(b.response)}else e.trace("Command failed: ",b),c=this._pendingCommands.get(a).reject,this._pendingCommands["delete"](a),c(Error(JSON.stringify(b)))}};
b.prototype.updateToken=function(a){var b=this;return new Promise(function(c,f){return b._sessionStreamPromise.then(function(b){return b.getContext().then(function(f){f.token=a;return b.updateContext(f).then(c)})})["catch"](function(a){e.error("Couldn't update the token in session context",a);f(Error("Couldn't update the token in session context"))})})};b.prototype.onKeyUpdated=function(a,b){this._sessionContextChangeTracker.addEventHandler("keyAdded",a,b);this._sessionContextChangeTracker.addEventHandler("keyUpdated",
a,b)};b.prototype.getChannelsUrl=function(){var a=this;return new Promise(function(b){a._sessionStreamPromise.then(function(a){return a.getContext()}).then(function(c){if(c.hasOwnProperty("channelsUrl"))b(c.channelsUrl);else a.onKeyUpdated("/channelsUrl",b)})})};b.prototype.getMyChannelsUrl=function(){var a=this;return new Promise(function(b){a._sessionStreamPromise.then(function(a){return a.getContext()}).then(function(c){if(c.hasOwnProperty("myChannelsUrl"))b(c.myChannelsUrl);else a.onKeyUpdated("/myChannelsUrl",
b)})})};b.prototype.sendTypingIndicator=function(a){var b=this;e.trace("IPMSG I: sending typing indicator");return c.post({url:k.typingIndicatorUri,headers:{"X-Twilio-Token":this.token,"Content-Type":"application/x-www-form-urlencoded"},body:"ChannelSid="+a}).then(function(a){var c=void 0;try{c=JSON.parse(a.body),c.hasOwnProperty("typing_timeout")&&(b.typingTimeout=1E3*c.typing_timeout)}catch(d){e.warn("IPMSG W: failed to parse typing indicator service response: ",d),e.warn("IPMSG W: using built-in defaults")}return a}).then(null,
function(a){e.error("IPMSG E: failed to send typing indicator: "+a);throw a;})};l.exports=b},{"../../util/changetracker":29,"../../util/guid":30,"../../util/request":33,"./configuration":12,loglevel:71}],19:[function(g,l,h){function b(a,b,e,g){var m=this;if(!a)throw Error("Token is required for Notification client");a=new k(a,g);Object.defineProperties(this,{_config:{value:a},_registrar:{value:new c(b,a)},_twilsock:{value:e},_reliableTransportState:{value:{overall:!1,transport:!1,registration:!1}}});
f.call(this);this._registrar.on("stateChanged",function(a){this._onRegistrationStateChange(a)}.bind(this));this._registrar.on("needReliableTransport",this._onNeedReliableTransport.bind(this));this._twilsock.on("message",function(a,b){return m._routeMessage(a,b)});this._twilsock.on("connected",function(a){this._onTransportStateChange(!0);this._registrar.setNotificationId("twilsock",a)}.bind(this));this._twilsock.on("disconnected",function(){this._onTransportStateChange(!1)}.bind(this))}var f=g("events").EventEmitter;
h=g("util").inherits;var e=g("loglevel"),k=g("./configuration"),c=g("./registrar");h(b,f);b.prototype._routeMessage=function(a,b){e.trace("Message arrived: ",a,b);this.emit("message",a,b)};b.prototype._onNeedReliableTransport=function(a){a?this._twilsock.connect():this._twilsock.disconnect()};b.prototype._onRegistrationStateChange=function(a){this._reliableTransportState.registration="registered"===a;this._updateTransportState()};b.prototype._onTransportStateChange=function(a){this._reliableTransportState.transport=
a;this._updateTransportState()};b.prototype._updateTransportState=function(){var a=this._reliableTransportState.transport&&this._reliableTransportState.registration;this._reliableTransportState.overall!==a&&(this._reliableTransportState.overall=a,e.info("NTFCN I: Transport ready "+a),this.emit("transport_ready",a))};b.prototype.subscribe=function(a,b){e.trace("Add subscriptions for event type: ",a);return this._registrar.subscribe(a,b||"twilsock")};b.prototype.unsubscribe=function(a,b){return this._registrar.unsubscribe(a,
b)};b.prototype.handlePushNotification=function(a){e.warn("Push message passed, but no functionality implemented yet: "+a)};b.prototype.setGCMToken=function(a){this._registrar.setNotificationId("gcm",a)};b.prototype.setAuthToken=function(a){e.info("NTFCN I: authTokenUpdated");this._config.updateToken(a);this._registrar._updateGcmRegistration();this._twilsock.disconnect().then(this._twilsock.connect.bind(this._twilsock))};l.exports=b},{"./configuration":20,"./registrar":22,events:40,loglevel:71,util:69}],
20:[function(g,l,h){function b(b){var e=this;Object.defineProperties(this,{_registrarUri:{value:"https://ers.us1.twilio.com/v1/registrations"},_token:{value:b,writable:!0},registrarUri:{get:function(){return e._registrarUri}},token:{get:function(){return e._token}}});this.getRegistrarUri=function(){return this._registrarUri};this.getToken=function(){return this._token}}b.prototype.updateToken=function(b){this._token=b};l.exports=b},{}],21:[function(g,l,h){function b(b,a,d){var k=this,g=e.create({initial:"unregistered",
events:[{name:"userUpdate",from:["unregistered"],to:"registering"},{name:"userUpdate",from:["registered"],to:"unregistering"},{name:"registered",from:["registering"],to:"registered"},{name:"unregistered",from:["unregistering"],to:"unregistered"},{name:"failure",from:["registering"],to:"retry"},{name:"failure",from:["unregistering"],to:"unregistered"}],callbacks:{onregistering:function(a,b,c,d){return k._register(d)},onunregistering:function(a,b,c,d){return k._unregister()},onregistered:function(a,
b,c,d){k.emit("stateChanged","registered");k._checkPendingUpdate()},onunregistered:function(a,b,c,d){k.emit("stateChanged","unregistered");k._checkPendingUpdate()},onretry:function(a,b,c,d){return k._retry(d)}}});Object.defineProperties(this,{_transport:{value:b},_url:{value:a.registrarUri,writable:!1},_config:{value:a},_platform:{value:"undefined"!==typeof navigator?navigator.userAgent:"web"},_fsm:{value:g},_channelType:{value:d},_registrationId:{value:!1,writable:!0},_notificationId:{value:!1},
_messageTypes:{value:[],writable:!0},_pendingUpdate:{value:!1,writable:!0}});f.call(this)}var f=g("events").EventEmitter;h=g("util").inherits;var e=g("javascript-state-machine"),k=g("loglevel");h(b,f);b.prototype.update=function(b,a){var d={notificationId:b,messageTypes:a};this._fsm.is("unregistered")?d.notificationId&&0<d.messageTypes.length&&this._fsm.userUpdate(d):(this._fsm.is("registered")&&this._fsm.userUpdate(d),this._setPendingUpdate(d))};b.prototype._setPendingUpdate=function(b){this._pendingUpdate=
b};b.prototype._checkPendingUpdate=function(){if(this._pendingUpdate){var b=this._pendingUpdate;this._pendingUpdate=!1;this.update(b.notificationId,b.messageTypes)}};b.prototype._retry=function(b){this._pendingUpdate?this._checkPendingUpdate():this._register(b)};b.prototype._register=function(b){var a=this,d={endpoint_platform:this._platform,channel_type:this._channelType,version:"1",message_types:b.messageTypes,data:{},ttl:"PT24H"};"twilsock"===this._channelType?d.data.url=b.notificationId:d.data.registration_id=
b.notificationId;var f=this._url,e={"Content-Type":"application/json","X-Twilio-Token":this._config.token};k.trace("NTFCN I: Creating registration for channel ",this._channelType);return this._transport.post(f,e,d).then(function(d){a._registrationId=d.body.id;a._registrationData=b;k.debug("NTFCN I: Registration created: ",d);a._fsm.registered()})["catch"](function(d){k.error("NTFCN E: Registration failed: ",d);a._fsm.failure(b);return d})};b.prototype._unregister=function(){var b=this;if(!this._registrationId)return Promise.resolve();
var a=this._url+"/"+this._registrationId,d={"Content-Type":"application/json","X-Twilio-Token":this._config.token};k.trace("NTFCN I: removing registration for ",this._channelType);this._transport["delete"](a,d).then(function(a){k.debug("NTFCN I: registration removed for ",b._channelType);b._registrationId=!1;b._fsm.unregistered()})["catch"](function(a){k.error("NTFCN E: failed to remove of registration ",b.channelType,a);b._fsm.failure();return a})};l.exports=b},{events:40,"javascript-state-machine":70,
loglevel:71,util:69}],22:[function(g,l,h){function b(b,a){var d=this,e={twilsock:new Set,gcm:new Set},g=new k(b,a,"twilsock"),m=new k(b,a,"gcm");Object.defineProperties(this,{_conf:{value:a},_subscriptions:{value:e},_notificationIds:{value:{twilsock:null,gcm:null}},_twilsockRegistrar:{value:g},_gcmRegistar:{value:m}});f.call(this);g.on("stateChanged",function(a){return d.emit("stateChanged",a)})}var f=g("events").EventEmitter;h=g("util").inherits;var e=g("loglevel"),k=g("./registrar.connector");h(b,
f);b.prototype.setNotificationId=function(b,a){e.trace("NTFCN I: Notification id for channel ",b,a);this._notificationIds[b]!==a&&(this._notificationIds[b]=a,this._updateRegistration(b))};b.prototype.refreshSubscriptions=function(){e.info("NTFCN: Refresh registrations");this._updateTwilsockRegistration()};b.prototype.hasSubscription=function(b,a){if("twilsock"===a)return this._subscriptions.twilsock.has(b);if("gcm"===a)return this._subscriptions.gcm.has(b);throw Error("Unknown channel type: "+a);
};b.prototype.subscribe=function(b,a){if(!this.hasSubscription(b,a))if("twilsock"===a)0===this._subscriptions.twilsock.size&&this.emit("needReliableTransport",!0),this._subscriptions.twilsock.add(b),this._updateTwilsockRegistration();else if("gcm"===a)this._subscriptions.gcm.add(b),this._updateGcmRegistration();else throw Error("Can't subscribe to the channel type "+a);};b.prototype.unsubscribe=function(b,a){this.hasSubscription(b,a)&&("twilsock"===a?(this._subscriptions.twilsock["delete"](b),this._updateTwilsockRegistration(),
0===this._subscriptions.twilsock.size&&this.emit("needReliableTransport",!1)):"gcm"===a&&(this._subscriptions.gcm["delete"](b),this._updateGcmRegistration()))};b.prototype._updateRegistration=function(b){if("twilsock"===b)return this._updateTwilsockRegistration();if("gcm"===b)return this._updateGcmRegistration()};b.prototype._updateTwilsockRegistration=function(){if(this._notificationIds.twilsock){var b=this._notificationIds.twilsock,a=[];this._subscriptions.twilsock.forEach(function(b){return a.push(b)});
e.debug("Subscribing to the twilsock notifications");this._twilsockRegistrar.update(b,a)}else e.trace("Ignoring twilsock registration update request: no twilsock id in place")};b.prototype._updateGcmRegistration=function(){if(this._notificationIds.gcm){var b=this._notificationIds.gcm,a=[];this._subscriptions.gcm.forEach(function(b){return a.push(b)});this._gcmRegistrar.update(b,a)}else e.trace("Ignoring twilsock registration update request: no twilsock id in place")};l.exports=b},{"./registrar.connector":21,
events:40,loglevel:71,util:69}],23:[function(g,l,h){function b(a,b,c,f){b=k(b);a={method:a,host:b.host,path:b.pathname};b.params&&(a.params=b.params);return{to:a,headers:c,body:f}}function f(a){return{status:a.status,headers:a.header.http_headers,body:a.body}}function e(a){try{a.body=JSON.parse(a.body)}finally{return a}}function k(a){var b=a.match(/^(https?\:)\/\/(([^:\/?#]*)(?:\:([0-9]+))?)(\/[^?#]*)(\?[^#]*|)(#.*|)$/);if(b)return a={protocol:b[1],host:b[2],hostname:b[3],port:b[4],pathname:b[5],
search:b[6],hash:b[7]},0<a.search.length&&(b=a.search.substring(1),a.params=b.split("&").map(function(a){return a.split("=")}).reduce(function(a,b){a[b[0]]=b[1];return a},{})),a;throw Error("Incorrect URI: "+a);}function c(b){Object.defineProperties(this,{_activeGetRequests:{value:new Map},_twilsock:{value:b},_http:{value:a}});b&&b.connect()}var a=g("../../util/request");c.prototype._shouldUseTwilsock=function(){return this._twilsock&&this._twilsock.isConnected};c.prototype._get=function(a,c){return this._shouldUseTwilsock()?
this._twilsock.send(b("GET",a,c)).then(f):this._http.get({url:a,headers:c,body:void 0}).then(e)};c.prototype.get=function(a,b){var c=this;if(this._activeGetRequests.has(a))return this._activeGetRequests.get(a);var f=this._get(a,b).then(function(b){c._activeGetRequests["delete"](a);return b})["catch"](function(b){c._activeGetRequests["delete"](a);throw b;});this._activeGetRequests.set(a,f);return f};c.prototype.post=function(a,c,k){return this._shouldUseTwilsock()?this._twilsock.send(b("POST",a,c,
k)).then(f):this._http.post({url:a,headers:c,body:k}).then(e)};c.prototype.put=function(a,c,k){return this._shouldUseTwilsock()?this._twilsock.send(b("PUT",a,c,k)).then(f):this._http.put({url:a,headers:c,body:k}).then(e)};c.prototype["delete"]=function(a,c){return this._shouldUseTwilsock()?this._twilsock.send(b("DELETE",a,c)).then(e):this._http["delete"]({url:a,headers:c,body:void 0}).then(e)};Object.freeze(c);l.exports=c},{"../../util/request":33}],24:[function(g,l,h){function b(b,e){var g=this,
m=new k(b,e),h=new c(m),l=new a(h);Object.defineProperties(this,{_config:{value:m},_socket:{value:h},_network:{value:l},isConnected:{get:function(){return g._socket.isConnected()}}});f.call(this);this._socket.on("message",function(a,b){return g.emit("message",a,b)});this._socket.on("connected",function(a){return g.emit("connected",a)});this._socket.on("disconnected",function(){return g.emit("disconnected")})}var f=g("events").EventEmitter;h=g("util").inherits;var e=g("loglevel"),k=g("./configuration.js"),
c=g("./twilsock.js"),a=g("./packetinterface.js");h(b,f);b.prototype.send=function(a){return this._network.send(a.to,a.headers,a.body)};b.prototype.setAuthToken=function(a){var b=this;e.info("DSS I: authTokenUpdated");this._config.updateToken(a);this._socket.disconnect().then(function(){return b._socket.connect()})};b.prototype.connect=function(){return this._socket.connect()};b.prototype.disconnect=function(){return this._socket.disconnect()};Object.freeze(b);l.exports=b},{"./configuration.js":25,
"./packetinterface.js":26,"./twilsock.js":27,events:40,loglevel:71,util:69}],25:[function(g,l,h){function b(b,e){var k=this;e=e||{};Object.defineProperties(this,{_twilsockWsHost:{value:(e.twilsockUri||"wss://tsock.us1.twilio.com")+"/v2/wsconnect"},_token:{value:b,writable:!0},token:{get:function(){return k._token}},twilsockUri:{get:function(){return k._twilsockWsHost}}})}b.prototype.updateToken=function(b){this._token=b};l.exports=b},{}],26:[function(g,l,h){function b(b){Object.defineProperties(this,
{_activeRequests:{value:new Map},_socket:{value:b}});this._socket.on("reply",this._processReply.bind(this))}b.prototype._processReply=function(b){var e=this._activeRequests.get(b.id);e&&(this._activeRequests["delete"](b.id),-1===[200,201,204].indexOf(b.status.code)?e.reject(Error("Transport failure: "+b.status.status)):-1===[200,201,204].indexOf(b.header.http_status.code)?e.reject({status:b.header.http_status.code,description:b.header.http_status.status,body:b.body}):e.resolve(b))};b.prototype.send=
function(b,e,k){var c=this;return new Promise(function(a,d){var p=c._socket.send(b,e,k);c._activeRequests.set(p,{resolve:a,reject:d})})};l.exports=b},{}],27:[function(g,l,h){(function(b){function f(a){var b=this,c=p.create({initial:"disconnected",events:[{name:"userConnect",from:["disconnected"],to:"connecting"},{name:"userDisconnect",from:["connecting","connected","retrying"],to:"disconnecting"},{name:"userRetry",from:["retrying"],to:"connecting"},{name:"socketConnected",from:["connecting"],to:"connected"},
{name:"socketClosed",from:["connecting","connected"],to:"retrying"},{name:"socketClosed",from:["disconnecting"],to:"disconnected"},{name:"socketRejected",from:["connecting","connected"],to:"disconnecting"}],callbacks:{onconnecting:this._setupSocket.bind(this),onretrying:this._retry.bind(this),onenterconnected:this._onTransportReady.bind(this,!0),onleaveconnected:this._onTransportReady.bind(this,!1),onuserDisconnect:this._closeSocket.bind(this),ondisconnected:function(){if(b._disconnectedPromiseResolve){var a=
b._disconnectedPromiseResolve;b._disconnectedPromiseResolve=null;a()}},onsocketRejected:function(a,c,d){for(var e=arguments.length,f=Array(3<e?e-3:0),k=3;k<e;k++)f[k-3]=arguments[k];return b._onSocketRejected(f)}},error:function(a,b,c,e,f,k,p){d.trace("Twilsock FSM: unexpected transition",arguments)}});Object.defineProperties(this,{_config:{value:a},_transportReady:{value:!1,writable:!0},_disconnectedPromiseResolve:{value:null,writable:!0},_fsm:{value:c}});k.call(this)}function e(a){return JSON.parse((new b(a)).toString())}
var k=g("events").EventEmitter,c=g("../../util"),a=g("util").inherits,d=g("loglevel"),p=g("javascript-state-machine");a(f,k);f.prototype._retry=function(){var a=this;delete this._socket;this._retryTimeout=setTimeout(function(){a._fsm.userRetry()},1E3)};f.prototype._onConnected=function(){this._onTransportReady(!0)};f.prototype._onDisconnected=function(){this._onTransportReady(!1)};f.prototype._setupSocket=function(){var a=this,c=new WebSocket(this._config.twilsockUri+"?token="+this._config.token);
c.binaryType="arraybuffer";c.onopen=function(){d.info("NTFCN I: Twilsock socket opened")};c.onclose=function(){d.info("NTFCN I: socket closed");a._fsm.socketClosed()};c.onerror=function(a){d.error("NTFCN E: ",a)};c.onmessage=function(c){var f,k,p,g;d.trace("NTFCN: twilsock: ",c.data);c=new Uint8Array(c.data);g="";for(f=0;f<c.length;++f)if(k=String.fromCharCode(c[f]),g+=k,"\r"===k){f+=2;break}g=g.split(" ");k=g[0];p=g[1];g=Number(g[2]);if("TWILSOCK"!==k||"V1.0"!==p)throw Error("Unsupported protocol: "+
k+" ver "+p);k=e(c.subarray(f,f+g));d.trace("Twilsock: message received: ",k);p=null;0<k.payload_size&&(!k.hasOwnProperty("payload_type")||k.payload_type.startsWith("application/json")?p=e(c.subarray(2+f+g)):k.payload_type.startsWith("text/plain")&&(p=(new b(c.subarray(2+f+g))).toString()));a._confirmReceiving(k);"ready"===k.method?(d.trace("Twilsock ready",p),a._wschannelUrl=p.wschannel_url,a._fsm.socketConnected()):"notification"===k.method?a.emit("message",k.message_type,p):"reply"===k.method?
a.emit("reply",{id:k.id,status:k.status,header:k,body:p}):"close"===k.method&&a._fsm.socketRejected(p)};this._socket=c};f.prototype._confirmReceiving=function(a){this._sendPacket({method:"reply",id:a.id,payload_type:"application/json",status:{code:200,status:"OK"}})};f.prototype._sendPacket=function(a,c){var d="undefined"!==typeof c?JSON.stringify(c):"";a.payload_size=b.byteLength(d);var f=JSON.stringify(a)+"\r\n",e="TWILSOCK V1.0 "+(b.byteLength(f)-2)+"\r\n",d=new Uint8Array(new b(e+f+d));this._socket.send(d.buffer)};
f.prototype._cancelRetryAttempt=function(){this._retryTimeout&&(clearTimeout(this._retryTimeout),delete this._retryTimeout)};f.prototype._closeSocket=function(){this._cancelRetryAttempt();this._socket&&this._socket.close()};f.prototype.connect=function(){this._fsm.userConnect()};f.prototype.disconnect=function(){return this._fsm.is("disconnected")?Promise.resolve():new Promise(function(a){this._fsm.userDisconnect();this._disconnectedPromiseResolve=a}.bind(this))};f.prototype.isConnected=function(){return this._socket&&
1===this._socket.readyState};f.prototype.send=function(a,b,d){var f=c.makeUUID(),e={host:a.host,path:a.path,method:a.method};a.hasOwnProperty("params")&&(e.params=a.params);a={method:"message",id:f,http_header:e,payload_type:"application/json"};b&&(a.http_header.headers=b);this._sendPacket(a,d);return f};f.prototype._onTransportReady=function(a){this._transportReady!==a&&(this._transportReady=a,!0===this._transportReady?(d.trace("Twilsock connected: ",this._wschannelUrl),this._state="connected",this.emit("connected",
this._wschannelUrl)):(d.trace("Twilsock disconnected"),this._wschannelUrl=null,this._state="disconnected",this.emit("disconnected")))};f.prototype._onSocketRejected=function(a){d.error("Twilsock connection denied",a);this.emit("remoteClose",a);this._closeSocket()};Object.freeze(f);l.exports=f}).call(this,g("buffer").Buffer)},{"../../util":31,buffer:36,events:40,"javascript-state-machine":70,loglevel:71,util:69}],28:[function(g,l,h){function b(f,e){return new b.Client(f,e)}b.Client=g("./clients/ipmessaging/client");
b.DataSyncClient=g("./clients/datasync/client");b.NotificationClient=g("./clients/notification/client");b.Transport=g("./clients/transport");b.TwilsockClient=g("./clients/twilsock/client");l.exports=b},{"./clients/datasync/client":1,"./clients/ipmessaging/client":11,"./clients/notification/client":19,"./clients/transport":23,"./clients/twilsock/client":24}],29:[function(g,l,h){function b(b){var c=this;Object.defineProperties(this,{_pendingListeners:{value:{}},_data:{value:b||{},writable:!0}});f.call(this);
["keyAdded","keyRemoved","keyUpdated"].forEach(function(a){c._pendingListeners[a]={};c.on(a,function(b,f){(c._pendingListeners[a][b]||[]).forEach(function(a){return a(f)});c._pendingListeners[a][b]=[]})})}var f=g("events").EventEmitter;h=g("util").inherits;var e=g("./jsondiff");h(b,f);b.prototype._traverse=function(b,c){var a=this;e.diff(b,c).forEach(function(b){"add"===b.op?a.emit("keyAdded",b.path,b.value):"replace"===b.op?a.emit("keyUpdated",b.path,b.value):"remove"===b.op&&a.emit("keyRemoved",
b.path)})};b.prototype.update=function(b){var c=this._data;this._data=b;this._traverse(c,b)};b.prototype.addEventHandler=function(b,c,a){var d=this._pendingListeners[b][c]||[];d.push(a);this._pendingListeners[b][c]=d};l.exports=b},{"./jsondiff":32,events:40,util:69}],30:[function(g,l,h){l.exports=function(){function b(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return b()+b()+b()+b()+b()+b()+b()+b()}},{}],31:[function(g,l,h){(function(b){function f(a){return 0===a.length?
[[]]:[a].concat(f(a.slice(1)))}var e="function"===typeof atob?atob:function(a){return(new b(a,"base64")).toString("ascii")},k={decode:e,encode:"function"===typeof btoa?btoa:function(a){return(new b(a)).toString("base64")}},c={decode:function(a){var b={};return function(){var c=Array.prototype.slice.call(arguments,0);return b[c]?b[c]:b[c]=a.apply(null,c)}}(function(a){var b=a.length%4;0<b&&(a+=Array(4-b+1).join("="));a=a.replace(/-/g,"+").replace(/_/g,"/");return e(a)})};l.exports.base64=k;l.exports.base64URL=
c;l.exports.deepClone=function(a){return JSON.parse(JSON.stringify(a))};l.exports.fromURLFormEncoded=function(a){if(!a)return{};var b={};a=a.split("&");for(var c=0;c<a.length;c++){var f=a[c].split("="),e=decodeURIComponent(f[0]),f=f[1]?decodeURIComponent(f[1]):null;b[e]=f}return b};l.exports.requireNoBrowserify=function(a){return eval("require('"+a+"')")};l.exports.getKeys=function(a){var b=[],c;for(c in a)b.push(c);return b};l.exports.getValues=function(a){var b=[],c;for(c in a)b.push(a[c]);return b};
l.exports.makeUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};l.exports.withDefaults=function(a,b){a=a||{};b=Array.prototype.slice.call(arguments,1);b.forEach(function(b){var c=a,d;for(d in b)d in c||(c[d]=b[d])});return a};l.exports.extend=function(a,b){a=a||{};b=Array.prototype.slice.call(arguments,1);b.forEach(function(b){var c=a,d;for(d in b)c[d]=b[d]});return a};l.exports.tails=f;l.exports["return"]=
function(a){return function(){return a}};l.exports.emitNext=function(){var a=[].slice.call(arguments),b=a[0],a=a.slice(1);setTimeout(function(){b.emit.call(b,a)});return b};l.exports.getOrNull=function(a,b){return b.split(".").reduce(function(a,b){return a?a[b]:null},a)};l.exports.parseUserAgent=function(a){var b=a.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)\.(\d+)/i)||[],b={name:b[1],version:b[2]+"."+b[3]};if(/trident/i.test(b.name))return a=/\brv[ :]+(\d+)\.(\d+)/g.exec(a)||
[],{name:"IE",version:a[1]?a[1]+"."+a[2]:""};if("Chrome"===b.name&&(a=a.match(/\b(OPR|Edge)\/(\d+)\.(\d+)/),null!==a))return{name:"Opera",version:a[2]+"."+a[3]};"MSIE"===b.name&&(b.name="IE");return b};l.exports.overwriteArray=function(a,b){a.splice(0,a.length);b.forEach(function(b){a.push(b)})};l.exports.faultTolerantWait=function(a){return new Promise(function(b){function c(){0>=--f&&b(e)}var f=a.length,e=0;0===f&&b();a.forEach(function(a){a.then(c)["catch"](function(){e++;c()})})})};l.exports.UriBuilder=
function(a){Object.defineProperties(this,{base:{value:a},args:{value:[]}});this.arg=function(a,b){"undefined"!==typeof b&&this.args.push(a+"="+b);return this};this.build=function(){return this.base+"?"+this.args.join("&")}}}).call(this,g("buffer").Buffer)},{buffer:36}],32:[function(g,l,h){function b(){}b.prototype.toString=Object.prototype.toString;b.prototype.hasOwnProperty=Object.prototype.hasOwnProperty;b.prototype.isArray=function(b){return"[object Array]"===this.toString.call(b)};b.prototype.isObject=
function(b){return"[object Object]"===this.toString.call(b)};b.prototype.isString=function(b){return"[object String]"===this.toString.call(b)};b.prototype.isFunction=function(b){return"[object Function]"===this.toString.call(b)};b.prototype.has=function(b,e){return hasOwnProperty.call(b,e)};b.prototype.isEqual=function(b,e){return this.eq(b,e,[],[])};b.prototype.isContainer=function(b){return this.isArray(b)||isObject(b)};b.prototype.isSameContainer=function(b,e){return this.isArray(b)&&this.isArray(e)||
this.isObject(b)&&this.isObject(e)};b.prototype.eq=function(b,e,k,c){var a,d,g,h,m;if(b===e)return 0!==b||1/b===1/e;if(null==b||null==e)return b===e;a=this.toString.call(b);if(a!==this.toString.call(e))return!1;switch(a){case "[object String]":return b===String(e);case "[object Number]":return b!==+b?e!==+e:0===b?1/b===1/e:b===+e;case "[object Date]":case "[object Boolean]":return+b===+e;case "[object RegExp]":return b.source===e.source&&b.global===e.global&&b.multiline===e.multiline&&b.ignoreCase===
e.ignoreCase}if("object"!==typeof b||"object"!==typeof e)return!1;h=k.length;for(m=[];h--;)m.push(k[h]===b);if(m)return c[h]===e;k.push(b);c.push(e);m=0;h=!0;if("[object Array]"===a){if(m=b.length,h=m===e.length)for(;m--&&(h=this.eq(b[m],e[m],k,c)););}else{a=b.constructor;d=e.constructor;if(a!==d&&!(this.isFunction(a)&&a instanceof a&&this.isFunction(d)&&d instanceof d))return!1;for(g in b)if(this.has(b,g)&&(m++,!(h=this.has(e,g)&&this.eq(b[g],e[g],k,c))))break;if(h){for(g in e)if(this.has(e,g)&&
!m--)break;h=!m}}k.pop();c.pop();return h};b.prototype.getParent=function(b,e){var k=e.replace(/\/[^\/]*$/,"");k||(k="/");return b[k]};b.prototype.flattenObject=function(b,e,k){var c,a,d,g;null==e&&(e="/");null==k&&(k={});k[e]={path:e,value:b};"/"!==e&&(e+="/");if(this.isArray(b))for(c=d=0,g=b.length;d<g;c=++d)a=b[c],this.flattenObject(a,e+c,k);else if(this.isObject(b))for(c in b)a=b[c],this.flattenObject(a,e+c,k);return k};b.prototype.diff=function(b,e){var k,c,a,d,g,h,m,l,u,w,A,C;if(!this.isSameContainer(b,
e))throw Error("Patches can only be derived from objects or arrays");u=this.flattenObject(b);w=this.flattenObject(e);k={};A={};C={};l={};for(d in u)a=u[d],c=w[d],this.getParent(w,d)&&(c?this.isSameContainer(a.value,c.value)||this.isEqual(a.value,c.value)||(C[d]=c):A[d]=a);for(d in w)a=u[d],c=w[d],!a&&this.isSameContainer(this.getParent(u,d),this.getParent(w,d))&&(k[d]=c);for(g in A)for(h in a=A[g],k)if(c=k[h],this.isEqual(c.value,a.value)){delete A[g];delete k[h];l[h]=g;break}a=[];for(d in k)c=k[d],
a.push({op:"add",path:d,value:c.value});for(d in A)a.push({op:"remove",path:d});for(d in C)c=C[d],a.push({op:"replace",path:d,value:c.value});for(m in l)k=l[m],a.push({op:"move",from:k,path:m});return a};b.diff=function(f,e){return(new b).diff(f,e)};b.isDeepEqual=function(b,e){return 0===this.diff(b,e).length};l.exports=b},{}],33:[function(g,l,h){function b(b){return b.split("\r\n").map(function(b){return b.split(": ")}).filter(function(b){return 2===b.length&&0<b[1].length}).reduce(function(b,a){b[a[0]]=
a[1];return b},{})}function f(f,c){return new Promise(function(a,d){var g=new e;g.open(f,c.url,!0);g.onreadystatechange=function(){if(4===g.readyState)if(200<=g.status&&300>g.status){var c=b(g.getAllResponseHeaders());a({status:g.status,headers:c,body:g.responseText})}else d({status:g.status,description:g.statusText,body:g.responseText})};for(var h in c.headers)g.setRequestHeader(h,c.headers[h]),"Content-Type"===h&&"application/json"===c.headers[h]&&(c.body=JSON.stringify(c.body));g.send(c.body)})}
var e="undefined"===typeof XMLHttpRequest?g("xmlhttprequest").XMLHttpRequest:XMLHttpRequest;f.get=function(b){return f("GET",b)};f.post=function(b){return f("POST",b)};f.put=function(b){return f("PUT",b)};f["delete"]=function(b){return f("DELETE",b)};l.exports=f},{xmlhttprequest:75}],34:[function(g,l,h){},{}],35:[function(g,l,h){arguments[4][34][0].apply(h,arguments)},{dup:34}],36:[function(g,l,h){(function(b){function f(){function a(){}try{var b=new Uint8Array(1);b.foo=function(){return 42};b.constructor=
a;return 42===b.foo()&&b.constructor===a&&"function"===typeof b.subarray&&0===b.subarray(1,1).byteLength}catch(c){return!1}}function e(b){if(!(this instanceof e))return 1<arguments.length?new e(b,arguments[1]):new e(b);this.length=0;this.parent=void 0;if("number"===typeof b){var c;c=a(this,0>b?0:d(b)|0);if(!e.TYPED_ARRAY_SUPPORT)for(var f=0;f<b;f++)c[f]=0;return c}if("string"===typeof b){c=this;f=1<arguments.length?arguments[1]:"utf8";if("string"!==typeof f||""===f)f="utf8";var g=l(b,f)|0;c=a(c,g);
c.write(b,f);return c}return k(this,b)}function k(b,f){if(e.isBuffer(f)){var k=b,g=d(f.length)|0,k=a(k,g);f.copy(k,0,0,g);return k}if(H(f)){for(var k=b,g=d(f.length)|0,k=a(k,g),n=0;n<g;n+=1)k[n]=f[n]&255;return k}if(null==f)throw new TypeError("must start with number, buffer, array or string");if("undefined"!==typeof ArrayBuffer){if(f.buffer instanceof ArrayBuffer)return c(b,f);if(f instanceof ArrayBuffer)return k=b,e.TYPED_ARRAY_SUPPORT?(f.byteLength,k=e._augment(new Uint8Array(f))):k=c(k,new Uint8Array(f)),
k}if(f.length){k=b;g=d(f.length)|0;k=a(k,g);for(n=0;n<g;n+=1)k[n]=f[n]&255;return k}k=b;n=0;"Buffer"===f.type&&H(f.data)&&(g=f.data,n=d(g.length)|0);for(var k=a(k,n),p=0;p<n;p+=1)k[p]=g[p]&255;return k}function c(b,c){var e=d(c.length)|0;b=a(b,e);for(var f=0;f<e;f+=1)b[f]=c[f]&255;return b}function a(a,b){e.TYPED_ARRAY_SUPPORT?(a=e._augment(new Uint8Array(b)),a.__proto__=e.prototype):(a.length=b,a._isBuffer=!0);0!==b&&b<=e.poolSize>>>1&&(a.parent=I);return a}function d(a){if(a>=(e.TYPED_ARRAY_SUPPORT?
2147483647:1073741823))throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+(e.TYPED_ARRAY_SUPPORT?2147483647:1073741823).toString(16)+" bytes");return a|0}function p(a,b){if(!(this instanceof p))return new p(a,b);var c=new e(a,b);delete c.parent;return c}function l(a,b){"string"!==typeof a&&(a=""+a);var c=a.length;if(0===c)return 0;for(var d=!1;;)switch(b){case "ascii":case "binary":case "raw":case "raws":return c;case "utf8":case "utf-8":return z(a).length;case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":return 2*
c;case "hex":return c>>>1;case "base64":return B.toByteArray(x(a)).length;default:if(d)return z(a).length;b=(""+b).toLowerCase();d=!0}}function m(a,b,c){var d=!1;b|=0;c=void 0===c||Infinity===c?this.length:c|0;a||(a="utf8");0>b&&(b=0);c>this.length&&(c=this.length);if(c<=b)return"";for(;;)switch(a){case "hex":a=b;b=c;c=this.length;if(!a||0>a)a=0;if(!b||0>b||b>c)b=c;d="";for(c=a;c<b;c++)a=d,d=this[c],d=16>d?"0"+d.toString(16):d.toString(16),d=a+d;return d;case "utf8":case "utf-8":return v(this,b,c);
case "ascii":a="";for(c=Math.min(this.length,c);b<c;b++)a+=String.fromCharCode(this[b]&127);return a;case "binary":a="";for(c=Math.min(this.length,c);b<c;b++)a+=String.fromCharCode(this[b]);return a;case "base64":return b=0===b&&c===this.length?B.fromByteArray(this):B.fromByteArray(this.slice(b,c)),b;case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":b=this.slice(b,c);c="";for(a=0;a<b.length;a+=2)c+=String.fromCharCode(b[a]+256*b[a+1]);return c;default:if(d)throw new TypeError("Unknown encoding: "+
a);a=(a+"").toLowerCase();d=!0}}function v(a,b,c){c=Math.min(a.length,c);for(var d=[];b<c;){var e=a[b],f=null,k=239<e?4:223<e?3:191<e?2:1;if(b+k<=c){var g,n,p;switch(k){case 1:128>e&&(f=e);break;case 2:g=a[b+1];128===(g&192)&&(e=(e&31)<<6|g&63,127<e&&(f=e));break;case 3:g=a[b+1];n=a[b+2];128===(g&192)&&128===(n&192)&&(e=(e&15)<<12|(g&63)<<6|n&63,2047<e&&(55296>e||57343<e)&&(f=e));break;case 4:g=a[b+1],n=a[b+2],p=a[b+3],128===(g&192)&&128===(n&192)&&128===(p&192)&&(e=(e&15)<<18|(g&63)<<12|(n&63)<<
6|p&63,65535<e&&1114112>e&&(f=e))}}null===f?(f=65533,k=1):65535<f&&(f-=65536,d.push(f>>>10&1023|55296),f=56320|f&1023);d.push(f);b+=k}a=d.length;if(a<=K)d=String.fromCharCode.apply(String,d);else{c="";for(b=0;b<a;)c+=String.fromCharCode.apply(String,d.slice(b,b+=K));d=c}return d}function u(a,b,c){if(0!==a%1||0>a)throw new RangeError("offset is not uint");if(a+b>c)throw new RangeError("Trying to access beyond buffer length");}function w(a,b,c,d,f,k){if(!e.isBuffer(a))throw new TypeError("buffer must be a Buffer instance");
if(b>f||b<k)throw new RangeError("value is out of bounds");if(c+d>a.length)throw new RangeError("index out of range");}function A(a,b,c,d){0>b&&(b=65535+b+1);for(var e=0,f=Math.min(a.length-c,2);e<f;e++)a[c+e]=(b&255<<8*(d?e:1-e))>>>8*(d?e:1-e)}function C(a,b,c,d){0>b&&(b=4294967295+b+1);for(var e=0,f=Math.min(a.length-c,4);e<f;e++)a[c+e]=b>>>8*(d?e:3-e)&255}function q(a,b,c,d,e,f){if(b>e||b<f)throw new RangeError("value is out of bounds");if(c+d>a.length)throw new RangeError("index out of range");
if(0>c)throw new RangeError("index out of range");}function D(a,b,c,d,e){e||q(a,b,c,4,3.4028234663852886E38,-3.4028234663852886E38);E.write(a,b,c,d,23,4);return c+4}function n(a,b,c,d,e){e||q(a,b,c,8,1.7976931348623157E308,-1.7976931348623157E308);E.write(a,b,c,d,52,8);return c+8}function x(a){a=a.trim?a.trim():a.replace(/^\s+|\s+$/g,"");a=a.replace(S,"");if(2>a.length)return"";for(;0!==a.length%4;)a+="=";return a}function z(a,b){b=b||Infinity;for(var c,d=a.length,e=null,f=[],k=0;k<d;k++){c=a.charCodeAt(k);
if(55295<c&&57344>c){if(!e){if(56319<c){-1<(b-=3)&&f.push(239,191,189);continue}else if(k+1===d){-1<(b-=3)&&f.push(239,191,189);continue}e=c;continue}if(56320>c){-1<(b-=3)&&f.push(239,191,189);e=c;continue}c=(e-55296<<10|c-56320)+65536}else e&&-1<(b-=3)&&f.push(239,191,189);e=null;if(128>c){if(0>--b)break;f.push(c)}else if(2048>c){if(0>(b-=2))break;f.push(c>>6|192,c&63|128)}else if(65536>c){if(0>(b-=3))break;f.push(c>>12|224,c>>6&63|128,c&63|128)}else if(1114112>c){if(0>(b-=4))break;f.push(c>>18|
240,c>>12&63|128,c>>6&63|128,c&63|128)}else throw Error("Invalid code point");}return f}function r(a){for(var b=[],c=0;c<a.length;c++)b.push(a.charCodeAt(c)&255);return b}function y(a,b,c,d){for(var e=0;e<d&&!(e+c>=b.length||e>=a.length);e++)b[e+c]=a[e];return e}var B=g("base64-js"),E=g("ieee754"),H=g("is-array");h.Buffer=e;h.SlowBuffer=p;h.INSPECT_MAX_BYTES=50;e.poolSize=8192;var I={};e.TYPED_ARRAY_SUPPORT=void 0!==b.TYPED_ARRAY_SUPPORT?b.TYPED_ARRAY_SUPPORT:f();e.TYPED_ARRAY_SUPPORT&&(e.prototype.__proto__=
Uint8Array.prototype,e.__proto__=Uint8Array);e.isBuffer=function(a){return!(null==a||!a._isBuffer)};e.compare=function(a,b){if(!e.isBuffer(a)||!e.isBuffer(b))throw new TypeError("Arguments must be Buffers");if(a===b)return 0;for(var c=a.length,d=b.length,f=0,k=Math.min(c,d);f<k&&a[f]===b[f];)++f;f!==k&&(c=a[f],d=b[f]);return c<d?-1:d<c?1:0};e.isEncoding=function(a){switch(String(a).toLowerCase()){case "hex":case "utf8":case "utf-8":case "ascii":case "binary":case "base64":case "raw":case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":return!0;
default:return!1}};e.concat=function(a,b){if(!H(a))throw new TypeError("list argument must be an Array of Buffers.");if(0===a.length)return new e(0);var c;if(void 0===b)for(c=b=0;c<a.length;c++)b+=a[c].length;var d=new e(b),f=0;for(c=0;c<a.length;c++){var k=a[c];k.copy(d,f);f+=k.length}return d};e.byteLength=l;e.prototype.length=void 0;e.prototype.parent=void 0;e.prototype.toString=function(){var a=this.length|0;return 0===a?"":0===arguments.length?v(this,0,a):m.apply(this,arguments)};e.prototype.equals=
function(a){if(!e.isBuffer(a))throw new TypeError("Argument must be a Buffer");return this===a?!0:0===e.compare(this,a)};e.prototype.inspect=function(){var a="",b=h.INSPECT_MAX_BYTES;0<this.length&&(a=this.toString("hex",0,b).match(/.{2}/g).join(" "),this.length>b&&(a+=" ... "));return"<Buffer "+a+">"};e.prototype.compare=function(a){if(!e.isBuffer(a))throw new TypeError("Argument must be a Buffer");return this===a?0:e.compare(this,a)};e.prototype.indexOf=function(a,b){function c(a,b,d){for(var e=
-1,f=0;d+f<a.length;f++)if(a[d+f]===b[-1===e?0:f-e]){if(-1===e&&(e=f),f-e+1===b.length)return d+e}else e=-1;return-1}2147483647<b?b=2147483647:-2147483648>b&&(b=-2147483648);b>>=0;if(0===this.length||b>=this.length)return-1;0>b&&(b=Math.max(this.length+b,0));if("string"===typeof a)return 0===a.length?-1:String.prototype.indexOf.call(this,a,b);if(e.isBuffer(a))return c(this,a,b);if("number"===typeof a)return e.TYPED_ARRAY_SUPPORT&&"function"===Uint8Array.prototype.indexOf?Uint8Array.prototype.indexOf.call(this,
a,b):c(this,[a],b);throw new TypeError("val must be string, number or Buffer");};e.prototype.get=function(a){console.log(".get() is deprecated. Access using array indexes instead.");return this.readUInt8(a)};e.prototype.set=function(a,b){console.log(".set() is deprecated. Access using array indexes instead.");return this.writeUInt8(a,b)};e.prototype.write=function(a,b,c,d){if(void 0===b)d="utf8",c=this.length,b=0;else if(void 0===c&&"string"===typeof b)d=b,c=this.length,b=0;else if(isFinite(b))b|=
0,isFinite(c)?(c|=0,void 0===d&&(d="utf8")):(d=c,c=void 0);else{var e=d;d=b;b=c|0;c=e}e=this.length-b;if(void 0===c||c>e)c=e;if(0<a.length&&(0>c||0>b)||b>this.length)throw new RangeError("attempt to write outside buffer bounds");d||(d="utf8");for(e=!1;;)switch(d){case "hex":b=Number(b)||0;d=this.length-b;c?(c=Number(c),c>d&&(c=d)):c=d;d=a.length;if(0!==d%2)throw Error("Invalid hex string");c>d/2&&(c=d/2);for(d=0;d<c;d++){e=parseInt(a.substr(2*d,2),16);if(isNaN(e))throw Error("Invalid hex string");
this[b+d]=e}return d;case "utf8":case "utf-8":return y(z(a,this.length-b),this,b,c);case "ascii":return y(r(a),this,b,c);case "binary":return y(r(a),this,b,c);case "base64":return y(B.toByteArray(x(a)),this,b,c);case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":d=this.length-b;for(var f=void 0,f=e=void 0,k=[],g=0;g<a.length&&!(0>(d-=2));g++)f=a.charCodeAt(g),e=f>>8,f%=256,k.push(f),k.push(e);return y(k,this,b,c);default:if(e)throw new TypeError("Unknown encoding: "+d);d=(""+d).toLowerCase();
e=!0}};e.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var K=4096;e.prototype.slice=function(a,b){var c=this.length;a=~~a;b=void 0===b?c:~~b;0>a?(a+=c,0>a&&(a=0)):a>c&&(a=c);0>b?(b+=c,0>b&&(b=0)):b>c&&(b=c);b<a&&(b=a);if(e.TYPED_ARRAY_SUPPORT)c=e._augment(this.subarray(a,b));else for(var d=b-a,c=new e(d,void 0),f=0;f<d;f++)c[f]=this[f+a];c.length&&(c.parent=this.parent||this);return c};e.prototype.readUIntLE=function(a,b,c){a|=0;b|=0;c||u(a,
b,this.length);c=this[a];for(var d=1,e=0;++e<b&&(d*=256);)c+=this[a+e]*d;return c};e.prototype.readUIntBE=function(a,b,c){a|=0;b|=0;c||u(a,b,this.length);c=this[a+--b];for(var d=1;0<b&&(d*=256);)c+=this[a+--b]*d;return c};e.prototype.readUInt8=function(a,b){b||u(a,1,this.length);return this[a]};e.prototype.readUInt16LE=function(a,b){b||u(a,2,this.length);return this[a]|this[a+1]<<8};e.prototype.readUInt16BE=function(a,b){b||u(a,2,this.length);return this[a]<<8|this[a+1]};e.prototype.readUInt32LE=
function(a,b){b||u(a,4,this.length);return(this[a]|this[a+1]<<8|this[a+2]<<16)+16777216*this[a+3]};e.prototype.readUInt32BE=function(a,b){b||u(a,4,this.length);return 16777216*this[a]+(this[a+1]<<16|this[a+2]<<8|this[a+3])};e.prototype.readIntLE=function(a,b,c){a|=0;b|=0;c||u(a,b,this.length);c=this[a];for(var d=1,e=0;++e<b&&(d*=256);)c+=this[a+e]*d;c>=128*d&&(c-=Math.pow(2,8*b));return c};e.prototype.readIntBE=function(a,b,c){a|=0;b|=0;c||u(a,b,this.length);c=b;for(var d=1,e=this[a+--c];0<c&&(d*=
256);)e+=this[a+--c]*d;e>=128*d&&(e-=Math.pow(2,8*b));return e};e.prototype.readInt8=function(a,b){b||u(a,1,this.length);return this[a]&128?-1*(255-this[a]+1):this[a]};e.prototype.readInt16LE=function(a,b){b||u(a,2,this.length);var c=this[a]|this[a+1]<<8;return c&32768?c|4294901760:c};e.prototype.readInt16BE=function(a,b){b||u(a,2,this.length);var c=this[a+1]|this[a]<<8;return c&32768?c|4294901760:c};e.prototype.readInt32LE=function(a,b){b||u(a,4,this.length);return this[a]|this[a+1]<<8|this[a+2]<<
16|this[a+3]<<24};e.prototype.readInt32BE=function(a,b){b||u(a,4,this.length);return this[a]<<24|this[a+1]<<16|this[a+2]<<8|this[a+3]};e.prototype.readFloatLE=function(a,b){b||u(a,4,this.length);return E.read(this,a,!0,23,4)};e.prototype.readFloatBE=function(a,b){b||u(a,4,this.length);return E.read(this,a,!1,23,4)};e.prototype.readDoubleLE=function(a,b){b||u(a,8,this.length);return E.read(this,a,!0,52,8)};e.prototype.readDoubleBE=function(a,b){b||u(a,8,this.length);return E.read(this,a,!1,52,8)};
e.prototype.writeUIntLE=function(a,b,c,d){a=+a;b|=0;c|=0;d||w(this,a,b,c,Math.pow(2,8*c),0);d=1;var e=0;for(this[b]=a&255;++e<c&&(d*=256);)this[b+e]=a/d&255;return b+c};e.prototype.writeUIntBE=function(a,b,c,d){a=+a;b|=0;c|=0;d||w(this,a,b,c,Math.pow(2,8*c),0);d=c-1;var e=1;for(this[b+d]=a&255;0<=--d&&(e*=256);)this[b+d]=a/e&255;return b+c};e.prototype.writeUInt8=function(a,b,c){a=+a;b|=0;c||w(this,a,b,1,255,0);e.TYPED_ARRAY_SUPPORT||(a=Math.floor(a));this[b]=a&255;return b+1};e.prototype.writeUInt16LE=
function(a,b,c){a=+a;b|=0;c||w(this,a,b,2,65535,0);e.TYPED_ARRAY_SUPPORT?(this[b]=a&255,this[b+1]=a>>>8):A(this,a,b,!0);return b+2};e.prototype.writeUInt16BE=function(a,b,c){a=+a;b|=0;c||w(this,a,b,2,65535,0);e.TYPED_ARRAY_SUPPORT?(this[b]=a>>>8,this[b+1]=a&255):A(this,a,b,!1);return b+2};e.prototype.writeUInt32LE=function(a,b,c){a=+a;b|=0;c||w(this,a,b,4,4294967295,0);e.TYPED_ARRAY_SUPPORT?(this[b+3]=a>>>24,this[b+2]=a>>>16,this[b+1]=a>>>8,this[b]=a&255):C(this,a,b,!0);return b+4};e.prototype.writeUInt32BE=
function(a,b,c){a=+a;b|=0;c||w(this,a,b,4,4294967295,0);e.TYPED_ARRAY_SUPPORT?(this[b]=a>>>24,this[b+1]=a>>>16,this[b+2]=a>>>8,this[b+3]=a&255):C(this,a,b,!1);return b+4};e.prototype.writeIntLE=function(a,b,c,d){a=+a;b|=0;d||(d=Math.pow(2,8*c-1),w(this,a,b,c,d-1,-d));d=0;var e=1,f=0>a?1:0;for(this[b]=a&255;++d<c&&(e*=256);)this[b+d]=(a/e>>0)-f&255;return b+c};e.prototype.writeIntBE=function(a,b,c,d){a=+a;b|=0;d||(d=Math.pow(2,8*c-1),w(this,a,b,c,d-1,-d));d=c-1;var e=1,f=0>a?1:0;for(this[b+d]=a&255;0<=
--d&&(e*=256);)this[b+d]=(a/e>>0)-f&255;return b+c};e.prototype.writeInt8=function(a,b,c){a=+a;b|=0;c||w(this,a,b,1,127,-128);e.TYPED_ARRAY_SUPPORT||(a=Math.floor(a));0>a&&(a=255+a+1);this[b]=a&255;return b+1};e.prototype.writeInt16LE=function(a,b,c){a=+a;b|=0;c||w(this,a,b,2,32767,-32768);e.TYPED_ARRAY_SUPPORT?(this[b]=a&255,this[b+1]=a>>>8):A(this,a,b,!0);return b+2};e.prototype.writeInt16BE=function(a,b,c){a=+a;b|=0;c||w(this,a,b,2,32767,-32768);e.TYPED_ARRAY_SUPPORT?(this[b]=a>>>8,this[b+1]=a&
255):A(this,a,b,!1);return b+2};e.prototype.writeInt32LE=function(a,b,c){a=+a;b|=0;c||w(this,a,b,4,2147483647,-2147483648);e.TYPED_ARRAY_SUPPORT?(this[b]=a&255,this[b+1]=a>>>8,this[b+2]=a>>>16,this[b+3]=a>>>24):C(this,a,b,!0);return b+4};e.prototype.writeInt32BE=function(a,b,c){a=+a;b|=0;c||w(this,a,b,4,2147483647,-2147483648);0>a&&(a=4294967295+a+1);e.TYPED_ARRAY_SUPPORT?(this[b]=a>>>24,this[b+1]=a>>>16,this[b+2]=a>>>8,this[b+3]=a&255):C(this,a,b,!1);return b+4};e.prototype.writeFloatLE=function(a,
b,c){return D(this,a,b,!0,c)};e.prototype.writeFloatBE=function(a,b,c){return D(this,a,b,!1,c)};e.prototype.writeDoubleLE=function(a,b,c){return n(this,a,b,!0,c)};e.prototype.writeDoubleBE=function(a,b,c){return n(this,a,b,!1,c)};e.prototype.copy=function(a,b,c,d){c||(c=0);d||0===d||(d=this.length);b>=a.length&&(b=a.length);b||(b=0);0<d&&d<c&&(d=c);if(d===c||0===a.length||0===this.length)return 0;if(0>b)throw new RangeError("targetStart out of bounds");if(0>c||c>=this.length)throw new RangeError("sourceStart out of bounds");
if(0>d)throw new RangeError("sourceEnd out of bounds");d>this.length&&(d=this.length);a.length-b<d-c&&(d=a.length-b+c);var f=d-c;if(this===a&&c<b&&b<d)for(d=f-1;0<=d;d--)a[d+b]=this[d+c];else if(1E3>f||!e.TYPED_ARRAY_SUPPORT)for(d=0;d<f;d++)a[d+b]=this[d+c];else a._set(this.subarray(c,c+f),b);return f};e.prototype.fill=function(a,b,c){a||(a=0);b||(b=0);c||(c=this.length);if(c<b)throw new RangeError("end < start");if(c!==b&&0!==this.length){if(0>b||b>=this.length)throw new RangeError("start out of bounds");
if(0>c||c>this.length)throw new RangeError("end out of bounds");if("number"===typeof a)for(;b<c;b++)this[b]=a;else{a=z(a.toString());for(var d=a.length;b<c;b++)this[b]=a[b%d]}return this}};e.prototype.toArrayBuffer=function(){if("undefined"!==typeof Uint8Array){if(e.TYPED_ARRAY_SUPPORT)return(new e(this)).buffer;for(var a=new Uint8Array(this.length),b=0,c=a.length;b<c;b+=1)a[b]=this[b];return a.buffer}throw new TypeError("Buffer.toArrayBuffer not supported in this browser");};var t=e.prototype;e._augment=
function(a){a.constructor=e;a._isBuffer=!0;a._set=a.set;a.get=t.get;a.set=t.set;a.write=t.write;a.toString=t.toString;a.toLocaleString=t.toString;a.toJSON=t.toJSON;a.equals=t.equals;a.compare=t.compare;a.indexOf=t.indexOf;a.copy=t.copy;a.slice=t.slice;a.readUIntLE=t.readUIntLE;a.readUIntBE=t.readUIntBE;a.readUInt8=t.readUInt8;a.readUInt16LE=t.readUInt16LE;a.readUInt16BE=t.readUInt16BE;a.readUInt32LE=t.readUInt32LE;a.readUInt32BE=t.readUInt32BE;a.readIntLE=t.readIntLE;a.readIntBE=t.readIntBE;a.readInt8=
t.readInt8;a.readInt16LE=t.readInt16LE;a.readInt16BE=t.readInt16BE;a.readInt32LE=t.readInt32LE;a.readInt32BE=t.readInt32BE;a.readFloatLE=t.readFloatLE;a.readFloatBE=t.readFloatBE;a.readDoubleLE=t.readDoubleLE;a.readDoubleBE=t.readDoubleBE;a.writeUInt8=t.writeUInt8;a.writeUIntLE=t.writeUIntLE;a.writeUIntBE=t.writeUIntBE;a.writeUInt16LE=t.writeUInt16LE;a.writeUInt16BE=t.writeUInt16BE;a.writeUInt32LE=t.writeUInt32LE;a.writeUInt32BE=t.writeUInt32BE;a.writeIntLE=t.writeIntLE;a.writeIntBE=t.writeIntBE;
a.writeInt8=t.writeInt8;a.writeInt16LE=t.writeInt16LE;a.writeInt16BE=t.writeInt16BE;a.writeInt32LE=t.writeInt32LE;a.writeInt32BE=t.writeInt32BE;a.writeFloatLE=t.writeFloatLE;a.writeFloatBE=t.writeFloatBE;a.writeDoubleLE=t.writeDoubleLE;a.writeDoubleBE=t.writeDoubleBE;a.fill=t.fill;a.inspect=t.inspect;a.toArrayBuffer=t.toArrayBuffer;return a};var S=/[^+\/0-9A-Za-z-_]/g}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"base64-js":37,
ieee754:38,"is-array":39}],37:[function(g,l,h){(function(b){function f(b){b=b.charCodeAt(0);if(43===b||45===b)return 62;if(47===b||95===b)return 63;if(48>b)return-1;if(58>b)return b-48+52;if(91>b)return b-65;if(123>b)return b-97+26}var e="undefined"!==typeof Uint8Array?Uint8Array:Array;b.toByteArray=function(b){function c(a){m[l++]=a}var a,d,g,h,m;if(0<b.length%4)throw Error("Invalid string. Length must be a multiple of 4");a=b.length;h="="===b.charAt(a-2)?2:"="===b.charAt(a-1)?1:0;m=new e(3*b.length/
4-h);d=0<h?b.length-4:b.length;var l=0;for(a=0;a<d;a+=4)g=f(b.charAt(a))<<18|f(b.charAt(a+1))<<12|f(b.charAt(a+2))<<6|f(b.charAt(a+3)),c((g&16711680)>>16),c((g&65280)>>8),c(g&255);2===h?(g=f(b.charAt(a))<<2|f(b.charAt(a+1))>>4,c(g&255)):1===h&&(g=f(b.charAt(a))<<10|f(b.charAt(a+1))<<4|f(b.charAt(a+2))>>2,c(g>>8&255),c(g&255));return m};b.fromByteArray=function(b){var c,a=b.length%3,d="",e,f;c=0;for(f=b.length-a;c<f;c+=3)e=(b[c]<<16)+(b[c+1]<<8)+b[c+2],e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>
18&63)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>12&63)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>6&63)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e&63),d+=e;switch(a){case 1:e=b[b.length-1];d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>2);d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e<<4&63);d+="==";break;case 2:e=(b[b.length-2]<<8)+
b[b.length-1],d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>10),d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>4&63),d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e<<2&63),d+="="}return d}})("undefined"===typeof h?this.base64js={}:h)},{}],38:[function(g,l,h){h.read=function(b,f,e,k,c){var a;a=8*c-k-1;var d=(1<<a)-1,g=d>>1,h=-7;c=e?c-1:0;var m=e?-1:1,l=b[f+c];c+=m;e=l&(1<<-h)-1;l>>=-h;for(h+=a;0<h;e=256*
e+b[f+c],c+=m,h-=8);a=e&(1<<-h)-1;e>>=-h;for(h+=k;0<h;a=256*a+b[f+c],c+=m,h-=8);if(0===e)e=1-g;else{if(e===d)return a?NaN:Infinity*(l?-1:1);a+=Math.pow(2,k);e-=g}return(l?-1:1)*a*Math.pow(2,e-k)};h.write=function(b,f,e,k,c,a){var d,g=8*a-c-1,h=(1<<g)-1,m=h>>1,l=23===c?Math.pow(2,-24)-Math.pow(2,-77):0;a=k?0:a-1;var u=k?1:-1,w=0>f||0===f&&0>1/f?1:0;f=Math.abs(f);isNaN(f)||Infinity===f?(f=isNaN(f)?1:0,k=h):(k=Math.floor(Math.log(f)/Math.LN2),1>f*(d=Math.pow(2,-k))&&(k--,d*=2),f=1<=k+m?f+l/d:f+l*Math.pow(2,
1-m),2<=f*d&&(k++,d/=2),k+m>=h?(f=0,k=h):1<=k+m?(f=(f*d-1)*Math.pow(2,c),k+=m):(f=f*Math.pow(2,m-1)*Math.pow(2,c),k=0));for(;8<=c;b[e+a]=f&255,a+=u,f/=256,c-=8);k=k<<c|f;for(g+=c;0<g;b[e+a]=k&255,a+=u,k/=256,g-=8);b[e+a-u]|=128*w}},{}],39:[function(g,l,h){var b=Object.prototype.toString;l.exports=Array.isArray||function(f){return!!f&&"[object Array]"==b.call(f)}},{}],40:[function(g,l,h){function b(){this._events=this._events||{};this._maxListeners=this._maxListeners||void 0}function f(b){return"function"===
typeof b}function e(b){return"object"===typeof b&&null!==b}l.exports=b;b.EventEmitter=b;b.prototype._events=void 0;b.prototype._maxListeners=void 0;b.defaultMaxListeners=10;b.prototype.setMaxListeners=function(b){if("number"!==typeof b||0>b||isNaN(b))throw TypeError("n must be a positive number");this._maxListeners=b;return this};b.prototype.emit=function(b){var c,a,d,g;this._events||(this._events={});if("error"===b&&(!this._events.error||e(this._events.error)&&!this._events.error.length)){c=arguments[1];
if(c instanceof Error)throw c;throw TypeError('Uncaught, unspecified "error" event.');}a=this._events[b];if(void 0===a)return!1;if(f(a))switch(arguments.length){case 1:a.call(this);break;case 2:a.call(this,arguments[1]);break;case 3:a.call(this,arguments[1],arguments[2]);break;default:c=arguments.length;d=Array(c-1);for(g=1;g<c;g++)d[g-1]=arguments[g];a.apply(this,d)}else if(e(a)){c=arguments.length;d=Array(c-1);for(g=1;g<c;g++)d[g-1]=arguments[g];a=a.slice();c=a.length;for(g=0;g<c;g++)a[g].apply(this,
d)}return!0};b.prototype.addListener=function(g,c){var a;if(!f(c))throw TypeError("listener must be a function");this._events||(this._events={});this._events.newListener&&this.emit("newListener",g,f(c.listener)?c.listener:c);this._events[g]?e(this._events[g])?this._events[g].push(c):this._events[g]=[this._events[g],c]:this._events[g]=c;e(this._events[g])&&!this._events[g].warned&&(a=void 0!==this._maxListeners?this._maxListeners:b.defaultMaxListeners)&&0<a&&this._events[g].length>a&&(this._events[g].warned=
!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[g].length),"function"===typeof console.trace&&console.trace());return this};b.prototype.on=b.prototype.addListener;b.prototype.once=function(b,c){function a(){this.removeListener(b,a);d||(d=!0,c.apply(this,arguments))}if(!f(c))throw TypeError("listener must be a function");var d=!1;a.listener=c;this.on(b,a);return this};b.prototype.removeListener=
function(b,c){var a,d,g;if(!f(c))throw TypeError("listener must be a function");if(!this._events||!this._events[b])return this;a=this._events[b];g=a.length;d=-1;if(a===c||f(a.listener)&&a.listener===c)delete this._events[b],this._events.removeListener&&this.emit("removeListener",b,c);else if(e(a)){for(;0<g--;)if(a[g]===c||a[g].listener&&a[g].listener===c){d=g;break}if(0>d)return this;1===a.length?(a.length=0,delete this._events[b]):a.splice(d,1);this._events.removeListener&&this.emit("removeListener",
b,c)}return this};b.prototype.removeAllListeners=function(b){var c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[b]&&delete this._events[b],this;if(0===arguments.length){for(c in this._events)"removeListener"!==c&&this.removeAllListeners(c);this.removeAllListeners("removeListener");this._events={};return this}c=this._events[b];if(f(c))this.removeListener(b,c);else for(;c.length;)this.removeListener(b,c[c.length-1]);delete this._events[b];
return this};b.prototype.listeners=function(b){return this._events&&this._events[b]?f(this._events[b])?[this._events[b]]:this._events[b].slice():[]};b.listenerCount=function(b,c){return b._events&&b._events[c]?f(b._events[c])?1:b._events[c].length:0}},{}],41:[function(g,l,h){var b=l.exports;g("events");var f=g("./lib/request"),e=g("url");b.request=function(b,a){"string"===typeof b&&(b=e.parse(b));b||(b={});b.host||b.port||(b.port=parseInt(window.location.port,10));!b.host&&b.hostname&&(b.host=b.hostname);
b.protocol||(b.protocol=b.scheme?b.scheme+":":window.location.protocol);b.host||(b.host=window.location.hostname||window.location.host);/:/.test(b.host)&&(b.port||(b.port=b.host.split(":")[1]),b.host=b.host.split(":")[0]);b.port||(b.port="https:"==b.protocol?443:80);var d=new f(new k,b);if(a)d.on("response",a);return d};b.get=function(c,a){c.method="GET";var d=b.request(c,a);d.end();return d};b.Agent=function(){};b.Agent.defaultMaxSockets=4;var k=function(){if("undefined"===typeof window)throw Error("no window object present");
if(window.XMLHttpRequest)return window.XMLHttpRequest;if(window.ActiveXObject)for(var b=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"],a=0;a<b.length;a++)try{var d=new window.ActiveXObject(b[a]);return function(){if(d){var e=d;d=null;return e}return new window.ActiveXObject(b[a])}}catch(e){}throw Error("ajax not supported in this browser");}();b.STATUS_CODES={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",
204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Time-out",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",
414:"Request-URI Too Large",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Time-out",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",
507:"Insufficient Storage",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"}},{"./lib/request":42,events:40,url:67}],42:[function(g,l,h){h=g("stream");var b=g("./response"),f=g("Base64");g=g("inherits");var e=l.exports=function(a,c){var e=this;e.writable=!0;e.xhr=a;e.body=[];e.uri=(c.protocol||"http:")+"//"+c.host+(c.port?":"+c.port:"")+(c.path||"/");"undefined"===typeof c.withCredentials&&(c.withCredentials=!0);try{a.withCredentials=c.withCredentials}catch(g){}if(c.responseType)try{a.responseType=
c.responseType}catch(g){}a.open(c.method||"GET",e.uri,!0);a.onerror=function(a){e.emit("error",Error("Network error"))};e._headers={};if(c.headers)for(var h=k(c.headers),m=0;m<h.length;m++){var l=h[m];e.isSafeRequestHeader(l)&&e.setHeader(l,c.headers[l])}c.auth&&this.setHeader("Authorization","Basic "+f.btoa(c.auth));var u=new b;u.on("close",function(){e.emit("close")});u.on("ready",function(){e.emit("response",u)});u.on("error",function(a){e.emit("error",a)});a.onreadystatechange=function(){a.__aborted||
u.handle(a)}};g(e,h);e.prototype.setHeader=function(a,b){this._headers[a.toLowerCase()]=b};e.prototype.getHeader=function(a){return this._headers[a.toLowerCase()]};e.prototype.removeHeader=function(a){delete this._headers[a.toLowerCase()]};e.prototype.write=function(a){this.body.push(a)};e.prototype.destroy=function(a){this.xhr.__aborted=!0;this.xhr.abort();this.emit("close")};e.prototype.end=function(a){void 0!==a&&this.body.push(a);var b=k(this._headers);for(a=0;a<b.length;a++){var e=b[a],f=this._headers[e];
if(c(f))for(var g=0;g<f.length;g++)this.xhr.setRequestHeader(e,f[g]);else this.xhr.setRequestHeader(e,f)}if(0===this.body.length)this.xhr.send("");else if("string"===typeof this.body[0])this.xhr.send(this.body.join(""));else if(c(this.body[0])){b=[];for(a=0;a<this.body.length;a++)b.push.apply(b,this.body[a]);this.xhr.send(b)}else if(/Array/.test(Object.prototype.toString.call(this.body[0]))){for(a=g=0;a<this.body.length;a++)g+=this.body[a].length;b=new this.body[0].constructor(g);for(a=e=0;a<this.body.length;a++)for(f=
this.body[a],g=0;g<f.length;g++)b[e++]=f[g];this.xhr.send(b)}else if(a=this.body[0],a="undefined"!==typeof Blob&&a instanceof Blob?!0:"undefined"!==typeof ArrayBuffer&&a instanceof ArrayBuffer?!0:"undefined"!==typeof FormData&&a instanceof FormData?!0:void 0,a)this.xhr.send(this.body[0]);else{b="";for(a=0;a<this.body.length;a++)b+=this.body[a].toString();this.xhr.send(b)}};e.unsafeHeaders="accept-charset accept-encoding access-control-request-headers access-control-request-method connection content-length cookie cookie2 content-transfer-encoding date expect host keep-alive origin referer te trailer transfer-encoding upgrade user-agent via".split(" ");
e.prototype.isSafeRequestHeader=function(a){if(!a)return!1;var b;a:if(b=e.unsafeHeaders,a=a.toLowerCase(),b.indexOf)b=b.indexOf(a);else{for(var c=0;c<b.length;c++)if(b[c]===a){b=c;break a}b=-1}return-1===b};var k=Object.keys||function(a){var b=[],c;for(c in a)b.push(c);return b},c=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)}},{"./response":43,Base64:44,inherits:46,stream:65}],43:[function(g,l,h){function b(b){b=b.getAllResponseHeaders().split(/\r?\n/);for(var a=
{},d=0;d<b.length;d++){var e=b[d];if(""!==e){var f=e.match(/^([^:]+):\s*(.*)/);f?(e=f[1].toLowerCase(),f=f[2],void 0!==a[e]?k(a[e])?a[e].push(f):a[e]=[a[e],f]:a[e]=f):a[e]=!0}}return a}h=g("stream");g=g("util");l=l.exports=function(b){this.offset=0;this.readable=!0};g.inherits(l,h);var f=!0,e=!0;l.prototype.getResponse=function(b){var a=String(b.responseType).toLowerCase();return"blob"===a?b.responseBlob||b.response:"arraybuffer"===a?b.response:b.responseText};l.prototype.getHeader=function(b){return this.headers[b.toLowerCase()]};
l.prototype.handle=function(c){if(2===c.readyState&&e){try{this.statusCode=c.status,this.headers=b(c)}catch(a){e=!1}e&&this.emit("ready")}else if(f&&3===c.readyState){try{this.statusCode||(this.statusCode=c.status,this.headers=b(c),this.emit("ready"))}catch(a){}try{this._emitData(c)}catch(a){f=!1}}else 4===c.readyState&&(this.statusCode||(this.statusCode=c.status,this.emit("ready")),this._emitData(c),c.error?this.emit("error",this.getResponse(c)):this.emit("end"),this.emit("close"))};l.prototype._emitData=
function(b){b=this.getResponse(b);b.toString().match(/ArrayBuffer/)?(this.emit("data",new Uint8Array(b,this.offset)),this.offset=b.byteLength):b.length>this.offset&&(this.emit("data",b.slice(this.offset)),this.offset=b.length)};var k=Array.isArray||function(b){return"[object Array]"===Object.prototype.toString.call(b)}},{stream:65,util:69}],44:[function(g,l,h){(function(){function b(b){this.message=b}var f="undefined"!=typeof h?h:this;b.prototype=Error();b.prototype.name="InvalidCharacterError";f.btoa||
(f.btoa=function(e){for(var f,c,a=0,d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",g="";e.charAt(a|0)||(d="=",a%1);g+=d.charAt(63&f>>8-a%1*8)){c=e.charCodeAt(a+=.75);if(255<c)throw new b("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");f=f<<8|c}return g});f.atob||(f.atob=function(e){e=e.replace(/=+$/,"");if(1==e.length%4)throw new b("'atob' failed: The string to be decoded is not correctly encoded.");for(var f=0,c,a,d=0,g="";a=e.charAt(d++);~a&&
(c=f%4?64*c+a:a,f++%4)?g+=String.fromCharCode(255&c>>(-2*f&6)):0)a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a);return g})})()},{}],45:[function(g,l,h){var b=g("http");g=l.exports;for(var f in b)b.hasOwnProperty(f)&&(g[f]=b[f]);g.request=function(e,f){e||(e={});e.scheme="https";e.protocol="https:";return b.request.call(this,e,f)}},{http:41}],46:[function(g,l,h){l.exports="function"===typeof Object.create?function(b,f){b.super_=f;b.prototype=Object.create(f.prototype,
{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}})}:function(b,f){b.super_=f;var e=function(){};e.prototype=f.prototype;b.prototype=new e;b.prototype.constructor=b}},{}],47:[function(g,l,h){l.exports=function(b){return!(null==b||!(b._isBuffer||b.constructor&&"function"===typeof b.constructor.isBuffer&&b.constructor.isBuffer(b)))}},{}],48:[function(g,l,h){l.exports=Array.isArray||function(b){return"[object Array]"==Object.prototype.toString.call(b)}},{}],49:[function(g,l,h){function b(){if(!k){k=
!0;for(var b,a=e.length;a;){b=e;e=[];for(var d=-1;++d<a;)b[d]();a=e.length}k=!1}}function f(){}g=l.exports={};var e=[],k=!1;g.nextTick=function(c){e.push(c);k||setTimeout(b,0)};g.title="browser";g.browser=!0;g.env={};g.argv=[];g.version="";g.versions={};g.on=f;g.addListener=f;g.once=f;g.off=f;g.removeListener=f;g.removeAllListeners=f;g.emit=f;g.binding=function(b){throw Error("process.binding is not supported");};g.cwd=function(){return"/"};g.chdir=function(b){throw Error("process.chdir is not supported");
};g.umask=function(){return 0}},{}],50:[function(g,l,h){(function(b){(function(f){function e(a){throw RangeError(x[a]);}function g(a,b){for(var c=a.length;c--;)a[c]=b(a[c]);return a}function c(a,b){return g(a.split(n),b).join(".")}function a(a){for(var b=[],c=0,d=a.length,e,f;c<d;)e=a.charCodeAt(c++),55296<=e&&56319>=e&&c<d?(f=a.charCodeAt(c++),56320==(f&64512)?b.push(((e&1023)<<10)+(f&1023)+65536):(b.push(e),c--)):b.push(e);return b}function d(a){return g(a,function(a){var b="";65535<a&&(a-=65536,
b+=r(a>>>10&1023|55296),a=56320|a&1023);return b+=r(a)}).join("")}function p(a,b){return a+22+75*(26>a)-((0!=b)<<5)}function G(a,b,c){var d=0;a=c?z(a/700):a>>1;for(a+=z(a/b);455<a;d+=36)a=z(a/35);return z(d+36*a/(a+38))}function m(a){var b=[],c=a.length,f,g=0,k=128,n=72,y,h,l,p,q;y=a.lastIndexOf("-");0>y&&(y=0);for(h=0;h<y;++h)128<=a.charCodeAt(h)&&e("not-basic"),b.push(a.charCodeAt(h));for(y=0<y?y+1:0;y<c;){h=g;f=1;for(l=36;;l+=36){y>=c&&e("invalid-input");p=a.charCodeAt(y++);p=10>p-48?p-22:26>p-
65?p-65:26>p-97?p-97:36;(36<=p||p>z((2147483647-g)/f))&&e("overflow");g+=p*f;q=l<=n?1:l>=n+26?26:l-n;if(p<q)break;p=36-q;f>z(2147483647/p)&&e("overflow");f*=p}f=b.length+1;n=G(g-h,f,0==h);z(g/f)>2147483647-k&&e("overflow");k+=z(g/f);g%=f;b.splice(g++,0,k)}return d(b)}function v(b){var c,d,f,g,k,n,y,h,l,q=[],m,x,v;b=a(b);m=b.length;c=128;d=0;k=72;for(n=0;n<m;++n)l=b[n],128>l&&q.push(r(l));for((f=g=q.length)&&q.push("-");f<m;){y=2147483647;for(n=0;n<m;++n)l=b[n],l>=c&&l<y&&(y=l);x=f+1;y-c>z((2147483647-
d)/x)&&e("overflow");d+=(y-c)*x;c=y;for(n=0;n<m;++n)if(l=b[n],l<c&&2147483647<++d&&e("overflow"),l==c){h=d;for(y=36;;y+=36){l=y<=k?1:y>=k+26?26:y-k;if(h<l)break;v=h-l;h=36-l;q.push(r(p(l+v%h,0)));h=z(v/h)}q.push(r(p(h,0)));k=G(d,x,f==g);d=0;++f}++d;++c}return q.join("")}var u="object"==typeof h&&h,w="object"==typeof l&&l&&l.exports==u&&l,A="object"==typeof b&&b;if(A.global===A||A.window===A)f=A;var C,q=/^xn--/,D=/[^ -~]/,n=/\x2E|\u3002|\uFF0E|\uFF61/g,x={overflow:"Overflow: input needs wider integers to process",
"not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},z=Math.floor,r=String.fromCharCode,y;C={version:"1.2.4",ucs2:{decode:a,encode:d},decode:m,encode:v,toASCII:function(a){return c(a,function(a){return D.test(a)?"xn--"+v(a):a})},toUnicode:function(a){return c(a,function(a){return q.test(a)?m(a.slice(4).toLowerCase()):a})}};if("function"==typeof define&&"object"==typeof define.amd&&define.amd)define("punycode",function(){return C});else if(u&&!u.nodeType)if(w)w.exports=
C;else for(y in C)C.hasOwnProperty(y)&&(u[y]=C[y]);else f.punycode=C})(this)}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],51:[function(g,l,h){l.exports=function(f,e,g,c){g=g||"=";var a={};if("string"!==typeof f||0===f.length)return a;var d=/\+/g;f=f.split(e||"&");e=1E3;c&&"number"===typeof c.maxKeys&&(e=c.maxKeys);c=f.length;0<e&&c>e&&(c=e);for(e=0;e<c;++e){var h=f[e].replace(d,"%20"),l=h.indexOf(g),m;0<=l?(m=h.substr(0,
l),h=h.substr(l+1)):(m=h,h="");m=decodeURIComponent(m);h=decodeURIComponent(h);Object.prototype.hasOwnProperty.call(a,m)?b(a[m])?a[m].push(h):a[m]=[a[m],h]:a[m]=h}return a};var b=Array.isArray||function(b){return"[object Array]"===Object.prototype.toString.call(b)}},{}],52:[function(g,l,h){function b(b,a){if(b.map)return b.map(a);for(var d=[],e=0;e<b.length;e++)d.push(a(b[e],e));return d}var f=function(b){switch(typeof b){case "string":return b;case "boolean":return b?"true":"false";case "number":return isFinite(b)?
b:"";default:return""}};l.exports=function(c,a,d,g){a=a||"&";d=d||"=";null===c&&(c=void 0);return"object"===typeof c?b(k(c),function(g){var k=encodeURIComponent(f(g))+d;return e(c[g])?b(c[g],function(a){return k+encodeURIComponent(f(a))}).join(a):k+encodeURIComponent(f(c[g]))}).join(a):g?encodeURIComponent(f(g))+d+encodeURIComponent(f(c)):""};var e=Array.isArray||function(b){return"[object Array]"===Object.prototype.toString.call(b)},k=Object.keys||function(b){var a=[],d;for(d in b)Object.prototype.hasOwnProperty.call(b,
d)&&a.push(d);return a}},{}],53:[function(g,l,h){h.decode=h.parse=g("./decode");h.encode=h.stringify=g("./encode")},{"./decode":51,"./encode":52}],54:[function(g,l,h){l.exports=g("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":55}],55:[function(g,l,h){(function(b){function f(b){if(!(this instanceof f))return new f(b);a.call(this,b);d.call(this,b);b&&!1===b.readable&&(this.readable=!1);b&&!1===b.writable&&(this.writable=!1);this.allowHalfOpen=!0;b&&!1===b.allowHalfOpen&&(this.allowHalfOpen=
!1);this.once("end",e)}function e(){this.allowHalfOpen||this._writableState.ended||b.nextTick(this.end.bind(this))}l.exports=f;var k=Object.keys||function(a){var b=[],c;for(c in a)b.push(c);return b},c=g("core-util-is");c.inherits=g("inherits");var a=g("./_stream_readable"),d=g("./_stream_writable");c.inherits(f,a);(function(a,b){for(var c=0,d=a.length;c<d;c++)b(a[c],c)})(k(d.prototype),function(a){f.prototype[a]||(f.prototype[a]=d.prototype[a])})}).call(this,g("_process"))},{"./_stream_readable":57,
"./_stream_writable":59,_process:49,"core-util-is":60,inherits:46}],56:[function(g,l,h){function b(e){if(!(this instanceof b))return new b(e);f.call(this,e)}l.exports=b;var f=g("./_stream_transform");l=g("core-util-is");l.inherits=g("inherits");l.inherits(b,f);b.prototype._transform=function(b,f,c){c(null,b)}},{"./_stream_transform":58,"core-util-is":60,inherits:46}],57:[function(g,l,h){(function(b){function f(a,b){var c=g("./_stream_duplex");a=a||{};var d=a.highWaterMark,e=a.objectMode?16:16384;
this.highWaterMark=d||0===d?d:e;this.highWaterMark=~~this.highWaterMark;this.buffer=[];this.length=0;this.pipes=null;this.pipesCount=0;this.flowing=null;this.reading=this.endEmitted=this.ended=!1;this.sync=!0;this.readableListening=this.emittedReadable=this.needReadable=!1;this.objectMode=!!a.objectMode;b instanceof c&&(this.objectMode=this.objectMode||!!a.readableObjectMode);this.defaultEncoding=a.defaultEncoding||"utf8";this.ranOut=!1;this.awaitDrain=0;this.readingMore=!1;this.encoding=this.decoder=
null;a.encoding&&(z||(z=g("string_decoder/").StringDecoder),this.decoder=new z(a.encoding),this.encoding=a.encoding)}function e(a){g("./_stream_duplex");if(!(this instanceof e))return new e(a);this._readableState=new f(a,this);this.readable=!0;n.call(this)}function k(b,c,d,e,f){var g;g=d;var k=null;x.isBuffer(g)||x.isString(g)||x.isNullOrUndefined(g)||c.objectMode||(k=new TypeError("Invalid non-string/buffer chunk"));(g=k)?b.emit("error",g):x.isNullOrUndefined(d)?(c.reading=!1,c.ended||(c.decoder&&
!c.ended&&(d=c.decoder.end())&&d.length&&(c.buffer.push(d),c.length+=c.objectMode?1:d.length),c.ended=!0,a(b))):c.objectMode||d&&0<d.length?c.ended&&!f?(d=Error("stream.push() after EOF"),b.emit("error",d)):c.endEmitted&&f?(d=Error("stream.unshift() after end event"),b.emit("error",d)):(!c.decoder||f||e||(d=c.decoder.write(d)),f||(c.reading=!1),c.flowing&&0===c.length&&!c.sync?(b.emit("data",d),b.read(0)):(c.length+=c.objectMode?1:d.length,f?c.buffer.unshift(d):c.buffer.push(d),c.needReadable&&a(b)),
h(b,c)):f||(c.reading=!1);return!c.ended&&(c.needReadable||c.length<c.highWaterMark||0===c.length)}function c(a,b){if(0===b.length&&b.ended)return 0;if(b.objectMode)return 0===a?0:1;if(isNaN(a)||x.isNull(a))return b.flowing&&b.buffer.length?b.buffer[0].length:b.length;if(0>=a)return 0;if(a>b.highWaterMark){var c=a;if(8388608<=c)c=8388608;else{c--;for(var d=1;32>d;d<<=1)c|=c>>d;c++}b.highWaterMark=c}if(a>b.length){if(b.ended)return b.length;b.needReadable=!0;return 0}return a}function a(a){var c=a._readableState;
c.needReadable=!1;c.emittedReadable||(r("emitReadable",c.flowing),c.emittedReadable=!0,c.sync?b.nextTick(function(){d(a)}):d(a))}function d(a){r("emit readable");a.emit("readable");v(a)}function h(a,c){c.readingMore||(c.readingMore=!0,b.nextTick(function(){for(var b=c.length;!c.reading&&!c.flowing&&!c.ended&&c.length<c.highWaterMark&&(r("maybeReadMore read 0"),a.read(0),b!==c.length);)b=c.length;c.readingMore=!1}))}function G(a){return function(){var b=a._readableState;r("pipeOnDrain",b.awaitDrain);
b.awaitDrain&&b.awaitDrain--;0===b.awaitDrain&&D.listenerCount(a,"data")&&(b.flowing=!0,v(a))}}function m(a,c){c.resumeScheduled||(c.resumeScheduled=!0,b.nextTick(function(){c.resumeScheduled=!1;a.emit("resume");v(a);c.flowing&&!c.reading&&a.read(0)}))}function v(a){var b=a._readableState;r("flow",b.flowing);if(b.flowing){do var c=a.read();while(null!==c&&b.flowing)}}function u(a,b){var c=b.buffer,d=b.length,e=!!b.decoder,f=!!b.objectMode;if(0===c.length)return null;if(0===d)d=null;else if(f)d=c.shift();
else if(!a||a>=d)d=e?c.join(""):q.concat(c,d),c.length=0;else if(a<c[0].length)f=c[0],d=f.slice(0,a),c[0]=f.slice(a);else if(a===c[0].length)d=c.shift();else for(var d=e?"":new q(a),g=0,k=0,n=c.length;k<n&&g<a;k++){var f=c[0],h=Math.min(a-g,f.length);e?d+=f.slice(0,h):f.copy(d,g,0,h);h<f.length?c[0]=f.slice(h):c.shift();g+=h}return d}function w(a){var c=a._readableState;if(0<c.length)throw Error("endReadable called on non-empty stream");c.endEmitted||(c.ended=!0,b.nextTick(function(){c.endEmitted||
0!==c.length||(c.endEmitted=!0,a.readable=!1,a.emit("end"))}))}function A(a,b){for(var c=0,d=a.length;c<d;c++)b(a[c],c)}l.exports=e;var C=g("isarray"),q=g("buffer").Buffer;e.ReadableState=f;var D=g("events").EventEmitter;D.listenerCount||(D.listenerCount=function(a,b){return a.listeners(b).length});var n=g("stream"),x=g("core-util-is");x.inherits=g("inherits");var z,r=g("util"),r=r&&r.debuglog?r.debuglog("stream"):function(){};x.inherits(e,n);e.prototype.push=function(a,b){var c=this._readableState;
x.isString(a)&&!c.objectMode&&(b=b||c.defaultEncoding,b!==c.encoding&&(a=new q(a,b),b=""));return k(this,c,a,b,!1)};e.prototype.unshift=function(a){return k(this,this._readableState,a,"",!0)};e.prototype.setEncoding=function(a){z||(z=g("string_decoder/").StringDecoder);this._readableState.decoder=new z(a);this._readableState.encoding=a;return this};e.prototype.read=function(b){r("read",b);var d=this._readableState,e=b;if(!x.isNumber(b)||0<b)d.emittedReadable=!1;if(0===b&&d.needReadable&&(d.length>=
d.highWaterMark||d.ended))return r("read: emitReadable",d.length,d.ended),0===d.length&&d.ended?w(this):a(this),null;b=c(b,d);if(0===b&&d.ended)return 0===d.length&&w(this),null;var f=d.needReadable;r("need readable",f);if(0===d.length||d.length-b<d.highWaterMark)f=!0,r("length less than watermark",f);if(d.ended||d.reading)f=!1,r("reading or ended",f);f&&(r("do read"),d.reading=!0,d.sync=!0,0===d.length&&(d.needReadable=!0),this._read(d.highWaterMark),d.sync=!1);f&&!d.reading&&(b=c(e,d));f=0<b?u(b,
d):null;x.isNull(f)&&(d.needReadable=!0,b=0);d.length-=b;0!==d.length||d.ended||(d.needReadable=!0);e!==b&&d.ended&&0===d.length&&w(this);x.isNull(f)||this.emit("data",f);return f};e.prototype._read=function(a){this.emit("error",Error("not implemented"))};e.prototype.pipe=function(a,c){function d(a){r("onunpipe");a===q&&f()}function e(){r("onend");a.end()}function f(){r("cleanup");a.removeListener("close",n);a.removeListener("finish",h);a.removeListener("drain",p);a.removeListener("error",k);a.removeListener("unpipe",
d);q.removeListener("end",e);q.removeListener("end",f);q.removeListener("data",g);!x.awaitDrain||a._writableState&&!a._writableState.needDrain||p()}function g(b){r("ondata");!1===a.write(b)&&(r("false write response, pause",q._readableState.awaitDrain),q._readableState.awaitDrain++,q.pause())}function k(b){r("onerror",b);l();a.removeListener("error",k);0===D.listenerCount(a,"error")&&a.emit("error",b)}function n(){a.removeListener("finish",h);l()}function h(){r("onfinish");a.removeListener("close",
n);l()}function l(){r("unpipe");q.unpipe(a)}var q=this,x=this._readableState;switch(x.pipesCount){case 0:x.pipes=a;break;case 1:x.pipes=[x.pipes,a];break;default:x.pipes.push(a)}x.pipesCount+=1;r("pipe count=%d opts=%j",x.pipesCount,c);var m=c&&!1===c.end||a===b.stdout||a===b.stderr?f:e;if(x.endEmitted)b.nextTick(m);else q.once("end",m);a.on("unpipe",d);var p=G(q);a.on("drain",p);q.on("data",g);if(a._events&&a._events.error)C(a._events.error)?a._events.error.unshift(k):a._events.error=[k,a._events.error];
else a.on("error",k);a.once("close",n);a.once("finish",h);a.emit("pipe",q);x.flowing||(r("pipe resume"),q.resume());return a};e.prototype.unpipe=function(a){var b=this._readableState;if(0===b.pipesCount)return this;if(1===b.pipesCount){if(a&&a!==b.pipes)return this;a||(a=b.pipes);b.pipes=null;b.pipesCount=0;b.flowing=!1;a&&a.emit("unpipe",this);return this}if(!a){a=b.pipes;var c=b.pipesCount;b.pipes=null;b.pipesCount=0;b.flowing=!1;for(var d=0;d<c;d++)a[d].emit("unpipe",this);return this}a:{for(var d=
b.pipes,c=0,e=d.length;c<e;c++)if(d[c]===a){d=c;break a}d=-1}if(-1===d)return this;b.pipes.splice(d,1);--b.pipesCount;1===b.pipesCount&&(b.pipes=b.pipes[0]);a.emit("unpipe",this);return this};e.prototype.on=function(c,d){var e=n.prototype.on.call(this,c,d);"data"===c&&!1!==this._readableState.flowing&&this.resume();if("readable"===c&&this.readable){var f=this._readableState;if(!f.readableListening)if(f.readableListening=!0,f.emittedReadable=!1,f.needReadable=!0,f.reading)f.length&&a(this,f);else{var g=
this;b.nextTick(function(){r("readable nexttick read 0");g.read(0)})}}return e};e.prototype.addListener=e.prototype.on;e.prototype.resume=function(){var a=this._readableState;a.flowing||(r("resume"),a.flowing=!0,a.reading||(r("resume read 0"),this.read(0)),m(this,a));return this};e.prototype.pause=function(){r("call pause flowing=%j",this._readableState.flowing);!1!==this._readableState.flowing&&(r("pause"),this._readableState.flowing=!1,this.emit("pause"));return this};e.prototype.wrap=function(a){var b=
this._readableState,c=!1,d=this;a.on("end",function(){r("wrapped end");if(b.decoder&&!b.ended){var a=b.decoder.end();a&&a.length&&d.push(a)}d.push(null)});a.on("data",function(e){r("wrapped data");b.decoder&&(e=b.decoder.write(e));e&&(b.objectMode||e.length)&&!d.push(e)&&(c=!0,a.pause())});for(var e in a)x.isFunction(a[e])&&x.isUndefined(this[e])&&(this[e]=function(b){return function(){return a[b].apply(a,arguments)}}(e));A(["error","close","destroy","pause","resume"],function(b){a.on(b,d.emit.bind(d,
b))});d._read=function(b){r("wrapped _read",b);c&&(c=!1,a.resume())};return d};e._fromList=u}).call(this,g("_process"))},{"./_stream_duplex":55,_process:49,buffer:36,"core-util-is":60,events:40,inherits:46,isarray:48,stream:65,"string_decoder/":66,util:35}],58:[function(g,l,h){function b(a,b){this.afterTransform=function(a,e){var f;f=b._transformState;f.transforming=!1;var g=f.writecb;g?(f.writechunk=null,f.writecb=null,c.isNullOrUndefined(e)||b.push(e),g&&g(a),f=b._readableState,f.reading=!1,(f.needReadable||
f.length<f.highWaterMark)&&b._read(f.highWaterMark),f=void 0):f=b.emit("error",Error("no writecb in Transform class"));return f};this.transforming=this.needTransform=!1;this.writechunk=this.writecb=null}function f(a){if(!(this instanceof f))return new f(a);k.call(this,a);this._transformState=new b(a,this);var d=this;this._readableState.needReadable=!0;this._readableState.sync=!1;this.once("prefinish",function(){c.isFunction(this._flush)?this._flush(function(a){e(d,a)}):e(d)})}function e(a,b){if(b)return a.emit("error",
b);var c=a._transformState;if(a._writableState.length)throw Error("calling transform done when ws.length != 0");if(c.transforming)throw Error("calling transform done when still transforming");return a.push(null)}l.exports=f;var k=g("./_stream_duplex"),c=g("core-util-is");c.inherits=g("inherits");c.inherits(f,k);f.prototype.push=function(a,b){this._transformState.needTransform=!1;return k.prototype.push.call(this,a,b)};f.prototype._transform=function(a,b,c){throw Error("not implemented");};f.prototype._write=
function(a,b,c){var e=this._transformState;e.writecb=c;e.writechunk=a;e.writeencoding=b;e.transforming||(a=this._readableState,(e.needTransform||a.needReadable||a.length<a.highWaterMark)&&this._read(a.highWaterMark))};f.prototype._read=function(a){a=this._transformState;c.isNull(a.writechunk)||!a.writecb||a.transforming?a.needTransform=!0:(a.transforming=!0,this._transform(a.writechunk,a.writeencoding,a.afterTransform))}},{"./_stream_duplex":55,"core-util-is":60,inherits:46}],59:[function(g,l,h){(function(b){function f(a,
b,c){this.chunk=a;this.encoding=b;this.callback=c}function e(a,b){var c=g("./_stream_duplex");a=a||{};var d=a.highWaterMark,e=a.objectMode?16:16384;this.highWaterMark=d||0===d?d:e;this.objectMode=!!a.objectMode;b instanceof c&&(this.objectMode=this.objectMode||!!a.writableObjectMode);this.highWaterMark=~~this.highWaterMark;this.finished=this.ended=this.ending=this.needDrain=!1;this.decodeStrings=!1!==a.decodeStrings;this.defaultEncoding=a.defaultEncoding||"utf8";this.length=0;this.writing=!1;this.corked=
0;this.sync=!0;this.bufferProcessing=!1;this.onwrite=function(a){v(b,a)};this.writecb=null;this.writelen=0;this.buffer=[];this.pendingcb=0;this.errorEmitted=this.prefinished=!1}function k(a){var b=g("./_stream_duplex");if(!(this instanceof k||this instanceof b))return new k(a);this._writableState=new e(a,this);this.writable=!0;D.call(this)}function c(a,c,d){var e=Error("write after end");a.emit("error",e);b.nextTick(function(){d(e)})}function a(a,c,d,e){var f=!0;if(!(q.isBuffer(d)||q.isString(d)||
q.isNullOrUndefined(d)||c.objectMode)){var g=new TypeError("Invalid non-string/buffer chunk");a.emit("error",g);b.nextTick(function(){e(g)});f=!1}return f}function d(a,b,c,d,e){var g=d;!b.objectMode&&!1!==b.decodeStrings&&q.isString(c)&&(c=new C(c,g));q.isBuffer(c)&&(d="buffer");g=b.objectMode?1:c.length;b.length+=g;var k=b.length<b.highWaterMark;k||(b.needDrain=!0);b.writing||b.corked?b.buffer.push(new f(c,d,e)):h(a,b,!1,g,c,d,e);return k}function h(a,b,c,d,e,f,g){b.writelen=d;b.writecb=g;b.writing=
!0;b.sync=!0;c?a._writev(e,b.onwrite):a._write(e,f,b.onwrite);b.sync=!1}function G(a,c,d,e,f){d?b.nextTick(function(){c.pendingcb--;f(e)}):(c.pendingcb--,f(e));a._writableState.errorEmitted=!0;a.emit("error",e)}function m(a){a.writing=!1;a.writecb=null;a.length-=a.writelen;a.writelen=0}function v(a,c){var d=a._writableState,e=d.sync,f=d.writecb;m(d);if(c)G(a,d,e,c,f);else{var g=d.ending&&0===d.length&&!d.finished&&!d.writing;g||d.corked||d.bufferProcessing||!d.buffer.length||w(a,d);e?b.nextTick(function(){u(a,
d,g,f)}):u(a,d,g,f)}}function u(a,b,c,d){!c&&0===b.length&&b.needDrain&&(b.needDrain=!1,a.emit("drain"));b.pendingcb--;d();A(a,b)}function w(a,b){b.bufferProcessing=!0;if(a._writev&&1<b.buffer.length){for(var c=[],d=0;d<b.buffer.length;d++)c.push(b.buffer[d].callback);b.pendingcb++;h(a,b,!0,b.length,b.buffer,"",function(a){for(var d=0;d<c.length;d++)b.pendingcb--,c[d](a)});b.buffer=[]}else{for(d=0;d<b.buffer.length;d++){var e=b.buffer[d],f=e.chunk;h(a,b,!1,b.objectMode?1:f.length,f,e.encoding,e.callback);
if(b.writing){d++;break}}d<b.buffer.length?b.buffer=b.buffer.slice(d):b.buffer.length=0}b.bufferProcessing=!1}function A(a,b){var c=b.ending&&0===b.length&&!b.finished&&!b.writing;c&&(0===b.pendingcb?(b.prefinished||(b.prefinished=!0,a.emit("prefinish")),b.finished=!0,a.emit("finish")):b.prefinished||(b.prefinished=!0,a.emit("prefinish")));return c}l.exports=k;var C=g("buffer").Buffer;k.WritableState=e;var q=g("core-util-is");q.inherits=g("inherits");var D=g("stream");q.inherits(k,D);k.prototype.pipe=
function(){this.emit("error",Error("Cannot pipe. Not readable."))};k.prototype.write=function(b,e,f){var g=this._writableState,k=!1;q.isFunction(e)&&(f=e,e=null);q.isBuffer(b)?e="buffer":e||(e=g.defaultEncoding);q.isFunction(f)||(f=function(){});g.ended?c(this,g,f):a(this,g,b,f)&&(g.pendingcb++,k=d(this,g,b,e,f));return k};k.prototype.cork=function(){this._writableState.corked++};k.prototype.uncork=function(){var a=this._writableState;a.corked&&(a.corked--,a.writing||a.corked||a.finished||a.bufferProcessing||
!a.buffer.length||w(this,a))};k.prototype._write=function(a,b,c){c(Error("not implemented"))};k.prototype._writev=null;k.prototype.end=function(a,c,d){var e=this._writableState;q.isFunction(a)?(d=a,c=a=null):q.isFunction(c)&&(d=c,c=null);q.isNullOrUndefined(a)||this.write(a,c);e.corked&&(e.corked=1,this.uncork());if(!e.ending&&!e.finished){a=d;e.ending=!0;A(this,e);if(a)if(e.finished)b.nextTick(a);else this.once("finish",a);e.ended=!0}}}).call(this,g("_process"))},{"./_stream_duplex":55,_process:49,
buffer:36,"core-util-is":60,inherits:46,stream:65}],60:[function(g,l,h){(function(b){h.isArray=function(b){return Array.isArray?Array.isArray(b):"[object Array]"===Object.prototype.toString.call(b)};h.isBoolean=function(b){return"boolean"===typeof b};h.isNull=function(b){return null===b};h.isNullOrUndefined=function(b){return null==b};h.isNumber=function(b){return"number"===typeof b};h.isString=function(b){return"string"===typeof b};h.isSymbol=function(b){return"symbol"===typeof b};h.isUndefined=
function(b){return void 0===b};h.isRegExp=function(b){return"[object RegExp]"===Object.prototype.toString.call(b)};h.isObject=function(b){return"object"===typeof b&&null!==b};h.isDate=function(b){return"[object Date]"===Object.prototype.toString.call(b)};h.isError=function(b){return"[object Error]"===Object.prototype.toString.call(b)||b instanceof Error};h.isFunction=function(b){return"function"===typeof b};h.isPrimitive=function(b){return null===b||"boolean"===typeof b||"number"===typeof b||"string"===
typeof b||"symbol"===typeof b||"undefined"===typeof b};h.isBuffer=b.isBuffer}).call(this,{isBuffer:g("../../../../insert-module-globals/node_modules/is-buffer/index.js")})},{"../../../../insert-module-globals/node_modules/is-buffer/index.js":47}],61:[function(g,l,h){l.exports=g("./lib/_stream_passthrough.js")},{"./lib/_stream_passthrough.js":56}],62:[function(g,l,h){h=l.exports=g("./lib/_stream_readable.js");h.Stream=g("stream");h.Readable=h;h.Writable=g("./lib/_stream_writable.js");h.Duplex=g("./lib/_stream_duplex.js");
h.Transform=g("./lib/_stream_transform.js");h.PassThrough=g("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":55,"./lib/_stream_passthrough.js":56,"./lib/_stream_readable.js":57,"./lib/_stream_transform.js":58,"./lib/_stream_writable.js":59,stream:65}],63:[function(g,l,h){l.exports=g("./lib/_stream_transform.js")},{"./lib/_stream_transform.js":58}],64:[function(g,l,h){l.exports=g("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":59}],65:[function(g,l,h){function b(){f.call(this)}
l.exports=b;var f=g("events").EventEmitter;g("inherits")(b,f);b.Readable=g("readable-stream/readable.js");b.Writable=g("readable-stream/writable.js");b.Duplex=g("readable-stream/duplex.js");b.Transform=g("readable-stream/transform.js");b.PassThrough=g("readable-stream/passthrough.js");b.Stream=b;b.prototype.pipe=function(b,g){function c(a){b.writable&&!1===b.write(a)&&v.pause&&v.pause()}function a(){v.readable&&v.resume&&v.resume()}function d(){u||(u=!0,b.end())}function h(){u||(u=!0,"function"===
typeof b.destroy&&b.destroy())}function l(a){m();if(0===f.listenerCount(this,"error"))throw a;}function m(){v.removeListener("data",c);b.removeListener("drain",a);v.removeListener("end",d);v.removeListener("close",h);v.removeListener("error",l);b.removeListener("error",l);v.removeListener("end",m);v.removeListener("close",m);b.removeListener("close",m)}var v=this;v.on("data",c);b.on("drain",a);b._isStdio||g&&!1===g.end||(v.on("end",d),v.on("close",h));var u=!1;v.on("error",l);b.on("error",l);v.on("end",
m);v.on("close",m);b.on("close",m);b.emit("pipe",v);return b}},{events:40,inherits:46,"readable-stream/duplex.js":54,"readable-stream/passthrough.js":61,"readable-stream/readable.js":62,"readable-stream/transform.js":63,"readable-stream/writable.js":64}],66:[function(g,l,h){function b(a){return a.toString(this.encoding)}function f(a){this.charLength=(this.charReceived=a.length%2)?2:0}function e(a){this.charLength=(this.charReceived=a.length%3)?3:0}var k=g("buffer").Buffer,c=k.isEncoding||function(a){switch(a&&
a.toLowerCase()){case "hex":case "utf8":case "utf-8":case "ascii":case "binary":case "base64":case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":case "raw":return!0;default:return!1}};g=h.StringDecoder=function(a){this.encoding=(a||"utf8").toLowerCase().replace(/[-_]/,"");if(a&&!c(a))throw Error("Unknown encoding: "+a);switch(this.encoding){case "utf8":this.surrogateSize=3;break;case "ucs2":case "utf16le":this.surrogateSize=2;this.detectIncompleteChar=f;break;case "base64":this.surrogateSize=
3;this.detectIncompleteChar=e;break;default:this.write=b;return}this.charBuffer=new k(6);this.charLength=this.charReceived=0};g.prototype.write=function(a){for(var b="";this.charLength;){b=a.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:a.length;a.copy(this.charBuffer,this.charReceived,0,b);this.charReceived+=b;if(this.charReceived<this.charLength)return"";a=a.slice(b,a.length);var b=this.charBuffer.slice(0,this.charLength).toString(this.encoding),c=b.charCodeAt(b.length-
1);if(55296<=c&&56319>=c)this.charLength+=this.surrogateSize,b="";else{this.charReceived=this.charLength=0;if(0===a.length)return b;break}}this.detectIncompleteChar(a);var e=a.length;this.charLength&&(a.copy(this.charBuffer,0,a.length-this.charReceived,e),e-=this.charReceived);b+=a.toString(this.encoding,0,e);e=b.length-1;c=b.charCodeAt(e);return 55296<=c&&56319>=c?(c=this.surrogateSize,this.charLength+=c,this.charReceived+=c,this.charBuffer.copy(this.charBuffer,c,0,c),a.copy(this.charBuffer,0,0,
c),b.substring(0,e)):b};g.prototype.detectIncompleteChar=function(a){for(var b=3<=a.length?3:a.length;0<b;b--){var c=a[a.length-b];if(1==b&&6==c>>5){this.charLength=2;break}if(2>=b&&14==c>>4){this.charLength=3;break}if(3>=b&&30==c>>3){this.charLength=4;break}}this.charReceived=b};g.prototype.end=function(a){var b="";a&&a.length&&(b=this.write(a));this.charReceived&&(a=this.encoding,b+=this.charBuffer.slice(0,this.charReceived).toString(a));return b}},{buffer:36}],67:[function(g,l,h){function b(){this.href=
this.path=this.pathname=this.query=this.search=this.hash=this.hostname=this.port=this.host=this.auth=this.slashes=this.protocol=null}function f(a,c,d){if(a&&e(a)&&a instanceof b)return a;var f=new b;f.parse(a,c,d);return f}function e(a){return"object"===typeof a&&null!==a}var k=g("punycode");h.parse=f;h.resolve=function(a,b){return f(a,!1,!0).resolve(b)};h.resolveObject=function(a,b){return a?f(a,!1,!0).resolveObject(b):b};h.format=function(a){"string"===typeof a&&(a=f(a));return a instanceof b?a.format():
b.prototype.format.call(a)};h.Url=b;var c=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/;l="{}|\\^`".split("").concat('<>"` \r\n\t'.split(""));var d=["'"].concat(l),p=["%","/","?",";","#"].concat(d),G=["/","?","#"],m=/^[a-z0-9A-Z_-]{0,63}$/,v=/^([a-z0-9A-Z_-]{0,63})(.*)$/,u={javascript:!0,"javascript:":!0},w={javascript:!0,"javascript:":!0},A={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},C=g("querystring");b.prototype.parse=function(a,b,e){if("string"!==typeof a)throw new TypeError("Parameter 'url' must be a string, not "+
typeof a);a=a.trim();var f=c.exec(a);if(f){var f=f[0],g=f.toLowerCase();this.protocol=g;a=a.substr(f.length)}if(e||f||a.match(/^\/\/[^@\/]+@[^@\/]+/)){var h="//"===a.substr(0,2);!h||f&&w[f]||(a=a.substr(2),this.slashes=!0)}if(!w[f]&&(h||f&&!A[f])){h=-1;for(e=0;e<G.length;e++)f=a.indexOf(G[e]),-1!==f&&(-1===h||f<h)&&(h=f);h=-1===h?a.lastIndexOf("@"):a.lastIndexOf("@",h);-1!==h&&(e=a.slice(0,h),a=a.slice(h+1),this.auth=decodeURIComponent(e));h=-1;for(e=0;e<p.length;e++)f=a.indexOf(p[e]),-1!==f&&(-1===
h||f<h)&&(h=f);-1===h&&(h=a.length);this.host=a.slice(0,h);a=a.slice(h);this.parseHost();this.hostname=this.hostname||"";h="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!h){var l=this.hostname.split(/\./);e=0;for(f=l.length;e<f;e++){var B=l[e];if(B&&!B.match(m)){for(var E="",H=0,I=B.length;H<I;H++)E=127<B.charCodeAt(H)?E+"x":E+B[H];if(!E.match(m)){f=l.slice(0,e);e=l.slice(e+1);if(B=B.match(v))f.push(B[1]),e.unshift(B[2]);e.length&&(a="/"+e.join(".")+a);this.hostname=f.join(".");
break}}}}this.hostname=255<this.hostname.length?"":this.hostname.toLowerCase();if(!h){B=this.hostname.split(".");l=[];for(e=0;e<B.length;++e)f=B[e],l.push(f.match(/[^A-Za-z0-9_-]/)?"xn--"+k.encode(f):f);this.hostname=l.join(".")}e=this.port?":"+this.port:"";this.host=(this.hostname||"")+e;this.href+=this.host;h&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==a[0]&&(a="/"+a))}if(!u[g])for(e=0,f=d.length;e<f;e++)h=d[e],B=encodeURIComponent(h),B===h&&(B=escape(h)),a=a.split(h).join(B);
e=a.indexOf("#");-1!==e&&(this.hash=a.substr(e),a=a.slice(0,e));e=a.indexOf("?");-1!==e?(this.search=a.substr(e),this.query=a.substr(e+1),b&&(this.query=C.parse(this.query)),a=a.slice(0,e)):b&&(this.search="",this.query={});a&&(this.pathname=a);A[g]&&this.hostname&&!this.pathname&&(this.pathname="/");if(this.pathname||this.search)e=this.pathname||"",f=this.search||"",this.path=e+f;this.href=this.format();return this};b.prototype.format=function(){var a=this.auth||"";a&&(a=encodeURIComponent(a),a=
a.replace(/%3A/i,":"),a+="@");var b=this.protocol||"",c=this.pathname||"",d=this.hash||"",f=!1,g="";this.host?f=a+this.host:this.hostname&&(f=a+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(f+=":"+this.port));this.query&&e(this.query)&&Object.keys(this.query).length&&(g=C.stringify(this.query));a=this.search||g&&"?"+g||"";b&&":"!==b.substr(-1)&&(b+=":");this.slashes||(!b||A[b])&&!1!==f?(f="//"+(f||""),c&&"/"!==c.charAt(0)&&(c="/"+c)):f||(f="");d&&"#"!==d.charAt(0)&&
(d="#"+d);a&&"?"!==a.charAt(0)&&(a="?"+a);c=c.replace(/[?#]/g,function(a){return encodeURIComponent(a)});a=a.replace("#","%23");return b+f+c+a+d};b.prototype.resolve=function(a){return this.resolveObject(f(a,!1,!0)).format()};b.prototype.resolveObject=function(a){if("string"===typeof a){var c=new b;c.parse(a,!1,!0);a=c}var d=new b;Object.keys(this).forEach(function(a){d[a]=this[a]},this);d.hash=a.hash;if(""===a.href)return d.href=d.format(),d;if(a.slashes&&!a.protocol)return Object.keys(a).forEach(function(b){"protocol"!==
b&&(d[b]=a[b])}),A[d.protocol]&&d.hostname&&!d.pathname&&(d.path=d.pathname="/"),d.href=d.format(),d;if(a.protocol&&a.protocol!==d.protocol){if(!A[a.protocol])return Object.keys(a).forEach(function(b){d[b]=a[b]}),d.href=d.format(),d;d.protocol=a.protocol;if(a.host||w[a.protocol])d.pathname=a.pathname;else{for(var e=(a.pathname||"").split("/");e.length&&!(a.host=e.shift()););a.host||(a.host="");a.hostname||(a.hostname="");""!==e[0]&&e.unshift("");2>e.length&&e.unshift("");d.pathname=e.join("/")}d.search=
a.search;d.query=a.query;d.host=a.host||"";d.auth=a.auth;d.hostname=a.hostname||a.host;d.port=a.port;if(d.pathname||d.search)d.path=(d.pathname||"")+(d.search||"");d.slashes=d.slashes||a.slashes;d.href=d.format();return d}var c=d.pathname&&"/"===d.pathname.charAt(0),f=a.host||a.pathname&&"/"===a.pathname.charAt(0),g=c=f||c||d.host&&a.pathname,k=d.pathname&&d.pathname.split("/")||[],e=a.pathname&&a.pathname.split("/")||[],h=d.protocol&&!A[d.protocol];h&&(d.hostname="",d.port=null,d.host&&(""===k[0]?
k[0]=d.host:k.unshift(d.host)),d.host="",a.protocol&&(a.hostname=null,a.port=null,a.host&&(""===e[0]?e[0]=a.host:e.unshift(a.host)),a.host=null),c=c&&(""===e[0]||""===k[0]));if(f)d.host=a.host||""===a.host?a.host:d.host,d.hostname=a.hostname||""===a.hostname?a.hostname:d.hostname,d.search=a.search,d.query=a.query,k=e;else if(e.length)k||(k=[]),k.pop(),k=k.concat(e),d.search=a.search,d.query=a.query;else if(null!=a.search){h&&(d.hostname=d.host=k.shift(),h=d.host&&0<d.host.indexOf("@")?d.host.split("@"):
!1)&&(d.auth=h.shift(),d.host=d.hostname=h.shift());d.search=a.search;d.query=a.query;if(null!==d.pathname||null!==d.search)d.path=(d.pathname?d.pathname:"")+(d.search?d.search:"");d.href=d.format();return d}if(!k.length)return d.pathname=null,d.path=d.search?"/"+d.search:null,d.href=d.format(),d;for(var f=k.slice(-1)[0],e=(d.host||a.host)&&("."===f||".."===f)||""===f,l=0,m=k.length;0<=m;m--)f=k[m],"."==f?k.splice(m,1):".."===f?(k.splice(m,1),l++):l&&(k.splice(m,1),l--);if(!c&&!g)for(;l--;l)k.unshift("..");
!c||""===k[0]||k[0]&&"/"===k[0].charAt(0)||k.unshift("");e&&"/"!==k.join("/").substr(-1)&&k.push("");g=""===k[0]||k[0]&&"/"===k[0].charAt(0);h&&(d.hostname=d.host=g?"":k.length?k.shift():"",h=d.host&&0<d.host.indexOf("@")?d.host.split("@"):!1)&&(d.auth=h.shift(),d.host=d.hostname=h.shift());(c=c||d.host&&k.length)&&!g&&k.unshift("");k.length?d.pathname=k.join("/"):(d.pathname=null,d.path=null);if(null!==d.pathname||null!==d.search)d.path=(d.pathname?d.pathname:"")+(d.search?d.search:"");d.auth=a.auth||
d.auth;d.slashes=d.slashes||a.slashes;d.href=d.format();return d};b.prototype.parseHost=function(){var b=this.host,c=a.exec(b);c&&(c=c[0],":"!==c&&(this.port=c.substr(1)),b=b.substr(0,b.length-c.length));b&&(this.hostname=b)}},{punycode:50,querystring:53}],68:[function(g,l,h){l.exports=function(b){return b&&"object"===typeof b&&"function"===typeof b.copy&&"function"===typeof b.fill&&"function"===typeof b.readUInt8}},{}],69:[function(g,l,h){(function(b,f){function e(a,b){var e={seen:[],stylize:c};
3<=arguments.length&&(e.depth=arguments[2]);4<=arguments.length&&(e.colors=arguments[3]);A(b)?e.showHidden=b:b&&h._extend(e,b);D(e.showHidden)&&(e.showHidden=!1);D(e.depth)&&(e.depth=2);D(e.colors)&&(e.colors=!1);D(e.customInspect)&&(e.customInspect=!0);e.colors&&(e.stylize=k);return d(e,a,e.depth)}function k(a,b){var c=e.styles[b];return c?"\u001b["+e.colors[c][0]+"m"+a+"\u001b["+e.colors[c][1]+"m":a}function c(a,b){return a}function a(a){var b={};a.forEach(function(a,c){b[a]=!0});return b}function d(b,
c,e){if(b.customInspect&&c&&y(c.inspect)&&c.inspect!==h.inspect&&(!c.constructor||c.constructor.prototype!==c)){var f=c.inspect(e,b);q(f)||(f=d(b,f,e));return f}if(f=l(b,c))return f;var g=Object.keys(c),k=a(g);b.showHidden&&(g=Object.getOwnPropertyNames(c));if(r(c)&&(0<=g.indexOf("message")||0<=g.indexOf("description")))return G(c);if(0===g.length){if(y(c))return b.stylize("[Function"+(c.name?": "+c.name:"")+"]","special");if(n(c))return b.stylize(RegExp.prototype.toString.call(c),"regexp");if(z(c))return b.stylize(Date.prototype.toString.call(c),
"date");if(r(c))return G(c)}var f="",I=!1,t=["{","}"];w(c)&&(I=!0,t=["[","]"]);y(c)&&(f=" [Function"+(c.name?": "+c.name:"")+"]");n(c)&&(f=" "+RegExp.prototype.toString.call(c));z(c)&&(f=" "+Date.prototype.toUTCString.call(c));r(c)&&(f=" "+G(c));if(0===g.length&&(!I||0==c.length))return t[0]+f+t[1];if(0>e)return n(c)?b.stylize(RegExp.prototype.toString.call(c),"regexp"):b.stylize("[Object]","special");b.seen.push(c);g=I?m(b,c,e,k,g):g.map(function(a){return v(b,c,e,k,a,I)});b.seen.pop();return u(g,
f,t)}function l(a,b){if(D(b))return a.stylize("undefined","undefined");if(q(b)){var c="'"+JSON.stringify(b).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return a.stylize(c,"string")}if(C(b))return a.stylize(""+b,"number");if(A(b))return a.stylize(""+b,"boolean");if(null===b)return a.stylize("null","null")}function G(a){return"["+Error.prototype.toString.call(a)+"]"}function m(a,b,c,d,e){for(var f=[],g=0,k=b.length;g<k;++g)Object.prototype.hasOwnProperty.call(b,String(g))?f.push(v(a,
b,c,d,String(g),!0)):f.push("");e.forEach(function(e){e.match(/^\d+$/)||f.push(v(a,b,c,d,e,!0))});return f}function v(a,b,c,e,f,g){var k,h;b=Object.getOwnPropertyDescriptor(b,f)||{value:b[f]};b.get?h=b.set?a.stylize("[Getter/Setter]","special"):a.stylize("[Getter]","special"):b.set&&(h=a.stylize("[Setter]","special"));Object.prototype.hasOwnProperty.call(e,f)||(k="["+f+"]");h||(0>a.seen.indexOf(b.value)?(h=null===c?d(a,b.value,null):d(a,b.value,c-1),-1<h.indexOf("\n")&&(h=g?h.split("\n").map(function(a){return"  "+
a}).join("\n").substr(2):"\n"+h.split("\n").map(function(a){return"   "+a}).join("\n"))):h=a.stylize("[Circular]","special"));if(D(k)){if(g&&f.match(/^\d+$/))return h;k=JSON.stringify(""+f);k.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(k=k.substr(1,k.length-2),k=a.stylize(k,"name")):(k=k.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),k=a.stylize(k,"string"))}return k+": "+h}function u(a,b,c){var d=0;return 60<a.reduce(function(a,b){d++;0<=b.indexOf("\n")&&d++;return a+b.replace(/\u001b\[\d\d?m/g,
"").length+1},0)?c[0]+(""===b?"":b+"\n ")+" "+a.join(",\n  ")+" "+c[1]:c[0]+b+" "+a.join(", ")+" "+c[1]}function w(a){return Array.isArray(a)}function A(a){return"boolean"===typeof a}function C(a){return"number"===typeof a}function q(a){return"string"===typeof a}function D(a){return void 0===a}function n(a){return x(a)&&"[object RegExp]"===Object.prototype.toString.call(a)}function x(a){return"object"===typeof a&&null!==a}function z(a){return x(a)&&"[object Date]"===Object.prototype.toString.call(a)}
function r(a){return x(a)&&("[object Error]"===Object.prototype.toString.call(a)||a instanceof Error)}function y(a){return"function"===typeof a}function B(a){return 10>a?"0"+a.toString(10):a.toString(10)}function E(){var a=new Date,b=[B(a.getHours()),B(a.getMinutes()),B(a.getSeconds())].join(":");return[a.getDate(),t[a.getMonth()],b].join(" ")}var H=/%[sdj%]/g;h.format=function(a){if(!q(a)){for(var b=[],c=0;c<arguments.length;c++)b.push(e(arguments[c]));return b.join(" ")}for(var c=1,d=arguments,
f=d.length,b=String(a).replace(H,function(a){if("%%"===a)return"%";if(c>=f)return a;switch(a){case "%s":return String(d[c++]);case "%d":return Number(d[c++]);case "%j":try{return JSON.stringify(d[c++])}catch(b){return"[Circular]"}default:return a}}),g=d[c];c<f;g=d[++c])b=null!==g&&x(g)?b+(" "+e(g)):b+(" "+g);return b};h.deprecate=function(a,c){if(D(f.process))return function(){return h.deprecate(a,c).apply(this,arguments)};if(!0===b.noDeprecation)return a;var d=!1;return function(){if(!d){if(b.throwDeprecation)throw Error(c);
b.traceDeprecation?console.trace(c):console.error(c);d=!0}return a.apply(this,arguments)}};var I={},K;h.debuglog=function(a){D(K)&&(K=b.env.NODE_DEBUG||"");a=a.toUpperCase();if(!I[a])if((new RegExp("\\b"+a+"\\b","i")).test(K)){var c=b.pid;I[a]=function(){var b=h.format.apply(h,arguments);console.error("%s %d: %s",a,c,b)}}else I[a]=function(){};return I[a]};h.inspect=e;e.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,
39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};e.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"};h.isArray=w;h.isBoolean=A;h.isNull=function(a){return null===a};h.isNullOrUndefined=function(a){return null==a};h.isNumber=C;h.isString=q;h.isSymbol=function(a){return"symbol"===typeof a};h.isUndefined=D;h.isRegExp=n;h.isObject=x;h.isDate=z;h.isError=r;h.isFunction=y;h.isPrimitive=function(a){return null===
a||"boolean"===typeof a||"number"===typeof a||"string"===typeof a||"symbol"===typeof a||"undefined"===typeof a};h.isBuffer=g("./support/isBuffer");var t="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");h.log=function(){console.log("%s - %s",E(),h.format.apply(h,arguments))};h.inherits=g("inherits");h._extend=function(a,b){if(!b||!x(b))return a;for(var c=Object.keys(b),d=c.length;d--;)a[c[d]]=b[c[d]];return a}}).call(this,g("_process"),"undefined"!==typeof global?global:"undefined"!==typeof self?
self:"undefined"!==typeof window?window:{})},{"./support/isBuffer":68,_process:49,inherits:46}],70:[function(g,l,h){(function(){var b={VERSION:"2.3.5",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,PENDING:4},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300},WILDCARD:"*",ASYNC:"async",create:function(f,e){var g="string"==typeof f.initial?{state:f.initial}:f.initial,c=f.terminal||f["final"],a=e||f.target||{},d=f.events||[],h=f.callbacks||{},l={},m={},v=function(a){var c=a.from instanceof
Array?a.from:a.from?[a.from]:[b.WILDCARD];l[a.name]=l[a.name]||{};for(var d=0;d<c.length;d++)m[c[d]]=m[c[d]]||[],m[c[d]].push(a.name),l[a.name][c[d]]=a.to||c[d]};g&&(g.event=g.event||"startup",v({name:g.event,from:"none",to:g.state}));for(var u=0;u<d.length;u++)v(d[u]);for(var w in l)l.hasOwnProperty(w)&&(a[w]=b.buildEvent(w,l[w]));for(w in h)h.hasOwnProperty(w)&&(a[w]=h[w]);a.current="none";a.is=function(a){return a instanceof Array?0<=a.indexOf(this.current):this.current===a};a.can=function(a){return!this.transition&&
(l[a].hasOwnProperty(this.current)||l[a].hasOwnProperty(b.WILDCARD))};a.cannot=function(a){return!this.can(a)};a.transitions=function(){return m[this.current]};a.isFinished=function(){return this.is(c)};a.error=f.error||function(a,b,c,d,e,f,g){throw g||f;};if(g&&!g.defer)a[g.event]();return a},doCallback:function(f,e,g,c,a,d){if(e)try{return e.apply(f,[g,c,a].concat(d))}catch(h){return f.error(g,c,a,d,b.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function",h)}},beforeAnyEvent:function(f,
e,g,c,a){return b.doCallback(f,f.onbeforeevent,e,g,c,a)},afterAnyEvent:function(f,e,g,c,a){return b.doCallback(f,f.onafterevent||f.onevent,e,g,c,a)},leaveAnyState:function(f,e,g,c,a){return b.doCallback(f,f.onleavestate,e,g,c,a)},enterAnyState:function(f,e,g,c,a){return b.doCallback(f,f.onenterstate||f.onstate,e,g,c,a)},changeState:function(f,e,g,c,a){return b.doCallback(f,f.onchangestate,e,g,c,a)},beforeThisEvent:function(f,e,g,c,a){return b.doCallback(f,f["onbefore"+e],e,g,c,a)},afterThisEvent:function(f,
e,g,c,a){return b.doCallback(f,f["onafter"+e]||f["on"+e],e,g,c,a)},leaveThisState:function(f,e,g,c,a){return b.doCallback(f,f["onleave"+g],e,g,c,a)},enterThisState:function(f,e,g,c,a){return b.doCallback(f,f["onenter"+c]||f["on"+c],e,g,c,a)},beforeEvent:function(f,e,g,c,a){if(!1===b.beforeThisEvent(f,e,g,c,a)||!1===b.beforeAnyEvent(f,e,g,c,a))return!1},afterEvent:function(f,e,g,c,a){b.afterThisEvent(f,e,g,c,a);b.afterAnyEvent(f,e,g,c,a)},leaveState:function(f,e,g,c,a){var d=b.leaveThisState(f,e,g,
c,a);f=b.leaveAnyState(f,e,g,c,a);if(!1===d||!1===f)return!1;if(b.ASYNC===d||b.ASYNC===f)return b.ASYNC},enterState:function(f,e,g,c,a){b.enterThisState(f,e,g,c,a);b.enterAnyState(f,e,g,c,a)},buildEvent:function(f,e){return function(){var g=this.current,c=e[g]||e[b.WILDCARD]||g,a=Array.prototype.slice.call(arguments);if(this.transition)return this.error(f,g,c,a,b.Error.PENDING_TRANSITION,"event "+f+" inappropriate because previous transition did not complete");if(this.cannot(f))return this.error(f,
g,c,a,b.Error.INVALID_TRANSITION,"event "+f+" inappropriate in current state "+this.current);if(!1===b.beforeEvent(this,f,g,c,a))return b.Result.CANCELLED;if(g===c)return b.afterEvent(this,f,g,c,a),b.Result.NOTRANSITION;var d=this;this.transition=function(){d.transition=null;d.current=c;b.enterState(d,f,g,c,a);b.changeState(d,f,g,c,a);b.afterEvent(d,f,g,c,a);return b.Result.SUCCEEDED};this.transition.cancel=function(){d.transition=null;b.afterEvent(d,f,g,c,a)};var h=b.leaveState(this,f,g,c,a);if(!1===
h)return this.transition=null,b.Result.CANCELLED;if(b.ASYNC===h)return b.Result.PENDING;if(this.transition)return this.transition()}}};"undefined"!==typeof h?("undefined"!==typeof l&&l.exports&&(h=l.exports=b),h.StateMachine=b):"function"===typeof define&&define.amd?define(function(f){return b}):"undefined"!==typeof window?window.StateMachine=b:"undefined"!==typeof self&&(self.StateMachine=b)})()},{}],71:[function(g,l,h){(function(b,f){"object"===typeof l&&l.exports&&"function"===typeof g?l.exports=
f():"function"===typeof define&&"object"===typeof define.amd?define(f):b.log=f()})(this,function(){function b(a,b){var c=a[b];if("function"===typeof c.bind)return c.bind(a);try{return Function.prototype.bind.call(c,a)}catch(d){return function(){return Function.prototype.apply.apply(c,[a,arguments])}}}function f(a,b,c){return function(){"undefined"!==typeof console&&(e.call(this,b,c),this[a].apply(this,arguments))}}function e(b,c){for(var e=0;e<d.length;e++){var f=d[e];this[f]=e<b?a:this.methodFactory(f,
b,c)}}function g(c,d,e){return("undefined"===typeof console?!1:void 0!==console[c]?b(console,c):void 0!==console.log?b(console,"log"):a)||f.apply(this,arguments)}function c(a,b,c){function f(){var a;try{a=window.localStorage[m]}catch(b){}if("undefined"===typeof a)try{var c=window.document.cookie,d=c.indexOf(encodeURIComponent(m)+"=");d&&(a=/^([^;]+)/.exec(c.slice(d))[1])}catch(b){}void 0===h.levels[a]&&(a=void 0);return a}var h=this,l,m="loglevel";a&&(m+=":"+a);h.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,
ERROR:4,SILENT:5};h.methodFactory=c||g;h.getLevel=function(){return l};h.setLevel=function(b,c){"string"===typeof b&&void 0!==h.levels[b.toUpperCase()]&&(b=h.levels[b.toUpperCase()]);if("number"===typeof b&&0<=b&&b<=h.levels.SILENT){l=b;if(!1!==c)a:{var f=(d[b]||"silent").toUpperCase();try{window.localStorage[m]=f;break a}catch(g){}try{window.document.cookie=encodeURIComponent(m)+"="+f+";"}catch(g){}}e.call(h,b,a);if("undefined"===typeof console&&b<h.levels.SILENT)return"No console available for logging"}else throw"log.setLevel() called with invalid level: "+
b;};h.setDefaultLevel=function(a){f()||h.setLevel(a,!1)};h.enableAll=function(a){h.setLevel(h.levels.TRACE,a)};h.disableAll=function(a){h.setLevel(h.levels.SILENT,a)};c=f();null==c&&(c=null==b?"WARN":b);h.setLevel(c,!1)}var a=function(){},d=["trace","debug","info","warn","error"],h=new c,l={};h.getLogger=function(a){if("string"!==typeof a||""===a)throw new TypeError("You must supply a name when creating a logger.");var b=l[a];b||(b=l[a]=new c(a,h.getLevel(),h.methodFactory));return b};var m="undefined"!==
typeof window?window.log:void 0;h.noConflict=function(){"undefined"!==typeof window&&window.log===h&&(window.log=m);return h};return h})},{}],72:[function(g,l,h){(function(b){(function(b){if("function"===typeof bootstrap)bootstrap("promise",b);else if("object"===typeof h&&"object"===typeof l)l.exports=b();else if("function"===typeof define&&define.amd)define(b);else if("undefined"!==typeof ses)ses.ok()&&(ses.makeQ=b);else if("undefined"!==typeof window||"undefined"!==typeof self){var e="undefined"!==
typeof window?window:self,g=e.Q;e.Q=b();e.Q.noConflict=function(){e.Q=g;return this}}else throw Error("This environment was not anticipated by Q. Please file a bug.");})(function(){function f(a){return function(){return L.apply(a,arguments)}}function e(a,b){if(I&&b.stack&&"object"===typeof a&&null!==a&&a.stack&&-1===a.stack.indexOf("From previous event:")){for(var c=[],d=b;d;d=d.source)d.stack&&c.unshift(d.stack);c.unshift(a.stack);for(var c=c.join("\nFrom previous event:\n").split("\n"),d=[],e=0;e<
c.length;++e){var f=c[e],h;if(h=g(f)){var l=h[1];h=h[0]===t&&l>=K&&l<=aa}else h=!1;h||(h=f,h=-1!==h.indexOf("(module.js:")||-1!==h.indexOf("(node.js:"));h||!f||d.push(f)}c=d.join("\n");a.stack=c}}function g(a){var b=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(a);if(b||(b=/at ([^ ]+):(\d+):(?:\d+)$/.exec(a)))return[b[1],Number(b[2])];if(a=/.*@(.+):(\d+)$/.exec(a))return[a[1],Number(a[2])]}function c(){if(I)try{throw Error();}catch(a){var b=a.stack.split("\n"),b=0<b[0].indexOf("@")?b[1]:b[2];if(b=g(b))return t=
b[0],b[1]}}function a(a){return a instanceof m?a:A(a)?z(a):x(a)}function d(){function b(d){f=d;h.source=d;J(c,function(b,c){a.nextTick(function(){d.promiseDispatch.apply(d,c)})},void 0);e=c=void 0}var c=[],e=[],f,g=O(d.prototype),h=O(m.prototype);h.promiseDispatch=function(b,d,g){var h=F(arguments);c?(c.push(h),"when"===d&&g[1]&&e.push(g[1])):a.nextTick(function(){f.promiseDispatch.apply(f,h)})};h.valueOf=function(){if(c)return h;var a=u(f);w(a)&&(f=a);return a};h.inspect=function(){return f?f.inspect():
{state:"pending"}};if(a.longStackSupport&&I)try{throw Error();}catch(k){h.stack=k.stack.substring(k.stack.indexOf("\n")+1)}g.promise=h;g.resolve=function(c){f||b(a(c))};g.fulfill=function(a){f||b(x(a))};g.reject=function(a){f||b(n(a))};g.notify=function(b){f||J(e,function(c,d){a.nextTick(function(){d(b)})},void 0)};return g}function h(a){if("function"!==typeof a)throw new TypeError("resolver must be a function.");var b=d();try{a(b.resolve,b.reject,b.notify)}catch(c){b.reject(c)}return b.promise}function l(b){return h(function(c,
d){for(var e=0,f=b.length;e<f;e++)a(b[e]).then(c,d)})}function m(a,b,c){void 0===b&&(b=function(a){return n(Error("Promise does not support operation: "+a))});void 0===c&&(c=function(){return{state:"unknown"}});var d=O(m.prototype);d.promiseDispatch=function(c,e,f){var g;try{g=a[e]?a[e].apply(d,f):b.call(d,e,f)}catch(h){g=n(h)}c&&c(g)};if(d.inspect=c){var e=c();"rejected"===e.state&&(d.exception=e.reason);d.valueOf=function(){var a=c();return"pending"===a.state||"rejected"===a.state?d:a.value}}return d}
function v(b,c,d,e){return a(b).then(c,d,e)}function u(a){if(w(a)){var b=a.inspect();if("fulfilled"===b.state)return b.value}return a}function w(a){return a instanceof m}function A(a){return a===Object(a)&&"function"===typeof a.then}function C(){N.length=0;P.length=0;Q||(Q=!0)}function q(c,d){Q&&("object"===typeof b&&"function"===typeof b.emit&&a.nextTick.runAfter(function(){-1!==M(P,c)&&(b.emit("unhandledRejection",d,c),U.push(c))}),P.push(c),d&&"undefined"!==typeof d.stack?N.push(d.stack):N.push("(no stack) "+
d))}function D(c){if(Q){var d=M(P,c);-1!==d&&("object"===typeof b&&"function"===typeof b.emit&&a.nextTick.runAfter(function(){var a=M(U,c);-1!==a&&(b.emit("rejectionHandled",N[d],c),U.splice(a,1))}),P.splice(d,1),N.splice(d,1))}}function n(a){var b=m({when:function(b){b&&D(this);return b?b(a):this}},function(){return this},function(){return{state:"rejected",reason:a}});q(b,a);return b}function x(a){return m({when:function(){return a},get:function(b){return a[b]},set:function(b,c){a[b]=c},"delete":function(b){delete a[b]},
post:function(b,c){return null===b||void 0===b?a.apply(void 0,c):a[b].apply(a,c)},apply:function(b,c){return a.apply(b,c)},keys:function(){return X(a)}},void 0,function(){return{state:"fulfilled",value:a}})}function z(b){var c=d();a.nextTick(function(){try{b.then(c.resolve,c.reject,c.notify)}catch(a){c.reject(a)}});return c.promise}function r(b,c,d){return a(b).spread(c,d)}function y(b,c,d){return a(b).dispatch(c,d)}function B(a){return v(a,function(a){var b=0,c=d();J(a,function(d,e,f){var g;w(e)&&
"fulfilled"===(g=e.inspect()).state?a[f]=g.value:(++b,v(e,function(d){a[f]=d;0===--b&&c.resolve(a)},c.reject,function(a){c.notify({index:f,value:a})}))},void 0);0===b&&c.resolve(a);return c.promise})}function E(b){if(0===b.length)return a.resolve();var c=a.defer(),d=0;J(b,function(a,e,f){a=b[f];d++;v(a,function(a){c.resolve(a)},function(){d--;0===d&&c.reject(Error("Can't get fulfillment value from any promise, all promises were rejected."))},function(a){c.notify({index:f,value:a})})},void 0);return c.promise}
function H(b){return v(b,function(b){b=T(b,a);return v(B(T(b,function(a){return v(a,S,S)})),function(){return b})})}var I=!1;try{throw Error();}catch(Z){I=!!Z.stack}var K=c(),t,S=function(){},R=function(){function a(){for(var b,e;d.next;){d=d.next;b=d.task;d.task=void 0;if(e=d.domain)d.domain=void 0,e.enter();c(b,e)}for(;k.length;)b=k.pop(),c(b);f=!1}function c(b,d){try{b()}catch(e){if(h)throw d&&d.exit(),setTimeout(a,0),d&&d.enter(),e;setTimeout(function(){throw e;},0)}d&&d.exit()}var d={task:void 0,
next:null},e=d,f=!1,g=void 0,h=!1,k=[];R=function(a){e=e.next={task:a,domain:h&&b.domain,next:null};f||(f=!0,g())};if("object"===typeof b&&"[object process]"===b.toString()&&b.nextTick)h=!0,g=function(){b.nextTick(a)};else if("function"===typeof setImmediate)g="undefined"!==typeof window?setImmediate.bind(window,a):function(){setImmediate(a)};else if("undefined"!==typeof MessageChannel){var l=new MessageChannel;l.port1.onmessage=function(){g=m;l.port1.onmessage=a;a()};var m=function(){l.port2.postMessage(0)},
g=function(){setTimeout(a,0);m()}}else g=function(){setTimeout(a,0)};R.runAfter=function(a){k.push(a);f||(f=!0,g())};return R}(),L=Function.call,F=f(Array.prototype.slice),J=f(Array.prototype.reduce||function(a,b){var c=0,d=this.length;if(1===arguments.length){do{if(c in this){b=this[c++];break}if(++c>=d)throw new TypeError;}while(1)}for(;c<d;c++)c in this&&(b=a(b,this[c],c));return b}),M=f(Array.prototype.indexOf||function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return b;return-1}),T=f(Array.prototype.map||
function(a,b){var c=this,d=[];J(c,function(e,f,g){d.push(a.call(b,f,g,c))},void 0);return d}),O=Object.create||function(a){function b(){}b.prototype=a;return new b},W=f(Object.prototype.hasOwnProperty),X=Object.keys||function(a){var b=[],c;for(c in a)W(a,c)&&b.push(c);return b},Y=f(Object.prototype.toString),V;V="undefined"!==typeof ReturnValue?ReturnValue:function(a){this.value=a};a.resolve=a;a.nextTick=R;a.longStackSupport=!1;"object"===typeof b&&b&&b.env&&b.env.Q_DEBUG&&(a.longStackSupport=!0);
a.defer=d;d.prototype.makeNodeResolver=function(){var a=this;return function(b,c){b?a.reject(b):2<arguments.length?a.resolve(F(arguments,1)):a.resolve(c)}};a.Promise=h;a.promise=h;h.race=l;h.all=B;h.reject=n;h.resolve=a;a.passByCopy=function(a){return a};m.prototype.passByCopy=function(){return this};a.join=function(b,c){return a(b).join(c)};m.prototype.join=function(b){return a([this,b]).spread(function(a,b){if(a===b)return a;throw Error("Can't join: not the same: "+a+" "+b);})};a.race=l;m.prototype.race=
function(){return this.then(a.race)};a.makePromise=m;m.prototype.toString=function(){return"[object Promise]"};m.prototype.then=function(b,c,f){function g(a){try{return"function"===typeof b?b(a):a}catch(c){return n(c)}}function h(a){if("function"===typeof c){e(a,k);try{return c(a)}catch(b){return n(b)}}return n(a)}var k=this,l=d(),m=!1;a.nextTick(function(){k.promiseDispatch(function(a){m||(m=!0,l.resolve(g(a)))},"when",[function(a){m||(m=!0,l.resolve(h(a)))}])});k.promiseDispatch(void 0,"when",[void 0,
function(b){var c,d=!1;try{c="function"===typeof f?f(b):b}catch(e){if(d=!0,a.onerror)a.onerror(e);else throw e;}d||l.notify(c)}]);return l.promise};a.tap=function(b,c){return a(b).tap(c)};m.prototype.tap=function(b){b=a(b);return this.then(function(a){return b.fcall(a).thenResolve(a)})};a.when=v;m.prototype.thenResolve=function(a){return this.then(function(){return a})};a.thenResolve=function(b,c){return a(b).thenResolve(c)};m.prototype.thenReject=function(a){return this.then(function(){throw a;})};
a.thenReject=function(b,c){return a(b).thenReject(c)};a.nearer=u;a.isPromise=w;a.isPromiseAlike=A;a.isPending=function(a){return w(a)&&"pending"===a.inspect().state};m.prototype.isPending=function(){return"pending"===this.inspect().state};a.isFulfilled=function(a){return!w(a)||"fulfilled"===a.inspect().state};m.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state};a.isRejected=function(a){return w(a)&&"rejected"===a.inspect().state};m.prototype.isRejected=function(){return"rejected"===
this.inspect().state};var N=[],P=[],U=[],Q=!0;a.resetUnhandledRejections=C;a.getUnhandledReasons=function(){return N.slice()};a.stopUnhandledRejectionTracking=function(){C();Q=!1};C();a.reject=n;a.fulfill=x;a.master=function(b){return m({isDef:function(){}},function(a,c){return y(b,a,c)},function(){return a(b).inspect()})};a.spread=r;m.prototype.spread=function(a,b){return this.all().then(function(b){return a.apply(void 0,b)},b)};a.async=function(b){return function(){function c(b,g){var h;if("undefined"===
typeof StopIteration){try{h=d[b](g)}catch(k){return n(k)}return h.done?a(h.value):v(h.value,e,f)}try{h=d[b](g)}catch(k){return"[object StopIteration]"===Y(k)||k instanceof V?a(k.value):n(k)}return v(h,e,f)}var d=b.apply(this,arguments),e=c.bind(c,"next"),f=c.bind(c,"throw");return e()}};a.spawn=function(b){a.done(a.async(b)())};a["return"]=function(a){throw new V(a);};a.promised=function(a){return function(){return r([this,B(arguments)],function(b,c){return a.apply(b,c)})}};a.dispatch=y;m.prototype.dispatch=
function(b,c){var e=this,f=d();a.nextTick(function(){e.promiseDispatch(f.resolve,b,c)});return f.promise};a.get=function(b,c){return a(b).dispatch("get",[c])};m.prototype.get=function(a){return this.dispatch("get",[a])};a.set=function(b,c,d){return a(b).dispatch("set",[c,d])};m.prototype.set=function(a,b){return this.dispatch("set",[a,b])};a.del=a["delete"]=function(b,c){return a(b).dispatch("delete",[c])};m.prototype.del=m.prototype["delete"]=function(a){return this.dispatch("delete",[a])};a.mapply=
a.post=function(b,c,d){return a(b).dispatch("post",[c,d])};m.prototype.mapply=m.prototype.post=function(a,b){return this.dispatch("post",[a,b])};a.send=a.mcall=a.invoke=function(b,c){return a(b).dispatch("post",[c,F(arguments,2)])};m.prototype.send=m.prototype.mcall=m.prototype.invoke=function(a){return this.dispatch("post",[a,F(arguments,1)])};a.fapply=function(b,c){return a(b).dispatch("apply",[void 0,c])};m.prototype.fapply=function(a){return this.dispatch("apply",[void 0,a])};a["try"]=a.fcall=
function(b){return a(b).dispatch("apply",[void 0,F(arguments,1)])};m.prototype.fcall=function(){return this.dispatch("apply",[void 0,F(arguments)])};a.fbind=function(b){var c=a(b),d=F(arguments,1);return function(){return c.dispatch("apply",[this,d.concat(F(arguments))])}};m.prototype.fbind=function(){var a=this,b=F(arguments);return function(){return a.dispatch("apply",[this,b.concat(F(arguments))])}};a.keys=function(b){return a(b).dispatch("keys",[])};m.prototype.keys=function(){return this.dispatch("keys",
[])};a.all=B;m.prototype.all=function(){return B(this)};a.any=E;m.prototype.any=function(){return E(this)};a.allResolved=function(a,b,c){return function(){"undefined"!==typeof console&&"function"===typeof console.warn&&console.warn(b+" is deprecated, use "+c+" instead.",Error("").stack);return a.apply(a,arguments)}}(H,"allResolved","allSettled");m.prototype.allResolved=function(){return H(this)};a.allSettled=function(b){return a(b).allSettled()};m.prototype.allSettled=function(){return this.then(function(b){return B(T(b,
function(b){function c(){return b.inspect()}b=a(b);return b.then(c,c)}))})};a.fail=a["catch"]=function(b,c){return a(b).then(void 0,c)};m.prototype.fail=m.prototype["catch"]=function(a){return this.then(void 0,a)};a.progress=function(b,c){return a(b).then(void 0,void 0,c)};m.prototype.progress=function(a){return this.then(void 0,void 0,a)};a.fin=a["finally"]=function(b,c){return a(b)["finally"](c)};m.prototype.fin=m.prototype["finally"]=function(b){b=a(b);return this.then(function(a){return b.fcall().then(function(){return a})},
function(a){return b.fcall().then(function(){throw a;})})};a.done=function(b,c,d,e){return a(b).done(c,d,e)};m.prototype.done=function(c,d,f){var g=function(b){a.nextTick(function(){e(b,h);if(a.onerror)a.onerror(b);else throw b;})},h=c||d||f?this.then(c,d,f):this;"object"===typeof b&&b&&b.domain&&(g=b.domain.bind(g));h.then(void 0,g)};a.timeout=function(b,c,d){return a(b).timeout(c,d)};m.prototype.timeout=function(a,b){var c=d(),e=setTimeout(function(){b&&"string"!==typeof b||(b=Error(b||"Timed out after "+
a+" ms"),b.code="ETIMEDOUT");c.reject(b)},a);this.then(function(a){clearTimeout(e);c.resolve(a)},function(a){clearTimeout(e);c.reject(a)},c.notify);return c.promise};a.delay=function(b,c){void 0===c&&(c=b,b=void 0);return a(b).delay(c)};m.prototype.delay=function(a){return this.then(function(b){var c=d();setTimeout(function(){c.resolve(b)},a);return c.promise})};a.nfapply=function(b,c){return a(b).nfapply(c)};m.prototype.nfapply=function(a){var b=d();a=F(a);a.push(b.makeNodeResolver());this.fapply(a).fail(b.reject);
return b.promise};a.nfcall=function(b){var c=F(arguments,1);return a(b).nfapply(c)};m.prototype.nfcall=function(){var a=F(arguments),b=d();a.push(b.makeNodeResolver());this.fapply(a).fail(b.reject);return b.promise};a.nfbind=a.denodeify=function(b){var c=F(arguments,1);return function(){var e=c.concat(F(arguments)),f=d();e.push(f.makeNodeResolver());a(b).fapply(e).fail(f.reject);return f.promise}};m.prototype.nfbind=m.prototype.denodeify=function(){var b=F(arguments);b.unshift(this);return a.denodeify.apply(void 0,
b)};a.nbind=function(b,c){var e=F(arguments,2);return function(){var f=e.concat(F(arguments)),g=d();f.push(g.makeNodeResolver());a(function(){return b.apply(c,arguments)}).fapply(f).fail(g.reject);return g.promise}};m.prototype.nbind=function(){var b=F(arguments,0);b.unshift(this);return a.nbind.apply(void 0,b)};a.nmapply=a.npost=function(b,c,d){return a(b).npost(c,d)};m.prototype.nmapply=m.prototype.npost=function(a,b){var c=F(b||[]),e=d();c.push(e.makeNodeResolver());this.dispatch("post",[a,c]).fail(e.reject);
return e.promise};a.nsend=a.nmcall=a.ninvoke=function(b,c){var e=F(arguments,2),f=d();e.push(f.makeNodeResolver());a(b).dispatch("post",[c,e]).fail(f.reject);return f.promise};m.prototype.nsend=m.prototype.nmcall=m.prototype.ninvoke=function(a){var b=F(arguments,1),c=d();b.push(c.makeNodeResolver());this.dispatch("post",[a,b]).fail(c.reject);return c.promise};a.nodeify=function(b,c){return a(b).nodeify(c)};m.prototype.nodeify=function(b){if(b)this.then(function(c){a.nextTick(function(){b(null,c)})},
function(c){a.nextTick(function(){b(c)})});else return this};a.noConflict=function(){throw Error("Q.noConflict only works when Q is used as a global");};var aa=c();return a})}).call(this,g("_process"))},{_process:49}],73:[function(g,l,h){(function(b){function f(a){if(!(this instanceof f))return new f(a);c.call(this);var b=null,e=null,g=!1,h=null,k=a,l=null,A=null,C=null;Object.defineProperties(this,{_expires:{get:function(){return b},set:function(a){b=a}},_identity:{get:function(){return e},set:function(a){e=
a}},_isExpired:{get:function(){return g},set:function(a){g=a}},_pendingUpdate:{get:function(){return h},set:function(a){h=a}},_token:{get:function(){return k},set:function(a){k=a}},_tokenExpiredTimer:{get:function(){return l},set:function(a){l=a}},_tokenUpdatedTimer:{get:function(){return A},set:function(a){A=a}},_tokenPayload:{get:function(){return C},set:function(a){C=a}},expires:{enumerable:!0,get:function(){return b}},identity:{enumerable:!0,get:function(){return e}},isExpired:{enumerable:!0,
get:function(){return g}},token:{enumerable:!0,get:function(){return k}}});var q=this.updateToken(a);q.catch(function(a){this._pendingUpdate===q&&this.emit("error",a)}.bind(this))}function e(a){a=a.split(".");if(3!==a.length)throw Error("Token is invalid or malformed");a=a[1];var c=a.length%4;0<c&&(a+=Array(4-c+1).join("="));a=a.replace(/-/g,"+").replace(/_/g,"/");a="function"===typeof atob?atob(a):(new b(a,"base64")).toString();return JSON.parse(a)}function h(a){var b=null;if(!a.grants&&a.scope)b=
(a=a.scope.match(/identity%3D(.*?)(%26|$)/i))&&decodeURIComponent(a[1]);else if(a.grants instanceof Array){a=a.grants;for(var b=null,c=0;c<a.length;c++){var e=a[c];if(e&&"string"===typeof e.res&&(e=e.res.match(/^sip:(.*)@/))){b=decodeURIComponent(e[1]);break}}}else"object"===typeof a.grants&&(b=a.grants.identity||null);return b}var c=g("events").EventEmitter,a=g("util").inherits;a(f,c);f.prototype.updateToken=function(a){var b=this,c=new Promise(function(c){var f=e(a);b._identity=h(f);clearTimeout(b._tokenUpdatedTimer);
b._tokenUpdatedTimer=setTimeout(function(){b._tokenUpdatedTimer=null;b.emit("tokenUpdated",b)});b._expires=new Date(1E3*f.exp);b._isExpired=Date.now()>=b.expires;clearTimeout(b._tokenExpiredTimer);b._tokenExpiredTimer=setTimeout(function(){b._isExpired=!0;b._tokenExpiredTimer=null;b.emit("tokenExpired",b)},b.expires-Date.now());b._token=a;b._tokenPayload=f;c(b)});return this._pendingUpdate=c};l.exports=f}).call(this,g("buffer").Buffer)},{buffer:36,events:40,util:69}],74:[function(g,l,h){l.exports.AccessManager=
g("./accessmanager")},{"./accessmanager":73}],75:[function(g,l,h){(function(b,f){var e=g("url"),k=g("child_process").spawn,c=g("fs");h.XMLHttpRequest=function(){var a=this,d=g("http"),h=g("https"),l,m,v,u,w,A,C,q=!1,D={"User-Agent":"node-XMLHttpRequest",Accept:"*/*"},n={},x={},z="accept-charset accept-encoding access-control-request-headers access-control-request-method connection content-length content-transfer-encoding cookie cookie2 date expect host keep-alive origin referer te trailer transfer-encoding upgrade via".split(" "),
r=["TRACE","TRACK","CONNECT"],y=!1,B=!1,E={};this.UNSENT=0;this.OPENED=1;this.HEADERS_RECEIVED=2;this.LOADING=3;this.DONE=4;this.readyState=this.UNSENT;this.onreadystatechange=null;this.responseXML=this.responseText="";this.statusText=this.status=null;this.withCredentials=!1;this.open=function(a,b,c,d,e){this.abort();B=!1;if(!a||-1!==r.indexOf(a))throw Error("SecurityError: Request method not allowed");v=a;u=b.toString();w="boolean"!==typeof c?!0:c;A=d||null;C=e||null;H(this.OPENED)};this.setDisableHeaderCheck=
function(a){q=a};this.setRequestHeader=function(a,b){if(this.readyState!==this.OPENED)throw Error("INVALID_STATE_ERR: setRequestHeader can only be called when state is OPEN");if(q||a&&-1===z.indexOf(a.toLowerCase())){if(y)throw Error("INVALID_STATE_ERR: send flag is true");a=x[a.toLowerCase()]||a;x[a.toLowerCase()]=a;n[a]=n[a]?n[a]+", "+b:b}else console.warn('Refused to set unsafe header "'+a+'"')};this.getResponseHeader=function(a){return"string"===typeof a&&this.readyState>this.OPENED&&m&&m.headers&&
m.headers[a.toLowerCase()]&&!B?m.headers[a.toLowerCase()]:null};this.getAllResponseHeaders=function(){if(this.readyState<this.HEADERS_RECEIVED||B)return"";var a="",b;for(b in m.headers)"set-cookie"!==b&&"set-cookie2"!==b&&(a+=b+": "+m.headers[b]+"\r\n");return a.substr(0,a.length-2)};this.getRequestHeader=function(a){return"string"===typeof a&&x[a.toLowerCase()]?n[x[a.toLowerCase()]]:""};this.send=function(g){if(this.readyState!==this.OPENED)throw Error("INVALID_STATE_ERR: connection must be opened before send() is called");
if(y)throw Error("INVALID_STATE_ERR: send has already been called");var q=!1,t=!1,r=e.parse(u),z;switch(r.protocol){case "https:":q=!0;case "http:":z=r.hostname;break;case "file:":t=!0;break;case void 0:case null:case "":z="localhost";break;default:throw Error("Protocol not supported.");}if(t){if("GET"!==v)throw Error("XMLHttpRequest: Only GET method is supported");if(w)c.readFile(r.pathname,"utf8",function(b,c){b?a.handleError(b):(a.status=200,a.responseText=c,H(a.DONE))});else try{this.responseText=
c.readFileSync(r.pathname,"utf8"),this.status=200,H(a.DONE)}catch(E){this.handleError(E)}}else{var t=r.port||(q?443:80),L=r.pathname+(r.search?r.search:""),F;for(F in D)x[F.toLowerCase()]||(n[F]=D[F]);n.Host=z;q&&443===t||80===t||(n.Host+=":"+r.port);A&&("undefined"===typeof C&&(C=""),r=new f(A+":"+C),n.Authorization="Basic "+r.toString("base64"));"GET"===v||"HEAD"===v?g=null:g?(n["Content-Length"]=f.isBuffer(g)?g.length:f.byteLength(g),n["Content-Type"]||(n["Content-Type"]="text/plain;charset=UTF-8")):
"POST"===v&&(n["Content-Length"]=0);L={host:z,port:t,path:L,method:v,headers:n,agent:!1,withCredentials:a.withCredentials};B=!1;if(w){var J=q?h.request:d.request;y=!0;a.dispatchEvent("readystatechange");var M=function(b){a.handleError(b)};l=J(L,function O(b){m=b;301===m.statusCode||302===m.statusCode||303===m.statusCode||307===m.statusCode?(u=m.headers.location,b=e.parse(u),z=b.hostname,l=J({hostname:b.hostname,port:b.port,path:b.path,method:303===m.statusCode?"GET":v,headers:n,withCredentials:a.withCredentials},
O).on("error",M),l.end()):(m.setEncoding("utf8"),H(a.HEADERS_RECEIVED),a.status=m.statusCode,m.on("data",function(b){b&&(a.responseText+=b);y&&H(a.LOADING)}),m.on("end",function(){y&&(H(a.DONE),y=!1)}),m.on("error",function(b){a.handleError(b)}))}).on("error",M);g&&l.write(g);l.end();a.dispatchEvent("loadstart")}else{r=".node-xmlhttprequest-content-"+b.pid;t=".node-xmlhttprequest-sync-"+b.pid;c.writeFileSync(t,"","utf8");g="var http = require('http'), https = require('https'), fs = require('fs');var doRequest = http"+
(q?"s":"")+".request;var options = "+JSON.stringify(L)+";var responseText = '';var req = doRequest(options, function(response) {response.setEncoding('utf8');response.on('data', function(chunk) {  responseText += chunk;});response.on('end', function() {fs.writeFileSync('"+r+"', JSON.stringify({err: null, data: {statusCode: response.statusCode, headers: response.headers, text: responseText}}), 'utf8');fs.unlinkSync('"+t+"');});response.on('error', function(error) {fs.writeFileSync('"+r+"', JSON.stringify({err: error}), 'utf8');fs.unlinkSync('"+
t+"');});}).on('error', function(error) {fs.writeFileSync('"+r+"', JSON.stringify({err: error}), 'utf8');fs.unlinkSync('"+t+"');});"+(g?"req.write('"+JSON.stringify(g).slice(1,-1).replace(/'/g,"\\'")+"');":"")+"req.end();";for(g=k(b.argv[0],["-e",g]);c.existsSync(t););q=JSON.parse(c.readFileSync(r,"utf8"));g.stdin.end();c.unlinkSync(r);q.err?a.handleError(q.err):(m=q.data,a.status=q.data.statusCode,a.responseText=q.data.text,H(a.DONE))}}};this.handleError=function(a){this.status=0;this.statusText=
a;this.responseText=a.stack;B=!0;H(this.DONE);this.dispatchEvent("error")};this.abort=function(){l&&(l.abort(),l=null);n=D;this.status=0;this.responseXML=this.responseText="";B=!0;this.readyState===this.UNSENT||this.readyState===this.OPENED&&!y||this.readyState===this.DONE||(y=!1,H(this.DONE));this.readyState=this.UNSENT;this.dispatchEvent("abort")};this.addEventListener=function(a,b){a in E||(E[a]=[]);E[a].push(b)};this.removeEventListener=function(a,b){a in E&&(E[a]=E[a].filter(function(a){return a!==
b}))};this.dispatchEvent=function(b){if("function"===typeof a["on"+b])a["on"+b]();if(b in E)for(var c=0,d=E[b].length;c<d;c++)E[b][c].call(a)};var H=function(b){if(b==a.LOADING||a.readyState!==b)a.readyState=b,(w||a.readyState<a.OPENED||a.readyState===a.DONE)&&a.dispatchEvent("readystatechange"),a.readyState!==a.DONE||B||(a.dispatchEvent("load"),a.dispatchEvent("loadend"))}}}).call(this,g("_process"),g("buffer").Buffer)},{_process:49,buffer:36,child_process:34,fs:34,http:41,https:45,url:67}],76:[function(g,
l,h){l.exports={name:"twilio-ipmessaging-js-sdk",version:"0.8.1",description:"A library for Twilio IP messaging",main:"lib/index.js",scripts:{postinstall:"node node_modules/gulp/bin/gulp.js set-env"},repository:{type:"git",url:"https://code.hq.twilio.com/rtd/ipmessaging-js-lib.git"},author:"aivanovs",license:"MIT",dependencies:{babel:"^5.8.23",del:"^1.2.0",gulp:"^3.9.0","gulp-concat":"^2.5.2","gulp-esdoc":"0.0.5","gulp-jshint":"^1.11.0","gulp-shell":"^0.4.1","gulp-strip-debug":"^1.0.2","gulp-token-replace":"^1.0.2",
"gulp-uglify":"^1.2.0","javascript-state-machine":"^2.3.5",loglevel:"^1.3.1",q:"^1.4.1","run-sequence":"^1.1.0","twilio-common":"git+ssh://git@code.hq.twilio.com/client/twilio-common.js.git","vinyl-source-stream":"^1.1.0",xmlhttprequest:"^1.7.0",yargs:"^3.15.0"},devDependencies:{"babel-eslint":"^4.1.3",babelify:"^6.1.3",brfs:"^1.4.0",browserify:"^8.1.3","browserify-istanbul":"^0.2.1",chai:"^3.2.0","chai-as-promised":"^5.1.0",closurecompiler:"^1.5.2",eslint:"^1.6.0",express:"^4.13.3","gulp-eslint":"^1.0.0",
"gulp-util":"^3.0.6",jsdoc:"git+http://github.com/ryan-rowland/jsdoc.git","jsdoc-babel":"^0.1.0","jshint-stylish":"^2.0.1",karma:"^0.13.8","karma-browserify":"^4.3.0","karma-chrome-launcher":"^0.2.0","karma-commonjs":"0.0.13","karma-coverage":"^0.5.2","karma-firefox-launcher":"^0.1.6","karma-html-reporter":"^0.2.6","karma-junit-reporter":"^0.3.4","karma-mocha":"^0.2.0","karma-phantomjs2-launcher":"^0.3.2","karma-spec-reporter":"0.0.20",mocha:"^2.2.5",sinon:"^1.15.4","sinon-as-promised":"^4.0.0",twilio:"^2.5.1",
webpack:"^1.12.2"},engines:{node:">=0.12"}}},{}],77:[function(g,l,h){(function(b){var f=g("twilio-common").AccessManager,e=g("../lib"),h="IPMessaging";(function(b){if("function"===typeof define&&define.amd)define([],function(){return e});else if(b.Twilio=b.Twilio||function(){},b.Twilio.AccessManager=b.Twilio.AccessManager||f,h)b.Twilio[h]=e;else for(h in e)b.Twilio[h]=e[h]})(window||b||void 0)}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?
window:{})},{"../lib":28,"twilio-common":74}]},{},[77]);
